/* min/MIDI.js/examples/inc/colorspace.js */


if("undefined"===typeof MIDI)var MIDI={};
(function(){var b={},a=0,c=function(c){a++;var d=new Audio,k=c.split(";")[0];d.id="audio";d.setAttribute("preload","auto");d.setAttribute("audiobuffer",!0);d.addEventListener("error",function(){b[k]=!1;a--},!1);d.addEventListener("canplaythrough",function(){b[k]=!0;a--},!1);d.src="data:"+c;document.body.appendChild(d)};MIDI.audioDetect=function(e){if("undefined"===typeof Audio)return e({});var d=new Audio;if("undefined"===typeof d.canPlayType)return e(b);var k=d.canPlayType('audio/ogg; codecs="vorbis"'),
k="probably"===k||"maybe"===k,d=d.canPlayType("audio/mpeg"),d="probably"===d||"maybe"===d;if(k||d){k&&c("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA=");
d&&c("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var m=(new Date).getTime(),g=window.setInterval(function(){var d=5E3<(new Date).getTime()-m;if(!a||d)window.clearInterval(g),e(b)},1)}else e(b)}})();


"undefined"===typeof MIDI&&(MIDI={});
"undefined"===typeof MIDI.Soundfont&&(MIDI.Soundfont={});
(function(){MIDI.loadPlugin=function(d){"function"===typeof d&&(d={callback:d});var c=d.instruments||d.instrument||"acoustic_grand_piano";"object"!==typeof c&&(c=[c]);for(var e=0;e<c.length;e++){var f=c[e];"number"===typeof f&&(c[e]=MIDI.GeneralMIDI.byId[f])}MIDI.soundfontUrl=d.soundfontUrl||MIDI.soundfontUrl||"./soundfont/";MIDI.audioDetect(function(e){var f="",f=a[d.api]?d.api:a[window.location.hash.substr(1)]?window.location.hash.substr(1):window.webkitAudioContext||window.AudioContext?"webaudio":
window.Audio?"audiotag":"flash";if(b[f]){var r=d.targetFormat?d.targetFormat:e["audio/ogg"]?"ogg":"mp3";MIDI.lang=f;MIDI.supports=e;b[f](r,c,d)}})};var b={webmidi:function(a,d,c){MIDI.loader&&MIDI.loader.message("Web MIDI API...");MIDI.WebMIDI.connect(c)},flash:function(a,d,c){MIDI.loader&&MIDI.loader.message("Flash API...");DOMLoader.script.add({src:c.soundManagerUrl||"./inc/SoundManager2/script/soundmanager2.js",verify:"SoundManager",callback:function(){MIDI.Flash.connect(d,c)}})},audiotag:function(a,
b,g){MIDI.loader&&MIDI.loader.message("HTML5 Audio API...");var f=d({items:b,getNext:function(d){DOMLoader.sendRequest({url:MIDI.soundfontUrl+d+"-"+a+".js",onprogress:e,onload:function(a){c(a.responseText);MIDI.loader&&MIDI.loader.update(null,"Downloading",100);f.getNext()}})},onComplete:function(){MIDI.AudioTag.connect(g)}})},webaudio:function(a,b,g){MIDI.loader&&MIDI.loader.message("Web Audio API...");var f=d({items:b,getNext:function(d){DOMLoader.sendRequest({url:MIDI.soundfontUrl+d+"-"+a+".js",
onprogress:e,onload:function(a){c(a.responseText);MIDI.loader&&MIDI.loader.update(null,"Downloading...",100);f.getNext()}})},onComplete:function(){MIDI.WebAudio.connect(g)}})}},a={webmidi:!0,webaudio:!0,audiotag:!0,flash:!0},c=function(a){var d=document.createElement("script");d.language="javascript";d.type="text/javascript";d.text=a;document.body.appendChild(d)},e=function(a){this.totalSize||(this.getResponseHeader("Content-Length-Raw")?this.totalSize=parseInt(this.getResponseHeader("Content-Length-Raw")):
this.totalSize=a.total);a=this.totalSize?Math.round(100*(a.loaded/this.totalSize)):"";MIDI.loader&&MIDI.loader.update(null,"Downloading...",a)},d=function(a){var d={queue:[]},c;for(c in a.items)d.queue.push(a.items[c]);d.getNext=function(){if(!d.queue.length)return a.onComplete();a.getNext(d.queue.shift())};setTimeout(d.getNext,1);return d}})();


"undefined"===typeof MIDI&&(MIDI={});
"undefined"===typeof MIDI.Player&&(MIDI.Player={});
(function(){var b=MIDI.Player;b.callback=void 0;b.currentTime=0;b.endTime=0;b.restart=0;b.playing=!1;b.timeWarp=1;b.start=b.resume=function(){-1>b.currentTime&&(b.currentTime=-1);l(b.currentTime)};b.pause=function(){var a=b.restart;n();b.restart=a};b.stop=function(){n();b.restart=0;b.currentTime=0};b.addListener=function(a){k=a};b.removeListener=function(){k=void 0};b.clearAnimation=function(){b.interval&&window.clearInterval(b.interval)};b.setAnimation=function(a){var c="function"===typeof a?a:a.callback;
a=a.interval||30;var e=0,k=0,f=0;b.clearAnimation();b.interval=window.setInterval(function(){if(0!==b.endTime){b.playing?(e=f===b.currentTime?k-(new Date).getTime():0,e=0===b.currentTime?0:b.currentTime-e,f!==b.currentTime&&(k=(new Date).getTime(),f=b.currentTime)):e=b.currentTime;var a=e/1E3,l=a/60,a=60*l+(a-60*l),l=b.endTime/1E3;-1>l-a||c({now:a,end:l,events:d})}},a)};b.loadMidiFile=function(){b.replayer=new Replayer(MidiFile(b.currentData),b.timeWarp);b.data=b.replayer.getData();b.endTime=f()};
b.loadFile=function(a,d){b.stop();if(-1!==a.indexOf("base64,")){var c=window.atob(a.split(",")[1]);b.currentData=c;b.loadMidiFile();d&&d(c)}else c=new XMLHttpRequest,c.open("GET",a),c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){for(var a=this.responseText||"",c=[],e=a.length,k=String.fromCharCode,f=0;f<e;f++)c[f]=k(a.charCodeAt(f)&255);a=c.join("");b.currentData=a;b.loadMidiFile();d&&d(a)}},c.send()};var a=[],c,
e=0,d={},k=void 0,m=function(a,e,f,n,g,m){return window.setTimeout(function(){var n={channel:a,note:e,now:f,end:b.endTime,message:g,velocity:m};128===g?delete d[e]:d[e]=n;k&&k(n);b.currentTime=f;b.currentTime===c&&c<b.endTime&&l(c,!0)},f-n)},g=function(){if("WebAudioAPI"===MIDI.lang)return MIDI.Player.ctx;b.ctx||(b.ctx={currentTime:0});return b.ctx},f=function(){for(var a=b.data,d=a.length,c=0.5,e=0;e<d;e++)c+=a[e][1];return c},l=function(d,k){if(b.replayer){k||("undefined"===typeof d&&(d=b.restart),
b.playing&&n(),b.playing=!0,b.data=b.replayer.getData(),b.endTime=f());var l,s=0,t=0,v=b.data,w=g(),F=v.length;c=0.5;e=w.currentTime;for(var B=0;B<F;B++)if(l=v[B],l=l[1]||1E-11,c+l<=d)s=c+=l;else break;for(;B<F&&100>t;B++){l=v[B];c+=l[1]||1E-11;d=c-s;var x=l[0].event;if("channel"===x.type){var u=x.channel;switch(x.subtype){case "noteOn":if(MIDI.channels[u].mute)break;l=x.noteNumber-(b.MIDIOffset||0);a.push({event:x,source:MIDI.noteOn(u,x.noteNumber,x.velocity,d/1E3+w.currentTime),interval:m(u,l,c,
s,144,x.velocity)});t++;break;case "noteOff":if(MIDI.channels[u].mute)break;l=x.noteNumber-(b.MIDIOffset||0);a.push({event:x,source:MIDI.noteOff(u,x.noteNumber,d/1E3+w.currentTime),interval:m(u,l,c,s,128)})}}}}},n=function(){var c=g();b.playing=!1;for(b.restart+=1E3*(c.currentTime-e);a.length;)c=a.pop(),window.clearInterval(c.interval),c.source&&("number"===typeof c.source?window.clearTimeout(c.source):c.source.disconnect(0));for(var f in d)c=d[f],144===d[f].message&&k&&k({channel:c.channel,note:c.note,
now:c.now,end:c.end,message:128,velocity:c.velocity});d={}}})();


"undefined"===typeof MIDI&&(MIDI={});
(function(){var b=function(a){MIDI.api=a.api;MIDI.setVolume=a.setVolume;MIDI.programChange=a.programChange;MIDI.noteOn=a.noteOn;MIDI.noteOff=a.noteOff;MIDI.chordOn=a.chordOn;MIDI.chordOff=a.chordOff;MIDI.stopAllNotes=a.stopAllNotes;MIDI.getInput=a.getInput;MIDI.getOutputs=a.getOutputs};(function(){var a=null,c=null,e=MIDI.WebMIDI={api:"webmidi"};e.setVolume=function(a,b){c.send([176+a,7,b])};e.programChange=function(a,b){c.send([192+a,b])};e.noteOn=function(a,b,e,g){c.send([144+a,b,e],1E3*g)};e.noteOff=
function(a,b,e){c.send([128+a,b,0],1E3*e)};e.chordOn=function(a,b,e,g){for(var f=0;f<b.length;f++)c.send([144+a,b[f],e],1E3*g)};e.chordOff=function(a,b,e){for(var g=0;g<b.length;g++)c.send([128+a,b[g],0],1E3*e)};e.stopAllNotes=function(){for(var a=0;16>a;a++)c.send([176+a,123,0])};e.getInput=function(){return a.getInputs()};e.getOutputs=function(){return a.getOutputs()};e.connect=function(d){b(e);navigator.requestMIDIAccess().then(function(b){a=b;c=a.outputs()[0];d.callback&&d.callback()},function(a){d.api=
window.AudioContext||window.webkitAudioContext?"webaudio":window.Audio?"audiotag":"flash";MIDI.loadPlugin(d)})}})();(window.AudioContext||window.webkitAudioContext)&&function(){var a=window.AudioContext||window.webkitAudioContext,c=MIDI.WebAudio={api:"webaudio"},e,d={},k=127,m={},g=function(a,d,c,b,k){var g=MIDI.GeneralMIDI.byName[a],s=g.number,t=d[c];if(!MIDI.Soundfont[a][t])return k(a);var v=MIDI.Soundfont[a][t].split(",")[1],v=Base64Binary.decodeArrayBuffer(v);e.decodeAudioData(v,function(e){for(var v=
t;3>v.length;)v+="&nbsp;";"undefined"!==typeof MIDI.loader&&MIDI.loader.update(null,g.instrument+"<br>Processing: "+(100*(c/87)>>0)+"%<br>"+v);e.id=t;b[c]=e;if(b.length===d.length){for(;b.length;)(e=b.pop())&&(m[s+""+MIDI.keyToNote[e.id]]=e);k(a)}})};c.setVolume=function(a,d){k=d};c.programChange=function(a,d){MIDI.channels[a].instrument=d};c.noteOn=function(a,c,b,g){if(MIDI.channels[a]){var q=MIDI.channels[a].instrument;if(m[q+""+c]){g<e.currentTime&&(g+=e.currentTime);var p=e.createBufferSource();
d[a+""+c]=p;p.buffer=m[q+""+c];p.connect(e.destination);p.gainNode=e.createGain?e.createGain():e.createGainNode();a=2*b/127*(k/127)-1;p.gainNode.connect(e.destination);p.gainNode.gain.value=Math.max(-1,a);p.connect(p.gainNode);p.noteOn?p.noteOn(g||0):p.start(g||0);return p}}};c.noteOff=function(a,c,b){b=b||0;b<e.currentTime&&(b+=e.currentTime);var k=d[a+""+c];if(k){if(k.gainNode){var g=k.gainNode.gain;g.linearRampToValueAtTime(g.value,b);g.linearRampToValueAtTime(-1,b+0.2)}k.noteOff?k.noteOff(b+0.3):
k.stop(b+0.3);delete d[a+""+c]}};c.chordOn=function(a,d,b,e){for(var k={},g,m=0,t=d.length;m<t;m++)k[g=d[m]]=c.noteOn(a,g,b,e);return k};c.chordOff=function(a,d,b){for(var e={},k,g=0,m=d.length;g<m;g++)e[k=d[g]]=c.noteOff(a,k,b);return e};c.stopAllNotes=function(){for(var a in d){var c=0;c<e.currentTime&&(c+=e.currentTime);d[a].gain.linearRampToValueAtTime(1,c);d[a].gain.linearRampToValueAtTime(0,c+0.2);d[a].noteOff(c+0.3);delete d[a]}};c.connect=function(d){b(c);MIDI.Player.ctx=e=new a;var k=[],
n=MIDI.keyToNote,r;for(r in n)k.push(r);var n=[],m={};r=function(a){delete m[a];for(var c in m)break;c||d.callback()};for(var p in MIDI.Soundfont){m[p]=!0;for(var s=0;s<k.length;s++)g(p,k,s,n,r)}}}();window.Audio&&function(){for(var a=MIDI.AudioTag={api:"audiotag"},c={},e=127,d=-1,k=[],m=[],g={},f=0;12>f;f++)k[f]=new Audio;var l=function(a,c){if(MIDI.channels[a]){var b=MIDI.GeneralMIDI.byId[MIDI.channels[a].instrument].id;if(c=g[c]){var f=(d+1)%k.length,l=k[f];m[f]=b+""+c.id;l.src=MIDI.Soundfont[b][c.id];
l.volume=e/127;l.play();d=f}}},n=function(a,c){if(MIDI.channels[a]){var b=MIDI.GeneralMIDI.byId[MIDI.channels[a].instrument].id;if(c=g[c])for(var b=b+""+c.id,e=0;e<k.length;e++){var f=(e+d+1)%k.length,l=m[f];if(l&&l==b){k[f].pause();m[f]=null;break}}}};a.programChange=function(a,c){MIDI.channels[a].instrument=c};a.setVolume=function(a,c){e=c};a.noteOn=function(a,d,b,e){var k=c[d];if(g[k]){if(e)return window.setTimeout(function(){l(a,k)},1E3*e);l(a,k)}};a.noteOff=function(a,d,b){var e=c[d];if(g[e]){if(b)return setTimeout(function(){n(a,
e)},1E3*b);n(a,e)}};a.chordOn=function(a,d,b,e){for(b=0;b<d.length;b++){var k=c[d[b]];if(g[k]){if(e)return window.setTimeout(function(){l(a,k)},1E3*e);l(a,k)}}};a.chordOff=function(a,d,b){for(var e=0;e<d.length;e++){var k=c[d[e]];if(g[k]){if(b)return window.setTimeout(function(){n(a,k)},1E3*b);n(a,k)}}};a.stopAllNotes=function(){for(var a=0,c=k.length;a<c;a++)k[a].pause()};a.connect=function(d){for(var e in MIDI.keyToNote)c[MIDI.keyToNote[e]]=e,g[e]={id:e};b(a);d.callback&&d.callback()}}();(function(){var a=
MIDI.Flash={api:"flash"},c={},e={};a.programChange=function(a,c){MIDI.channels[a].instrument=c};a.setVolume=function(a,c){};a.noteOn=function(a,b,m,g){if(MIDI.channels[a]&&(b=MIDI.GeneralMIDI.byId[MIDI.channels[a].instrument].number+""+c[b],e[b])){if(g)return window.setTimeout(function(){e[b].play({volume:2*m})},1E3*g);e[b].play({volume:2*m})}};a.noteOff=function(a,c,b){};a.chordOn=function(a,b,m,g){if(MIDI.channels[a]){a=MIDI.GeneralMIDI.byId[MIDI.channels[a].instrument].number;for(var f in b)g=
a+""+c[b[f]],e[g]&&e[g].play({volume:2*m})}};a.chordOff=function(a,c,b){};a.stopAllNotes=function(){};a.connect=function(d,k){soundManager.flashVersion=9;soundManager.useHTML5Audio=!0;soundManager.url=k.soundManagerSwfUrl||"../inc/SoundManager2/swf/";soundManager.useHighPerformance=!0;soundManager.wmode="transparent";soundManager.flashPollingInterval=1;soundManager.debugMode=!1;soundManager.onload=function(){for(var g=function(a,c,d){e[MIDI.GeneralMIDI.byName[a].number+""+c]=soundManager.createSound({id:c,
url:MIDI.soundfontUrl+a+"-mp3/"+c+".mp3",multiShot:!0,autoLoad:!0,onload:d})},f=[],l=88*d.length,n=0;n<d.length;n++)for(var r=d[n],m=function(){f.push(this.sID);"undefined"!==typeof MIDI.loader&&MIDI.loader.update(null,"Processing: "+this.sID)},p=0;88>p;p++)g(r,c[p+21],m);b(a);var s=window.setInterval(function(){f.length<l||(window.clearInterval(s),k.callback&&k.callback())},25)};soundManager.onerror=function(){};for(var m in MIDI.keyToNote)c[MIDI.keyToNote[m]]=m}})();MIDI.GeneralMIDI=function(a){var c=
function(a){return a.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},b={byName:{},byId:{},byCategory:{}},d;for(d in a)for(var k=a[d],m=0,g=k.length;m<g;m++){var f=k[m];if(f){var l=parseInt(f.substr(0,f.indexOf(" ")),10),f=f.replace(l+" ","");b.byId[--l]=b.byName[c(f)]=b.byCategory[c(d)]={id:c(f),instrument:f,number:l,category:d}}}return b}({Piano:"1 Acoustic Grand Piano;2 Bright Acoustic Piano;3 Electric Grand Piano;4 Honky-tonk Piano;5 Electric Piano 1;6 Electric Piano 2;7 Harpsichord;8 Clavinet".split(";"),
"Chromatic Percussion":"9 Celesta;10 Glockenspiel;11 Music Box;12 Vibraphone;13 Marimba;14 Xylophone;15 Tubular Bells;16 Dulcimer".split(";"),Organ:"17 Drawbar Organ;18 Percussive Organ;19 Rock Organ;20 Church Organ;21 Reed Organ;22 Accordion;23 Harmonica;24 Tango Accordion".split(";"),Guitar:"25 Acoustic Guitar (nylon);26 Acoustic Guitar (steel);27 Electric Guitar (jazz);28 Electric Guitar (clean);29 Electric Guitar (muted);30 Overdriven Guitar;31 Distortion Guitar;32 Guitar Harmonics".split(";"),
Bass:"33 Acoustic Bass;34 Electric Bass (finger);35 Electric Bass (pick);36 Fretless Bass;37 Slap Bass 1;38 Slap Bass 2;39 Synth Bass 1;40 Synth Bass 2".split(";"),Strings:"41 Violin;42 Viola;43 Cello;44 Contrabass;45 Tremolo Strings;46 Pizzicato Strings;47 Orchestral Harp;48 Timpani".split(";"),Ensemble:"49 String Ensemble 1;50 String Ensemble 2;51 Synth Strings 1;52 Synth Strings 2;53 Choir Aahs;54 Voice Oohs;55 Synth Choir;56 Orchestra Hit".split(";"),Brass:"57 Trumpet;58 Trombone;59 Tuba;60 Muted Trumpet;61 French Horn;62 Brass Section;63 Synth Brass 1;64 Synth Brass 2".split(";"),
Reed:"65 Soprano Sax;66 Alto Sax;67 Tenor Sax;68 Baritone Sax;69 Oboe;70 English Horn;71 Bassoon;72 Clarinet".split(";"),Pipe:"73 Piccolo;74 Flute;75 Recorder;76 Pan Flute;77 Blown Bottle;78 Shakuhachi;79 Whistle;80 Ocarina".split(";"),"Synth Lead":"81 Lead 1 (square);82 Lead 2 (sawtooth);83 Lead 3 (calliope);84 Lead 4 (chiff);85 Lead 5 (charang);86 Lead 6 (voice);87 Lead 7 (fifths);88 Lead 8 (bass + lead)".split(";"),"Synth Pad":"89 Pad 1 (new age);90 Pad 2 (warm);91 Pad 3 (polysynth);92 Pad 4 (choir);93 Pad 5 (bowed);94 Pad 6 (metallic);95 Pad 7 (halo);96 Pad 8 (sweep)".split(";"),
"Synth Effects":"97 FX 1 (rain);98 FX 2 (soundtrack);99 FX 3 (crystal);100 FX 4 (atmosphere);101 FX 5 (brightness);102 FX 6 (goblins);103 FX 7 (echoes);104 FX 8 (sci-fi)".split(";"),Ethnic:"105 Sitar;106 Banjo;107 Shamisen;108 Koto;109 Kalimba;110 Bagpipe;111 Fiddle;112 Shanai".split(";"),Percussive:"113 Tinkle Bell;114 Agogo;115 Steel Drums;116 Woodblock;117 Taiko Drum;118 Melodic Tom;119 Synth Drum".split(";"),"Sound effects":"120 Reverse Cymbal;121 Guitar Fret Noise;122 Breath Noise;123 Seashore;124 Bird Tweet;125 Telephone Ring;126 Helicopter;127 Applause;128 Gunshot".split(";")});
MIDI.channels=function(){for(var a={},c=0;16>c;c++)a[c]={instrument:0,mute:!1,mono:!1,omni:!1,solo:!1};return a}();MIDI.pianoKeyOffset=21;MIDI.keyToNote={};MIDI.noteToKey={};(function(){for(var a="C Db D Eb E F Gb G Ab A Bb B".split(" "),c=21;108>=c;c++){var b=a[c%12]+((c-12)/12>>0);MIDI.keyToNote[b]=c;MIDI.noteToKey[c]=b}})()})();


/* min/MusicTheory.js */

(function(b){b.btoa||(b.btoa=function(a){a=escape(a);var b="",e,d,k="",m,g,f="",l=0;do e=a.charCodeAt(l++),d=a.charCodeAt(l++),k=a.charCodeAt(l++),m=e>>2,e=(e&3)<<4|d>>4,g=(d&15)<<2|k>>6,f=k&63,isNaN(d)?g=f=64:isNaN(k)&&(f=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);
while(l<a.length);return b});b.atob||(b.atob=function(a){var b="",e,d,k="",m,g="",f=0;/[^A-Za-z0-9\+\/\=]/g.exec(a)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),
g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),e=e<<2|d>>4,d=(d&15)<<4|m>>2,k=(m&3)<<6|g,b+=String.fromCharCode(e),64!=m&&(b+=String.fromCharCode(d)),64!=g&&(b+=String.fromCharCode(k));while(f<a.length);return unescape(b)})})(this);


if("undefined"===typeof DOM)var DOM={};
(function(){DOM.dimensions=function(){document.body&&(document.body.scrollHeight||(document.body.scrollHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)),window.innerWidth&&window.innerHeight||(document.body&&document.body.offsetWidth?(window.innerWidth=document.body.offsetWidth,window.innerHeight=document.body.offsetHeight):"CSS1Compat"===document.compatMode&&(document.documentElement&&document.documentElement.offsetWidth)&&(window.innerWidth=document.documentElement.offsetWidth,
window.innerHeight=document.documentElement.offsetHeight)))}})();


/* min/json2.js */


window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b,a){window.setTimeout(b,1E3/60)}}());

String.prototype.replaceAll=function(b,a){if("object"==typeof b){for(var c=this,e=0;e<b.length;e++)c=c.split(b[e]).join(a[e]);return c}return this.split(b).join(a)};
String.prototype.trim=function(b){return this.replace(/^\s+|\s+$/g,"")};
String.prototype.ucfirst=function(b){return this[0].toUpperCase()+this.substr(1)};
String.prototype.ucwords=function(b){return this.replace(/^(.)|\s(.)/g,function(a){return a.toUpperCase()})};
String.prototype.addslashes=function(){return this.replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0")};
String.prototype.stripslashes=function(){return this.replace(/\0/g,"0").replace(/\\([\\'"])/g,"$1")};
String.format=function(b){var a=Array.prototype.slice.call(arguments,1,arguments.length);return b.replace(/\{(\d+)\}/g,function(b,e){return a[e]})};
String.prototype.basename=function(){return this.replace(/\\/g,"/").replace(/.*\//,"")};


if("undefined"===typeof widgets)var widgets={};
(function(){var b={"text/css":"string","text/html":"string","text/plain":"string"};widgets.FileSaver=function(a){"undefined"===typeof a&&(a={});var c=a.jsDir||"./inc/",e=this;this.html5="function"===typeof ArrayBuffer;this.boot=function(){var b=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,d=window.btoa&&window.atob,g=[];g.push({src:c+"File/jszip.js",verify:"JSZip"});d||g.push({src:c+"Polyfill/Base64.js",verify:["atob","btoa"]});b||g.push({src:c+"Polyfill/BlobBuilder.js",verify:"BlobBuilder"});
e.html5?g.push({src:c+"File/FileSaver.js",verify:"saveAs"}):g.push({src:c+"File/downloadify.js",verify:["Downloadify","swfobject"]});DOMLoader.script.add({srcs:g,callback:function(){if(a.onready)a.onready(e)}});return this};this.download=function(a){if("function"===typeof saveAs&&"function"===typeof BlobBuilder&&a.getData){var c=a.getData(),e=a.name,f=a.mime,l=a.charset;a=a.extension;var n="";if("string"===typeof c){if("data:"===c.substr(0,5)){var r=c.substr(5).split(","),c=r[1],f=r[0].split(";")[0];
a||(a=f.split("/")[1]);b[r[0]]||(n="binary")}}else n="binary",f="application/zip",a="zip",c=d(c);e||(e="download");f||(f="text/plain");a||(a="txt");n||(n=b[f]||"binary");r=new BlobBuilder;if("string"===n)r.append(c),l&&(f+=";charset="+l);else{for(var c=atob(c),l=new ArrayBuffer(c.length),n=new Uint8Array(l),q=0;q<c.length;q++)n[q]=c.charCodeAt(q);r.append(l)}f=r.getBlob(f);saveAs(f,e+"."+a)}};this.button=function(a){var b=a.parent||document.body,g=a.id,f=a.fileName,l=a.fileType,n=a.getData,r="fake"===
a.format,q=document.createElement("span"),p=document.createElement("span");p.id=g;p.style.position="absolute";q.style.cssText="width: inherit; height: inherit;";q.className="downloadify-container";q.appendChild(p);var s=document.createElement("span");s.style.cssText="width: inherit; height: inherit;";s.className="downloadify";a.src?(p=new Image,p.src=a.src,s.appendChild(p)):s.innerHTML=a.title?a.title:f+"."+l;q.appendChild(s);b.appendChild(q);setTimeout(function(){var p=b.offsetWidth,v=b.offsetHeight;
q.style.width=p+"px";q.style.height=v+"px";var w=document.getElementById(g);e.html5||r?Event.add(s,"click",function(){if(r)return n();e.download({name:f,extension:l,getData:n})}):(Event.add(w,"mousedown",Event.stop),Downloadify.create(g,{filename:function(){return f+"."+l},data:function(){var a=n();return"string"===typeof a?a:d(a)},downloadImage:c+"File/downloadify.png",swf:c+"File/downloadify.swf",transparent:!0,append:!1,width:p,height:v,dataType:a.format}))},1)};var d=function(a){function c(a,
d){var e=a.data,f={};-1!==e.indexOf("base64")&&(e=e.split(";"),b[e[0].substr(5)]&&(f.binary=!1),f.base64=!0,e=e[1].substr(7));d.add(a.name,e,f)}var d=new JSZip;if("undefined"===typeof a.length)if(a.data&&a.name)a=[a];else{for(var e in a)for(var l=a[e],n=d.folder(e),r=0,q=l.length;r<q;r++)c(l[r],n);return d.generate()}r=0;for(q=a.length;r<q;r++)c(a[r],d);return d.generate()};return this.boot()}})();


"undefined"===typeof widgets&&(widgets={});
(function(){var b=Math.PI,a=!document.createElement("canvas").getContext,c={id:"loader",bars:12,radius:0,lineWidth:20,lineHeight:70,timeout:0,display:!0};widgets.Loader=function(k){if(!a){var m=this;"string"===typeof k&&(k={message:k});"boolean"===typeof k&&(k={display:!1});"undefined"===typeof k&&(k={});k.container=k.container||document.body;if(k.container){for(var g in c)"undefined"===typeof k[g]&&(k[g]=c[g]);var f=document.getElementById(k.id);if(f)this.span=f.parentNode.getElementsByTagName("span")[0];
else{var l=document.createElement("div");g=document.createElement("span");g.className="message";l.appendChild(g);l.className=c.id;l.style.cssText=e("opacity",400);this.span=g;this.div=l;f=document.createElement("canvas");document.body.appendChild(f);f.id=k.id;f.style.cssText="opacity: 1; position: absolute; z-index: 10000;";l.appendChild(f);k.container.appendChild(l)}var n=k.bars,r=k.radius,q=2*(k.lineHeight+20)+2*k.radius;d(k.container);var p=window.devicePixelRatio||1;f.width=q*p;f.height=q*p;var s=
0,t=f.getContext("2d");t.globalCompositeOperation="lighter";t.shadowOffsetX=1;t.shadowOffsetY=1;t.shadowBlur=1;t.shadowColor="rgba(0, 0, 0, 0.5)";this.messages={};this.message=function(a,b){return this.interval?this.add({message:a,onstart:b}):this.start(b,a)};this.update=function(a,b,c){if(!a)for(a in this.messages);if(!a)return this.message(b);a=this.messages[a];a.message=b;"number"===typeof c&&(a.span.innerHTML=c+"%");"..."===b.substr(-3)?(a._message=b.substr(0,b.length-3),a.messageAnimate=[".&nbsp;&nbsp;",
"..&nbsp;","..."].reverse()):(a._message=b,a.messageAnimate=!1);a.element.innerHTML=b};this.add=function(a){"string"===typeof a&&(a={message:a});this.span.style.cssText="background: "+(k.background?k.background:"rgba(0,0,0,0.65)")+";";this.div.style.cssText=e("opacity",400);this.div.style.cssText=this.stopPropagation?this.div.style.cssText+"background: rgba(0,0,0,0.25);":this.div.style.cssText+"pointer-events: none;";f.parentNode.style.opacity=1;f.parentNode.style.display="block";k.background&&(this.div.style.background=
k.backgrond);var b=(new Date).getTime(),c=Math.abs(b*Math.random()>>0),d=a.message,g=document.createElement("div");g.style.cssText=e("opacity",500);var l=document.createElement("span");l.style.cssText="float: right; width: 50px;";var n=document.createElement("span");n.innerHTML=d;g.appendChild(n);g.appendChild(l);b=this.messages[c]={seed:c,container:g,element:n,span:l,message:d,timeout:1E3*(a.timeout||k.timeout),timestamp:b,getProgress:a.getProgress};this.span.appendChild(g);this.span.style.display=
"block";this.update(b.seed,d);a.onstart&&window.setTimeout(a.onstart,50);this.center();this.interval||(a.delay||w(),window.clearInterval(this.interval),this.interval=window.setInterval(w,30));return c};this.remove=function(a){s+=0.07;(new Date).getTime();"object"===typeof a&&(a=a.join(":"));a&&(a=":"+a+":");for(var b in this.messages){var c=this.messages[b];a&&-1===a.indexOf(":"+c.seed+":")||(delete this.messages[c.seed],c.container.style.color="#99ff88",v(c),c.getProgress&&(c.span.innerHTML="100%"))}};
this.start=function(a,b){if(b||k.message)return this.add({message:b||k.message,onstart:a})};this.stop=function(){this.remove();window.clearInterval(this.interval);delete this.interval;if(k.oncomplete)k.oncomplete();f&&f.style&&(l.style.cssText+="pointer-events: none;",window.setTimeout(function(){m.div.style.opacity=0},1),window.setTimeout(function(){m.interval||(m.stopPropagation=!1,f.parentNode.style.display="none",t.clearRect(0,0,q,q))},4E5))};this.center=function(){var a=d(k.container),b=a.height-
q;f.style.left=(a.width-q)/2+"px";f.style.top=b/2+"px";f.style.width=q+"px";f.style.height=q+"px";m.span.style.top=b/2+q-10+"px"};g=document.createElement("style");g.innerHTML=".loader { color: #fff; position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 100000; opacity: 0; display: none; }.loader span.message { font-family: monospace; font-size: 14px; margin: auto; opacity: 1; display: none; border-radius: 10px; padding: 0px; width: 300px; text-align: center; position: absolute; z-index: 10000; left: 0; right: 0; }.loader span.message div { border-bottom: 1px solid #222; padding: 5px 10px; clear: both; text-align: left; opacity: 1; }.loader span.message div:last-child { border-bottom: none; }";
document.head.appendChild(g);var v=function(a){window.setTimeout(function(){a.container.style.opacity=0},1);window.setTimeout(function(){a.container.parentNode.removeChild(a.container)},250)},w=function(){var a=(new Date).getTime(),c;for(c in m.messages){var d=m.messages[c],e=s/0.07>>0;if(0===e%5&&d.getProgress){if(d.timeout&&d.timestamp&&a-d.timestamp>d.timeout){m.remove(d.seed);continue}var f=d.getProgress();if(100<=f){m.remove(d.seed);continue}d.span.innerHTML=(f>>0)+"%"}0===e%10&&d.messageAnimate&&
(d.element.innerHTML=d._message+d.messageAnimate[e/10%d.messageAnimate.length])}c||m.stop();t.save();t.clearRect(0,0,q*p,q*p);t.scale(p,p);t.translate(q/2,q/2);a=360-360/n;for(c=0;c<n;c++){d=2*(c/n)*b+s;t.save();t.translate(r*Math.sin(-d),r*Math.cos(-d));t.rotate(d);var d=-k.lineWidth/2,e=k.lineWidth,f=k.lineHeight,g=e/2;t.beginPath();t.moveTo(d+g,0);t.lineTo(d+e-g,0);t.quadraticCurveTo(d+e,0,d+e,0+g);t.lineTo(d+e,0+f-g);t.quadraticCurveTo(d+e,0+f,d+e-g,0+f);t.lineTo(d+g,0+f);t.quadraticCurveTo(d,
0+f,d,0+f-g);t.lineTo(d,0+g);t.quadraticCurveTo(d,0,d+g,0);t.fillStyle="hsla("+c/(n-1)*a+", 100%, 50%, 0.85)";t.fill();t.restore()}t.restore();s+=0.07};if(!1===k.display)return this;this.start();return this}}};var e=function(a,b){return"\t\t-webkit-transition-property: "+a+";\t\t-webkit-transition-duration: "+b+"ms;\t\t-moz-transition-property: "+a+";\t\t-moz-transition-duration: "+b+"ms;\t\t-o-transition-property: "+a+";\t\t-o-transition-duration: "+b+"ms;\t\t-ms-transition-property: "+a+";\t\t-ms-transition-duration: "+
b+"ms;"},d=function(a){if(window.innerWidth&&window.innerHeight)var b=window.innerWidth,d=window.innerHeight;else"CSS1Compat"===document.compatMode&&document.documentElement&&document.documentElement.offsetWidth?(b=document.documentElement.offsetWidth,d=document.documentElement.offsetHeight):document.body&&document.body.offsetWidth&&(b=document.body.offsetWidth,d=document.body.offsetHeight);a&&(b=a.offsetWidth);return{width:b,height:d}}})();


"undefined"===typeof widgets&&(widgets={});
widgets.Uploader=function(b){b||(b={});var a=this;this.uploadPath="./gallery-upload.php";this.callback=b.callback;this.maxFiles=((this.singleFile=b.singleFile||!1)?1:b.max)||Infinity;this.fileCollection={};this.hasFileReader=window.FileReader?!0:!1;this.acceptedFormats=b.formats||{"image/jpg":!0,"image/jpeg":!0,"image/gif":!0,"image/png":!0};this.uploadCollection=function(b){var d=[],c=this.fileCollection,e;for(e in c)d.push(c[e]);a.handleFiles(d,{upload:!0,callback:b})};this.preview=function(b){var d=
b.name,e=function(b){a.fileCollection[d].src=b.target.result;a.fileCollection[d].preview=!0;return c()},f=new FileReader;f.addEventListener?f.addEventListener("loadend",e,!1):f.onloadend=e;f.readAsDataURL(b)};this.upload=function(b){var d=b.name;if(a.hasFileReader){var e=function(b){switch(b.target.error.code){case b.target.error.NOT_FOUND_ERR:a.status="File not found.";break;case b.target.error.NOT_READABLE_ERR:a.status="File not readable.";break;case b.target.error.ABORT_ERR:a.status="Upload has been aborted.";
break;default:a.status="Read error."}},f=function(b){b.lengthComputable&&(a.status=Math.round(100*b.loaded/b.total))},l=function(e){var f=new XMLHttpRequest;f.onreadystatechange=function(b){if(4===f.readyState&&"success"===b.srcElement.responseText)return a.fileCollection[d].uploaded=!0,c()};"undefined"!==typeof f.sendAsBinary?(f.open("POST",a.uploadPath+"?upload=true",!0),e="--xxxxxxxxx\r\n"+("Content-Disposition: form-data; name='upload'; filename='"+b.name+"'\r\n"),e=e+"Content-Type: application/octet-stream\r\n\r\n"+
(n.result+"\r\n"),e+="--xxxxxxxxx\r\n",f.setRequestHeader("content-type","multipart/form-data; boundary=xxxxxxxxx"),f.sendAsBinary(e)):(f.open("POST",a.uploadPath+"?upload=true&base64=true",!0),f.setRequestHeader("X-FILENAME",b.name),f.setRequestHeader("X-FILESIZE",b.size),f.setRequestHeader("X-FILETYPE",b.type),f.send(window.btoa(n.result)))},n=new FileReader;"undefined"!==typeof n.addEventListener?(n.addEventListener("loadend",l,!1),n.addEventListener("error",e,!1),n.addEventListener("progress",
f,!1)):(n.onloadend=l,n.onerror=e,n.onprogress=f);n.readAsBinaryString(b)}else{var r=new XMLHttpRequest;r.onreadystatechange=function(b){if(4===r.readyState&&"success"===b.srcElement.responseText)return a.fileCollection[d].uploaded=!0,c()};r.open("POST",a.uploadPath+"?upload=true",!0);r.setRequestHeader("X-FILENAME",b.name);r.setRequestHeader("X-FILESIZE",b.size);r.setRequestHeader("X-FILETYPE",b.type);r.send(b)}};var c;this.handleFiles=function(b,d){var e=0,f=b.length;d||(d={});0<f&&(a.singleFile&&
!0!==d.upload)&&(a.fileCollection={});(c=function(){var l=b[e],n={status:a.status,current:e,length:f};if(++e>a.maxFiles||!l)a.callback(n,a.fileCollection,f-1,d.event);else{a.callback(n);n=l.name;if(a.fileCollection[n])if(d.upload){if(a.fileCollection[n].uploaded)return c()}else if(a.fileCollection[n].preview)return c();a.fileCollection[n]=l;(n=l.type)||(n="text/"+l.fileName.substr(l.fileName.lastIndexOf(".")+1));if(!a.acceptedFormats[n])return console.log(n+"is not an accepted format."),c();if(0===
(l.fileSize||l.size))return console.log("file is empty."),c();if(d.upload)a.upload(l);else if(d.preview&&a.hasFileReader)a.preview(l);else return c()}})()};var e=document.createElement("form");e.action="#";e.method="post";e.enctype="multipart/form-data";e.style.cssText="z-index: 10000; position: absolute; left: 0; top: 0; display: none;";e.addEventListener("dragenter",function(a){Event.prevent(a);Event.stop(a);e.style.background="rgba(255,0,0,0.2)";return!1},!1);e.addEventListener("dragover",function(a){Event.prevent(a);
Event.stop(a);return!1},!1);e.addEventListener("drop",function(b){Event.prevent(b);Event.stop(b);e.style.display="none";e.style.background="none";b.dataTransfer&&b.dataTransfer.files&&a.handleFiles(b.dataTransfer.files,{preview:!0,event:b})},!1);e.addEventListener("dragleave",function(a){Event.prevent(a);Event.stop(a);window.setTimeout(function(){e.style.display="none";e.style.background="none"},100)},!1);var d=document.createElement("input");d.type="file";d.name="files[]";!this.singleFile&&1<this.maxFiles&&
(d.multiple="multiple");d.style.cssText="position: absolute; opacity: 0;";d.addEventListener("change",function(b){d.files&&d.files[0]?a.handleFiles(d.files,{preview:!0,event:b}):d.value&&console.log(d.value)},!1);d.addEventListener("click",function(a){Event.prevent(a);Event.stop(a)},!1);e.appendChild(d);b=function(a){!window.innerWidth&&(document.body&&document.body.offsetWidth)&&(window.innerWidth=document.body.offsetWidth,window.innerHeight=document.body.offsetHeight);window.innerWidth&&window.innerHeight&&
(e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px")};b();window.addEventListener("dragenter",function(a){e.style.display="block"},!1);window.addEventListener("resize",b,!1);document.body.appendChild(e);return this};


/* min/DOMLoader.js */

/* min/XMLHttpRequest.js */

/* min/MIDI.js/examples/inc/event.js */

/* min/MIDI.js/inc/jasmid/stream.js */

/* min/MIDI.js/inc/jasmid/midifile.js */

/* min/MIDI.js/inc/jasmid/replayer.js */


(function(b){function a(a){return String.fromCharCode.apply(null,a)}function c(a,b){if(b)for(;a.length/2<b;)a="0"+a;for(var d=[],c=a.length-1;0<=c;c-=2)d.unshift(parseInt(0===c?a[c]:a[c-1]+a[c],16));return d}var e=Array.prototype;if(!b.console||!console.firebug){var d=["log","debug","info","warn","error"];b.console={};for(var k=0;k<d.length;++k)b.console[d[k]]=function(){}}var m={G9:127,Gb9:126,F9:125,E9:124,Eb9:123,D9:122,Db9:121,C9:120,B8:119,Bb8:118,A8:117,Ab8:116,G8:115,Gb8:114,F8:113,E8:112,
Eb8:111,D8:110,Db8:109,C8:108,B7:107,Bb7:106,A7:105,Ab7:104,G7:103,Gb7:102,F7:101,E7:100,Eb7:99,D7:98,Db7:97,C7:96,B6:95,Bb6:94,A6:93,Ab6:92,G6:91,Gb6:90,F6:89,E6:88,Eb6:87,D6:86,Db6:85,C6:84,B5:83,Bb5:82,A5:81,Ab5:80,G5:79,Gb5:78,F5:77,E5:76,Eb5:75,D5:74,Db5:73,C5:72,B4:71,Bb4:70,A4:69,Ab4:68,G4:67,Gb4:66,F4:65,E4:64,Eb4:63,D4:62,Db4:61,C4:60,B3:59,Bb3:58,A3:57,Ab3:56,G3:55,Gb3:54,F3:53,E3:52,Eb3:51,D3:50,Db3:49,C3:48,B2:47,Bb2:46,A2:45,Ab2:44,G2:43,Gb2:42,F2:41,E2:40,Eb2:39,D2:38,Db2:37,C2:36,B1:35,
Bb1:34,A1:33,Ab1:32,G1:31,Gb1:30,F1:29,E1:28,Eb1:27,D1:26,Db1:25,C1:24,B0:23,Bb0:22,A0:21,Ab0:20,G0:19,Gb0:18,F0:17,E0:16,Eb0:15,D0:14,Db0:13,C0:12},g=function(a){if(!a||null===a.type&&void 0===a.type||null===a.channel&&void 0===a.channel||null===a.param1&&void 0===a.param1)throw Error("Not enough parameters to create an event.");this.setTime(a.time);this.setType(a.type);this.setChannel(a.channel);this.setParam1(a.param1);this.setParam2(a.param2)};g.createNote=function(a,b){if(!a)throw Error("Note not specified");
if("string"===typeof a)a=m[a];else if(!a.pitch)throw Error("The pitch is required in order to create a note.");var d=[];d.push(g.noteOn(a));b||d.push(g.noteOff(a,a.duration||128));return d};g.noteOn=function(a,b){return new g({time:a.duration||b||0,type:9,channel:a.channel||0,param1:a.pitch||a,param2:a.volume||90})};g.noteOff=function(a,b){return new g({time:a.duration||b||0,type:8,channel:a.channel||0,param1:a.pitch||a,param2:a.volume||90})};g.prototype={type:0,channel:0,time:0,setTime:function(a){var b=
a||0;for(a=b&127;b>>=7;)a<<=8,a|=b&127|128;for(b=[];;)if(b.push(a&255),a&128)a>>=8;else break;this.time=b},setType:function(a){if(8>a||14<a)throw Error("Trying to set an unknown event: "+a);this.type=a},setChannel:function(a){if(0>a||15<a)throw Error("Channel is out of bounds.");this.channel=a},setParam1:function(a){this.param1=a},setParam2:function(a){this.param2=a},toBytes:function(){var a=[],b=parseInt(this.type.toString(16)+this.channel.toString(16),16);a.push.apply(a,this.time);a.push(b);a.push(this.param1);
void 0!==this.param2&&null!==this.param2&&a.push(this.param2);return a}};var f=function(a){a&&(this.setType(a.type),this.setData(a.data))};f.prototype={setType:function(a){this.type=a},setData:function(a){this.data=a},toBytes:function(){if(!this.type||!this.data)throw Error("Type or data for meta-event not specified.");var a=[255,this.type];this.data&&(this.data.concat&&this.data.unshift&&!this.data.callee)&&e.push.apply(a,this.data);return a}};var l=function(a){this.events=[];for(var b in a)if(a.hasOwnProperty(b))this["set"+
b.charAt(0).toUpperCase()+b.substring(1)](a[b])};l.TRACK_START=[77,84,114,107];l.TRACK_END=[0,255,47,0];l.prototype={addEvent:function(a){this.events.push(a);return this},setEvents:function(a){e.push.apply(this.events,a);return this},setText:function(a,b){b||(b=a=1);return this.addEvent(new f({type:a,data:b}))},setCopyright:function(a){return this.setText(2,a)},setTrackName:function(a){return this.setText(3,a)},setInstrument:function(a){return this.setText(4,a)},setLyric:function(a){return this.setText(5,
a)},setMarker:function(a){return this.setText(6,a)},setCuePoint:function(a){return this.setText(7,a)},setTempo:function(a){this.addEvent(new f({type:81,data:a}))},setTimeSig:function(){},setKeySig:function(){},toBytes:function(){var a=0,b=[],d=l.TRACK_START,f=l.TRACK_END;this.events.forEach(function(d){d=d.toBytes();a+=d.length;e.push.apply(b,d)});var a=a+f.length,g=c(a.toString(16),4);return d.concat(g,b,f)}};b.MidiWriter=function(d){if(d){d=d.tracks||[];var e=d.length.toString(16),f="MThd\x00\x00\x00\u0006\x00\x00",
f=f+a(c(e,2)),f=f+"\u0001\u0090";d.forEach(function(b){f+=a(b.toBytes())});return{b64:btoa(f),play:function(){if(document){var a=document.createElement("embed");a.setAttribute("src","data:audio/midi;base64,"+this.b64);a.setAttribute("type","audio/midi");document.body.appendChild(a)}},save:function(){b.open("data:audio/midi;base64,"+this.b64,"JSMidi generated output","resizable=yes,scrollbars=no,status=no")}}}throw Error("No parameters have been passed to MidiWriter.");};b.MidiEvent=g;b.MetaEvent=
f;b.MidiTrack=l;b.noteTable=m})(jsmidi={});


(function(b){b.btoa||(b.btoa=function(a){a=escape(a);var b="",e,d,k="",m,g,f="",l=0;do e=a.charCodeAt(l++),d=a.charCodeAt(l++),k=a.charCodeAt(l++),m=e>>2,e=(e&3)<<4|d>>4,g=(d&15)<<2|k>>6,f=k&63,isNaN(d)?g=f=64:isNaN(k)&&(f=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);
while(l<a.length);return b});b.atob||(b.atob=function(a){var b="",e,d,k="",m,g="",f=0;/[^A-Za-z0-9\+\/\=]/g.exec(a)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),
g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),e=e<<2|d>>4,d=(d&15)<<4|m>>2,k=(m&3)<<6|g,b+=String.fromCharCode(e),64!=m&&(b+=String.fromCharCode(d)),64!=g&&(b+=String.fromCharCode(k));while(f<a.length);return unescape(b)})})(this);


String.prototype.replaceAll=function(b,a){if("object"===typeof b){for(var c=this,e=0;e<b.length;e++)c=c.split(b[e]).join(a[e]);return c}return this.split(b).join(a)};
String.prototype.trim=function(b){return this.replace(/^\s+|\s+$/g,"")};
String.prototype.ucfirst=function(b){return this[0].toUpperCase()+this.substr(1)};
String.prototype.ucwords=function(b){return this.replace(/^(.)|\s(.)/g,function(a){return a.toUpperCase()})};
String.prototype.addslashes=function(){return this.replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0")};
String.prototype.stripslashes=function(){return this.replace(/\0/g,"0").replace(/\\([\\'"])/g,"$1")};
String.prototype.basename=function(){return this.replace(/\\/g,"/").replace(/.*\//,"")};
String.prototype.lpad=function(b,a){for(var c=this;c.length<a;)c=b+c;return c};
String.prototype.rpad=function(b,a){for(var c=this;c.length<a;)c+=b;return c};

window.STRING=String;
STRING.prototype.replaceAll=STRING.prototype.replaceAll;
STRING.prototype.trim=STRING.prototype.trim;
STRING.prototype.ucfirst=STRING.prototype.ucfirst;
STRING.prototype.ucwords=STRING.prototype.ucwords;
STRING.prototype.addslashes=STRING.prototype.addslashes;
STRING.prototype.stripslashes=STRING.prototype.stripslashes;
STRING.prototype.basename=STRING.prototype.basename;
STRING.prototype.lpad=STRING.prototype.lpad;
STRING.prototype.rpad=STRING.prototype.rpad;


window.localStorage||(window.localStorage={getItem:function(b){return b&&this.hasOwnProperty(b)?unescape(document.cookie.replace(RegExp("(?:^|.*;\\s*)"+escape(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(b){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[b])},setItem:function(b,a){b&&(document.cookie=escape(b)+"="+escape(a)+"; path=/",this.length=document.cookie.match(/\=/g).length)},length:document.cookie.match(/\=/g).length,
removeItem:function(b){if(b&&this.hasOwnProperty(b)){var a=new Date;a.setDate(a.getDate()-1);document.cookie=escape(b)+"=; expires="+a.toGMTString()+"; path=/";this.length--}},hasOwnProperty:function(b){return RegExp("(?:^|;\\s*)"+escape(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}});


var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(b){var a=Math.ceil(3*b.length/4),a=new ArrayBuffer(a);this.decode(b,a);return a},decode:function(b,a){var c=this._keyStr.indexOf(b.charAt(b.length-1)),e=this._keyStr.indexOf(b.charAt(b.length-1)),d=Math.ceil(3*b.length/4);64==c&&d--;64==e&&d--;var k,m,g,f,l=0,n=0,c=a?new Uint8Array(a):new Uint8Array(d);b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(l=0;l<d;l+=3)k=this._keyStr.indexOf(b.charAt(n++)),
m=this._keyStr.indexOf(b.charAt(n++)),e=this._keyStr.indexOf(b.charAt(n++)),f=this._keyStr.indexOf(b.charAt(n++)),k=k<<2|m>>4,m=(m&15)<<4|e>>2,g=(e&3)<<6|f,c[l]=k,64!=e&&(c[l+1]=m),64!=f&&(c[l+2]=g);return c}};


"use strict";
var self=this;
self.URL=self.URL||self.webkitURL;
self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;
self.resolveLocalFileSystemURL=self.resolveLocalFileSystemURL||self.webkitResolveLocalFileSystemURL;

navigator.temporaryStorage=navigator.temporaryStorage||navigator.webkitTemporaryStorage;
navigator.persistentStorage=navigator.persistentStorage||navigator.webkitPersistentStorage;
self.BlobBuilder=self.BlobBuilder||self.MozBlobBuilder||self.WebKitBlobBuilder;

if(void 0===self.FileError){var FileError=function(){};FileError.prototype.prototype=Error.prototype}

var Util={toArray:function(b){return Array.prototype.slice.call(b||[],0)},strToDataURL:function(b,a,c){return(void 0!=c?c:1)?"data:"+a+";base64,"+self.btoa(b):"data:"+a+","+b},strToObjectURL:function(b,a){for(var c=new Uint8Array(b.length),e=0;e<c.length;++e)c[e]=b.charCodeAt(e);c=new Blob([c],a?{type:a}:{});return self.URL.createObjectURL(c)},fileToObjectURL:function(b){return self.URL.createObjectURL(b)},fileToArrayBuffer:function(b,a,c){var e=new FileReader;e.onload=function(b){a(b.target.result)};
e.onerror=function(a){c&&c(a)};e.readAsArrayBuffer(b)},dataURLToBlob:function(b){if(-1==b.indexOf(";base64,")){var a=b.split(",");b=a[0].split(":")[1];a=decodeURIComponent(a[1]);return new Blob([a],{type:b})}a=b.split(";base64,");b=a[0].split(":")[1];for(var a=window.atob(a[1]),c=a.length,e=new Uint8Array(c),d=0;d<c;++d)e[d]=a.charCodeAt(d);return new Blob([e],{type:b})},arrayBufferToBlob:function(b,a){var c=new Uint8Array(b);return new Blob([c],a?{type:a}:{})},arrayBufferToBinaryString:function(b,
a,c){var e=new FileReader;e.onload=function(b){a(b.target.result)};e.onerror=function(a){c&&c(a)};b=new Uint8Array(b);e.readAsBinaryString(new Blob([b]))},arrayToBinaryString:function(b){if("object"!=typeof b)return null;for(var a=b.length,c=Array(a);a--;)c[a]=String.fromCharCode(b[a]);return c.join("")},getFileExtension:function(b){var a=b.lastIndexOf(".");return-1!=a?b.substring(a):""}},
MyFileError=function(b){this.prototype=FileError.prototype;this.code=b.code;this.name=b.name};


FileError.BROWSER_NOT_SUPPORTED=1E3;
FileError.prototype.__defineGetter__("name",function(){for(var b=Object.keys(FileError),a=0,c;c=b[a];++a)if(FileError[c]==this.code)return c;return"Unknown Error"});

var Filer=new function(){function b(b){if(a=b||null)c=a.root,e=!0}var a=null,c=null,e=!1,d=function(b){0!=b.indexOf("filesystem:")&&(b="/"==b[0]?a.root.toURL()+b.substring(1):0==b.indexOf("./")||0==b.indexOf("../")?"../"==b&&c!=a.root?c.toURL()+"/"+b:c.toURL()+b:c.toURL()+"/"+b);return b},k=function(a,b){var c=arguments[1],e=arguments[2],k=function(a){if(a.code==FileError.NOT_FOUND_ERR){if(e)throw Error('"'+c+'" or "'+e+'" does not exist.');throw Error('"'+c+'" does not exist.');}throw Error("Problem getting Entry for one or more paths.");
},m=d(c);if(3==arguments.length){var p=d(e);self.resolveLocalFileSystemURL(m,function(b){self.resolveLocalFileSystemURL(p,function(d){a(b,d)},k)},k)}else self.resolveLocalFileSystemURL(m,a,k)},m=function(b,d,c,e,m,q){if(!a)throw Error("Filesystem has not been initialized.");if(typeof b!=typeof d)throw Error("These method arguments are not supported.");var p=c||null,s=void 0!=q?q:!1;(b.isFile||d.isDirectory)&&d.isDirectory?s?b.moveTo(d,p,e,m):b.copyTo(d,p,e,m):k(function(a,b){if(b.isDirectory)s?a.moveTo(b,
p,e,m):a.copyTo(b,p,e,m);else{var d=Error('Oops! "'+b.name+" is not a directory!");if(m)m(d);else throw d;}},b,d)};b.DEFAULT_FS_SIZE=1048576;b.version="0.4.3";b.prototype={get fs(){return a},get isOpen(){return e},get cwd(){return c}};b.prototype.pathToFilesystemURL=function(a){return d(a)};b.prototype.init=function(b,d,k){if(!self.requestFileSystem)throw new MyFileError({code:FileError.BROWSER_NOT_SUPPORTED,name:"BROWSER_NOT_SUPPORTED"});b=b?b:{};var m=b.size||1048576;this.type=self.TEMPORARY;"persistent"in
b&&b.persistent&&(this.type=self.PERSISTENT);var r=function(b){this.size=m;a=b;c=a.root;e=!0;d&&d(b)};this.type==self.PERSISTENT&&navigator.persistentStorage?navigator.persistentStorage.requestQuota(m,function(a){self.requestFileSystem(this.type,a,r.bind(this),k)}.bind(this),k):self.requestFileSystem(this.type,m,r.bind(this),k)};b.prototype.ls=function(b,d,e){if(!a)throw Error("Filesystem has not been initialized.");var m=function(a){c=a;var b=[],g=c.createReader(),k=function(){g.readEntries(function(a){a.length?
(b=b.concat(Util.toArray(a)),k()):(b.sort(function(a,b){return a.name<b.name?-1:b.name<a.name?1:0}),d(b))},e)};k()};b.isDirectory?m(b):0==b.indexOf("filesystem:")?k(m,b):c.getDirectory(b,{},m,e)};b.prototype.mkdir=function(b,d,e,k){if(!a)throw Error("Filesystem has not been initialized.");var m=null!=d?d:!1,q=b.split("/"),p=function(a,d){if("."==d[0]||""==d[0])d=d.slice(1);a.getDirectory(d[0],{create:!0,exclusive:m},function(a){if(a.isDirectory)d.length&&1!=q.length?p(a,d.slice(1)):e&&e(a);else if(a=
Error(b+" is not a directory"),k)k(a);else throw a;},function(a){if(a.code==FileError.INVALID_MODIFICATION_ERR)if(a.message="'"+b+"' already exists",k)k(a);else throw a;})};p(c,q)};b.prototype.open=function(b,c,e){if(!a)throw Error("Filesystem has not been initialized.");b.isFile?b.file(c,e):k(function(a){a.file(c,e)},d(b))};b.prototype.create=function(b,d,e,k){if(!a)throw Error("Filesystem has not been initialized.");c.getFile(b,{create:!0,exclusive:null!=d?d:!0},e,function(a){a.code==FileError.INVALID_MODIFICATION_ERR&&
(a.message="'"+b+"' already exists");if(k)k(a);else throw a;})};b.prototype.mv=function(a,b,d,c,e){m.bind(this,a,b,d,c,e,!0)()};b.prototype.rm=function(b,d,c){if(!a)throw Error("Filesystem has not been initialized.");var e=function(a){a.isFile?a.remove(d,c):a.isDirectory&&a.removeRecursively(d,c)};b.isFile||b.isDirectory?e(b):k(e,b)};b.prototype.cd=function(b,e,l){if(!a)throw Error("Filesystem has not been initialized.");b.isDirectory?(c=b,e&&e(c)):(b=d(b),k(function(a){if(a.isDirectory)c=a,e&&e(c);
else if(a=Error("Path was not a directory."),l)l(a);else throw a;},b))};b.prototype.cp=function(a,b,d,c,e){m.bind(this,a,b,d,c,e)()};b.prototype.write=function(b,d,e,m){if(!a)throw Error("Filesystem has not been initialized.");var r=function(a){a.createWriter(function(b){b.onerror=m;if(d.append)b.onwriteend=function(b){e&&e(a,this)},b.seek(b.length);else{var c=!1;b.onwriteend=function(b){c?e&&e(a,this):(c=!0,this.truncate(this.position))}}d.data.__proto__==ArrayBuffer.prototype&&(d.data=new Uint8Array(d.data));
var k=new Blob([d.data],d.type?{type:d.type}:{});b.write(k)},m)};b.isFile?r(b):0==b.indexOf("filesystem:")?k(r,b):c.getFile(b,{create:!0,exclusive:!1},r,m)};b.prototype.df=function(a,b){var d=function(b,d){a(b,d-b,d)};if(!navigator.temporaryStorage.queryUsageAndQuota||!navigator.persistentStorage.queryUsageAndQuota)throw Error("Not implemented.");self.TEMPORARY==this.type?navigator.temporaryStorage.queryUsageAndQuota(d,b):self.PERSISTENT==this.type&&navigator.persistentStorage.queryUsageAndQuota(d,
b)};return b};


/* min/Piano/piano_canvas.js */

/* min/Piano/piano_animation.js */

/* min/Piano/piano_notes_playing.js */

/* min/Piano/piano_render.js */


var MusicBox={};
(function(){function b(b){a.aspect=window.innerWidth/window.innerHeight;a.updateProjectionMatrix();e.setSize(window.innerWidth,window.innerHeight)}var a,c,e,d,k=[],m="#interactive"==window.location.hash,g;MusicBox.init=function(){d=document.createElement("div");d.id="musicbox";d.style.cssText="position: absolute; top: 0; left: 0; z-index: 0";d.onmousemove=MusicBox.render;document.body.appendChild(d);a=new THREE.TrackballCamera({fov:200,aspect:window.innerWidth/window.innerHeight,near:0,far:1E3,rotateSpeed:1,
zoomSpeed:1.2,panSpeed:0.8,noZoom:!1,noPan:!1,staticMoving:!1,dynamicDampingFactor:0.3});a.position.x=900;a.position.y=-100;a.position.z=-100;MusicBox.scene=new THREE.Scene;MusicBox.scene.fog=new THREE.FogExp2(0,0.0025);var f=new THREE.DirectionalLight(13421772,4);f.position.x=1;f.position.y=1;f.position.z=1;f.position.normalize();MusicBox.scene.addLight(f);f=new THREE.DirectionalLight(16777215,4);f.position.x=-1;f.position.y=-1;f.position.z=-1;f.position.normalize();MusicBox.scene.addLight(f);for(var f=
0,k=new THREE.CubeGeometry(100,40,40),g=1;9>g;g++)for(var m=0;12>m;m++){var q=new THREE.Mesh(k,new THREE.MeshLambertMaterial({color:parseInt("0x"+Piano.colorMap[f++].hex),transparent:!0,blending:THREE.AdditiveBlending}));q.position.x=1E3*(m/36)-50;q.position.y=1E3*(g/10)-500;q.position.z=1E3*(m/10)-400;q.sticky=!0;MusicBox.scene.addObject(q)}k=new THREE.Geometry;for(i=0;4E3>i;i++)vector=new THREE.Vector3(2E3*Math.random()-1E3,2E3*Math.random()-1E3,2E3*Math.random()-1E3),k.vertices.push(new THREE.Vertex(vector));
parameters=[[[1,1,1],5],[[0.95,1,1],4],[[0.9,1,1],3],[[0.85,1,1],2],[[0.8,1,1],1]];c=new THREE.Projector;e=new THREE.WebGLRenderer;e.sortObjects=!1;e.setSize(window.innerWidth,window.innerHeight);d.appendChild(e.domElement);window.addEventListener("resize",b,!1)};MusicBox.render=function(){a.update();if(m){var b=new THREE.Vector3(0,0,0.5);c.unprojectVector(b,a);b=(new THREE.Ray(a.position,b.subSelf(a.position).normalize())).intersectScene(MusicBox.scene);0<b.length?g!=b[0].object&&(g&&(g.scale.x=
1),g=b[0].object,g.currentHex=g.materials[0].color.hex,MIDI.noteOn&&(b=Color.Space(g.currentHex,"HEX>RGB>HSL"),b=(12*(b.H/360)>>0)+12*(b.L/10>>0),g.scale.x=100,MIDI.noteOn(1,b))):(g&&(g.scale.x=1),g=null)}b=1E-4*(new Date).getTime();for(i=0;i<MusicBox.scene.objects.length;i++){var d=MusicBox.scene.objects[i];d.sticky||(d.rotation.y=b*(4>i?i/70:-i/70))}for(i=0;i<k.length;i++)color=parameters[i][0],h=360*(color[0]+b)%360/360,k[i].color.setHSV(h,color[1],color[2]);e.render(MusicBox.scene,a)}})();


var change=function(){return{css:function(b,a){"string"===typeof b&&(b=document.getElementById(b));if(b){a=a.split(";");for(var c=0,e=a.length;c<e;c++){var d=a[c].split(":");b.style[d[0]]=d[1]}}},className:function(b,a){"string"===typeof b&&(b=document.getElementById(b));if(b){if(b.parentNode){var c=b.parentNode.getElementsByClassName(a);if(c.length)for(var e=0;e<c.length;e++)c[e].className=(" "+c[e].className+" ").replace(" "+a+" "," ").trim()}b.className=(b.className+" "+a).trim()}}}}();


"undefined"===typeof MIDI&&(MIDI={});
"undefined"===typeof MIDI.UI&&(MIDI.UI={});
(function(b){b.enableConfigure=function(a){var b=document.getElementById("tools").parentNode.style;a?(Event.remove(window,"keydown",Piano.keyDown),Event.remove(window,"keyup",Piano.keyUp),b.display="block"):(Event.add(window,"keydown",Piano.keyDown),Event.add(window,"keyup",Piano.keyUp),b.display="none")};b.enableView=function(a){"postview"===Piano.visualize?(MIDI.UI.enableTheoryView(),a||Piano.func()):MIDI.UI.enableSongView()};b.enableTheoryView=function(){Piano.setAnimation();change.className("view-theory",
"selected");document.querySelector("#view-song").className="selected theorymode";var a=document.getElementById("playback");"none"!==a.style.display&&(a.style.display="none",a=document.getElementById("theory"),a.style.display="inline-block",a.loaded||(a.loaded=!0,b.drawKeySignatures(a),b.drawOctaves(a),b.drawChords(a),b.drawInversions(a),b.drawScales(a)),Piano.visualize="postview",localStorage.setItem("visualize",Piano.visualize),Piano.Animation.boot())};b.enableSongView=function(){Piano.clearNotes();
change.className("view-song","selected");document.querySelector("#view-song").className="selected songmode";var a=document.getElementById("playback");"inline-block"!==a.style.display&&(a.style.display="inline-block",document.getElementById("theory").style.display="none",Piano.visualize="preview",localStorage.setItem("visualize",Piano.visualize),Piano.Animation.boot())};b.drawKeySignatures=function(a){var b=MIDI.noteToKey[Piano.key+21].replace(/[^a-zA-Z]+/g,"");a.appendChild(e({arr:MusicTheory.key2number,
header:{Signature:null},id:"key",title:"Key Signature",callback:function(a){a=a.options[a.selectedIndex].value;Piano.key=MusicTheory.key2number[a];Piano.inversion=0;MusicTheory.getKeySignature(a);Piano.drawKeyboard();Piano.func()},selected:b}))};b.drawOctaves=function(a){for(var b={},c=0;7>c;c++)b[c+" "]=c;a.appendChild(e({arr:b,header:{Octave:null},id:"octave",callback:function(a){Piano.octave=parseInt(a.options[a.selectedIndex].value);Piano.inversion=0;Piano.clearNotes();Piano.func()},selected:Piano.octave,
title:"Octaves"}))};b.drawChords=function(a){a.appendChild(e({arr:MusicTheory.Chords,id:"chord",header:{Chords:null},callback:function(a){Piano.chord=a.options[a.selectedIndex].value;Piano.func=function(){Piano.clearNotes();Piano.chordOn()};Piano.func();Piano.inversion=0},selected:Piano.chord,title:"Chords"}))};b.drawScales=function(a){var b=0,c=[],g;for(g in MusicTheory.Scales)c[b++]=g;Piano.scale=c[Math.round(Math.random()*b)];a.appendChild(e({arr:MusicTheory.Scales,id:"scale",header:{Scales:null},
callback:function(a){Piano.scale=a.options[a.selectedIndex].value;Piano.func=Piano.playScale;Piano.clearNotes();Piano.func();Piano.inversion=0},selected:Piano.scale,title:"Scales"}))};b.drawInversions=function(a){var b=document.createElement("input");b.type="button";b.title="Inversion -1";b.value="-";b.onclick=function(){Piano.clearNotes();Piano.invert(-1)};a.appendChild(b);b=document.createElement("input");b.type="button";b.title="Inversion +1";b.value="+";b.onclick=function(){Piano.clearNotes();
Piano.invert(1)};a.appendChild(b)};b.togglePlayer=function(a){var b=document.getElementById("control-play"),c="boolean"!==typeof a;c||b.setAttribute("toggled",a);a=b.getAttribute("toggled");"true"===a?(b.setAttribute("toggled",!1),b.src="./media/pause.png",Piano.clearNotes(),c&&(Piano.resume(),Piano.setAnimation())):(b.setAttribute("toggled",!0),b.src="./media/play.png",c&&MIDI.Player.pause())};b.drawTimeWarp=function(){var b=document.createElement("div");b.style.cssText="display: inline-block;";
var c,e,g=document.createElement("input");g.style.cssText="display: inline-block; width: 190px; position: relative; top: 4px;";g.setAttribute("type","range");g.max=400;g.min=100;g.value=100*Piano.timeWarp;g.onmousedown=function(a){e=MIDI.Player.currentTime;c=MIDI.Player.endTime;Event.stop(a);MIDI.Player.playing&&MIDI.UI.togglePlayer()};g.onchange=function(a){var b=g.value/100;a=(b<Piano.timeWarp?"Increasing":"Decreasing")+" speed...";Piano.timeWarp=b;localStorage.setItem("timeWarp",b);loader.message(a);
window.setTimeout(function(){MIDI.Player.timeWarp=b;MIDI.Player.loadMidiFile();MIDI.Player.currentTime=Piano.Animation.scrollTop=e/c*MIDI.Player.endTime;MIDI.Player.renderScreen();loader.stop()},10);f.innerHTML=Math.round(1E4*(1.25-g.value/400))/100+"%"};b.appendChild(g);var f=document.createElement("span");f.style.cssText="display: inline-block; color: #333; width: 30px; padding-left: 10px";f.innerHTML=g.value+"%";b.appendChild(f);a("Playback Speed:",b)};b.drawSynesthesia=function(){var b=e({arr:MusicTheory.Synesthesia.data,
id:"rgb",callback:function(a){Piano.HSL=a.options[a.selectedIndex].value;localStorage.setItem("HSL",Piano.HSL);Piano.colorMap=MusicTheory.Synesthesia.map(Piano.HSL);Piano.drawKeyboard();MIDI.Player.renderScreen();MIDI.Player.playing||(Piano.clearNotes(),Piano.func(),Piano.inversion=0)},selected:Piano.HSL,title:"Synesthesia"});a("Synesthesia:",b,!0)};b.drawInstruments=function(){String(MIDI.getInstruments()).split("|").splice(0,128);var c={},k="",m;for(m in MIDI.instruments){var g=MIDI.instruments[m];
g.instrument&&(k!=g.category&&(k=g.category,c[k]=null),c[g.instrument]=m)}a("Instrument",e({arr:c,id:"voice",title:"Instruments",callback:function(a){Piano.clearNotes();b.instrument=a.options[a.selectedIndex].value;MIDI.Plugin&&MIDI.programChange(b.channel,c[b.instrument]);MIDI.Player.playing||Piano.func()},selected:b.instrument}))};b.drawChannels=function(){for(var d={},k=0;16>k;k++)d[k+" "]=k;k=document.createElement("div");k.style.cssText="display: inline-block;";k.appendChild(e({arr:d,header:{Channels:null},
id:"channel",callback:function(a){b.channel=parseInt(a.options[a.selectedIndex].value);a=MIDI.channels[b.channel];document.getElementById("mute").checked=a.mute?"checked":"";document.getElementById("voice").selectedIndex=a.instrument},selected:0,title:"Channels"}));k.appendChild(c({title:"Mute channel",id:"mute",checked:!1,value:"Mute channel",callback:function(){Piano.clearNotes();MIDI.channels[b.channel].mute=this.checked;MIDI.setMute(b.channel,this.checked)}}));a("Channels",k)};var a=function(a,
b,c){var e=document.getElementById("tools"),f=document.createElement("span");f.innerHTML=a;!1!==c&&e.appendChild(document.createElement("hr"));e.appendChild(f);e.appendChild(b)},c=function(a){a||(a={});var b=document.createElement("input");b.title=a.title;b.id=a.id;b.type="checkbox";b.value=a.value;b.checked=a.checked?a.checked:"";b.onmousedown=function(a){Event.stop(a)};b.onclick=a.callback;return b},e=function(a){var b=document.createElement("select");b.id=a.id;b.title=a.title;b.onmousedown=function(a){Event.stop(a)};
b.onchange=function(b){a.callback(this,b);this.blur()};if(a.header){var c=a.header,e;for(e in a.arr)c[e]=a.arr[e];a.arr=c}for(e in a.arr)null===a.arr[e]?(c=document.createElement("optgroup"),c.label="-"+e.toUpperCase()+"-"):(c=document.createElement("option"),a.selected==e&&(c.selected=!0),c.value=e,c.text=e),b.appendChild(c);return b}})(MIDI.UI);
