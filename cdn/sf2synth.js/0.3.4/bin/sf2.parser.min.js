/*! For license information please see sf2.parser.min.js.LICENSE */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SoundFont",[],t):"object"==typeof exports?exports.SoundFont=t():e.SoundFont=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e,t={}){this.input=e,this.ip=t.index||0,this.length=t.length||e.length-this.ip,this.chunkList,this.offset=this.ip,this.padding=void 0===t.padding||t.padding,this.bigEndian=void 0!==t.bigEndian&&t.bigEndian}parse(){const e=this.length+this.offset;for(this.chunkList=[];this.ip<e;)this.parseChunk()}parseChunk(){const e=this.input;let t,n=this.ip;this.chunkList.push(new o(String.fromCharCode(e[n++],e[n++],e[n++],e[n++]),t=this.bigEndian?(e[n++]<<24|e[n++]<<16|e[n++]<<8|e[n++])>>>0:(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,n)),n+=t,this.padding&&1==(n-this.offset&1)&&n++,this.ip=n}getChunk(e){const t=this.chunkList[e];return void 0===t?null:t}getNumberOfChunks(){return this.chunkList.length}}class o{constructor(e,t,n){this.type=e,this.size=t,this.offset=n}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Parser",(function(){return o}));var r=n(0);class o{constructor(e,t={}){this.input=e,this.parserOption=t.parserOption||{},this.sampleRate=t.sampleRate||22050,this.presetHeader,this.presetZone,this.presetZoneModulator,this.presetZoneGenerator,this.instrument,this.instrumentZone,this.instrumentZoneModulator,this.instrumentZoneGenerator,this.sampleHeader,this.GeneratorEnumeratorTable=["startAddrsOffset","endAddrsOffset","startloopAddrsOffset","endloopAddrsOffset","startAddrsCoarseOffset","modLfoToPitch","vibLfoToPitch","modEnvToPitch","initialFilterFc","initialFilterQ","modLfoToFilterFc","modEnvToFilterFc","endAddrsCoarseOffset","modLfoToVolume",,"chorusEffectsSend","reverbEffectsSend","pan",,,,"delayModLFO","freqModLFO","delayVibLFO","freqVibLFO","delayModEnv","attackModEnv","holdModEnv","decayModEnv","sustainModEnv","releaseModEnv","keynumToModEnvHold","keynumToModEnvDecay","delayVolEnv","attackVolEnv","holdVolEnv","decayVolEnv","sustainVolEnv","releaseVolEnv","keynumToVolEnvHold","keynumToVolEnvDecay","instrument",,"keyRange","velRange","startloopAddrsCoarseOffset","keynum","velocity","initialAttenuation",,"endloopAddrsCoarseOffset","coarseTune","fineTune","sampleID","sampleModes",,"scaleTuning","exclusiveClass","overridingRootKey","endOper"]}parse(){const e=new r.a(this.input,this.parserOption);if(e.parse(),1!==e.chunkList.length)throw new Error("wrong chunk length");const t=e.getChunk(0);if(null===t)throw new Error("chunk not found");this.parseRiffChunk(t),this.input=null}parseRiffChunk(e){const t=this.input;let n=e.offset;if("RIFF"!==e.type)throw new Error("invalid chunk type:"+e.type);const o=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("sfbk"!==o)throw new Error("invalid signature:"+o);const s=new r.a(t,{index:n,length:e.size-4});if(s.parse(),3!==s.getNumberOfChunks())throw new Error("invalid sfbk structure");this.parseInfoList(s.getChunk(0)),this.parseSdtaList(s.getChunk(1)),this.parsePdtaList(s.getChunk(2))}parseInfoList(e){const t=this.input;let n=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);const o=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("INFO"!==o)throw new Error("invalid signature:"+o);new r.a(t,{index:n,length:e.size-4}).parse()}parseSdtaList(e){const t=this.input;let n=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);const o=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("sdta"!==o)throw new Error("invalid signature:"+o);const s=new r.a(t,{index:n,length:e.size-4});if(s.parse(),1!==s.chunkList.length)throw new Error("TODO");this.samplingData=s.getChunk(0)}parsePdtaList(e){const t=this.input;let n=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);const o=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("pdta"!==o)throw new Error("invalid signature:"+o);const s=new r.a(t,{index:n,length:e.size-4});if(s.parse(),9!==s.getNumberOfChunks())throw new Error("invalid pdta chunk");this.parsePhdr(s.getChunk(0)),this.parsePbag(s.getChunk(1)),this.parsePmod(s.getChunk(2)),this.parsePgen(s.getChunk(3)),this.parseInst(s.getChunk(4)),this.parseIbag(s.getChunk(5)),this.parseImod(s.getChunk(6)),this.parseIgen(s.getChunk(7)),this.parseShdr(s.getChunk(8))}parsePhdr(e){const t=this.input;let n=e.offset;const r=this.presetHeader=[],o=e.offset+e.size;if("phdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<o;)r.push({presetName:String.fromCharCode.apply(null,t.subarray(n,n+=20)),preset:t[n++]|t[n++]<<8,bank:t[n++]|t[n++]<<8,presetBagIndex:t[n++]|t[n++]<<8,library:(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,genre:(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,morphology:(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0})}parsePbag(e){const t=this.input;let n=e.offset;const r=this.presetZone=[],o=e.offset+e.size;if("pbag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<o;)r.push({presetGeneratorIndex:t[n++]|t[n++]<<8,presetModulatorIndex:t[n++]|t[n++]<<8})}parsePmod(e){if("pmod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneModulator=this.parseModulator(e)}parsePgen(e){if("pgen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneGenerator=this.parseGenerator(e)}parseInst(e){const t=this.input;let n=e.offset;const r=this.instrument=[],o=e.offset+e.size;if("inst"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<o;)r.push({instrumentName:String.fromCharCode.apply(null,t.subarray(n,n+=20)),instrumentBagIndex:t[n++]|t[n++]<<8})}parseIbag(e){const t=this.input;let n=e.offset;const r=this.instrumentZone=[],o=e.offset+e.size;if("ibag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<o;)r.push({instrumentGeneratorIndex:t[n++]|t[n++]<<8,instrumentModulatorIndex:t[n++]|t[n++]<<8})}parseImod(e){if("imod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneModulator=this.parseModulator(e)}parseIgen(e){if("igen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneGenerator=this.parseGenerator(e)}parseShdr(e){const t=this.input;let n=e.offset;const r=this.sample=[],o=this.sampleHeader=[],s=e.offset+e.size;let i,a,u,h,p,l,d,f,c,m;if("shdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<s;){i=String.fromCharCode.apply(null,t.subarray(n,n+=20)),a=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,u=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,h=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,p=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,l=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,d=t[n++],f=t[n++]<<24>>24,c=t[n++]|t[n++]<<8,m=t[n++]|t[n++]<<8;let e=new Int16Array(new Uint8Array(t.subarray(this.samplingData.offset+2*a,this.samplingData.offset+2*u)).buffer);if(h-=a,p-=a,l>0){const t=this.adjustSampleData(e,l);e=t.sample,l*=t.multiply,h*=t.multiply,p*=t.multiply}r.push(e),o.push({sampleName:i,start:a,end:u,startLoop:h,endLoop:p,sampleRate:l,originalPitch:d,pitchCorrection:f,sampleLink:c,sampleType:m})}}adjustSampleData(e,t){let n,r,o,s,i=1;for(;t<this.sampleRate;){for(n=new Int16Array(2*e.length),r=s=0,o=e.length;r<o;++r)n[s++]=e[r],n[s++]=e[r];e=n,i*=2,t*=2}return{sample:e,multiply:i}}parseModulator(e){const t=this.input;let n=e.offset;const r=e.offset+e.size;let o,s;const i=[];for(;n<r;){if(n+=2,o=t[n++]|t[n++]<<8,s=this.GeneratorEnumeratorTable[o],void 0===s)i.push({type:s,value:{code:o,amount:t[n]|t[n+1]<<8<<16>>16,lo:t[n++],hi:t[n++]}});else switch(s){case"keyRange":case"velRange":case"keynum":case"velocity":i.push({type:s,value:{lo:t[n++],hi:t[n++]}});break;default:i.push({type:s,value:{amount:t[n++]|t[n++]<<8<<16>>16}})}n+=2,n+=2}return i}parseGenerator(e){const t=this.input;let n=e.offset;const r=e.offset+e.size;let o,s;const i=[];for(;n<r;)if(o=t[n++]|t[n++]<<8,s=this.GeneratorEnumeratorTable[o],void 0!==s)switch(s){case"keynum":case"keyRange":case"velRange":case"velocity":i.push({type:s,value:{lo:t[n++],hi:t[n++]}});break;default:i.push({type:s,value:{amount:t[n++]|t[n++]<<8<<16>>16}})}else i.push({type:s,value:{code:o,amount:t[n]|t[n+1]<<8<<16>>16,lo:t[n++],hi:t[n++]}});return i}createInstrument(){const e=this.instrument,t=this.instrumentZone,n=[];let r,o,s,i,a,u,h,p,l;for(u=0,h=e.length;u<h;++u){for(r=e[u].instrumentBagIndex,o=e[u+1]?e[u+1].instrumentBagIndex:t.length,s=[],p=r,l=o;p<l;++p)i=this.createInstrumentGenerator_(t,p),a=this.createInstrumentModulator_(t,p),s.push({generator:i.generator,generatorSequence:i.generatorInfo,modulator:a.modulator,modulatorSequence:a.modulatorInfo});n.push({name:e[u].instrumentName,info:s})}return n}createPreset(){const e=this.presetHeader,t=this.presetZone,n=[];let r,o,s,i,a,u,h,p,l,d;for(h=0,p=e.length;h<p;++h){for(r=e[h].presetBagIndex,o=e[h+1]?e[h+1].presetBagIndex:t.length,s=[],l=r,d=o;l<d;++l)a=this.createPresetGenerator_(t,l),u=this.createPresetModulator_(t,l),s.push({generator:a.generator,generatorSequence:a.generatorInfo,modulator:u.modulator,modulatorSequence:u.modulatorInfo}),i=void 0!==a.generator.instrument?a.generator.instrument.amount:void 0!==u.modulator.instrument?u.modulator.instrument.amount:null;n.push({name:e[h].presetName,info:s,header:e[h],instrument:i})}return n}createInstrumentGenerator_(e,t){const n=this.createBagModGen_(e,e[t].instrumentGeneratorIndex,e[t+1]?e[t+1].instrumentGeneratorIndex:this.instrumentZoneGenerator.length,this.instrumentZoneGenerator);return{generator:n.modgen,generatorInfo:n.modgenInfo}}createInstrumentModulator_(e,t){const n=this.createBagModGen_(e,e[t].presetModulatorIndex,e[t+1]?e[t+1].instrumentModulatorIndex:this.instrumentZoneModulator.length,this.instrumentZoneModulator);return{modulator:n.modgen,modulatorInfo:n.modgenInfo}}createPresetGenerator_(e,t){const n=this.createBagModGen_(e,e[t].presetGeneratorIndex,e[t+1]?e[t+1].presetGeneratorIndex:this.presetZoneGenerator.length,this.presetZoneGenerator);return{generator:n.modgen,generatorInfo:n.modgenInfo}}createPresetModulator_(e,t){const n=this.createBagModGen_(e,e[t].presetModulatorIndex,e[t+1]?e[t+1].presetModulatorIndex:this.presetZoneModulator.length,this.presetZoneModulator);return{modulator:n.modgen,modulatorInfo:n.modgenInfo}}createBagModGen_(e,t,n,r){const o=[],s={unknown:[],keyRange:{hi:127,lo:0}};let i,a,u;for(a=t,u=n;a<u;++a)i=r[a],o.push(i),"unknown"===i.type?s.unknown.push(i.value):s[i.type]=i.value;return{modgen:s,modgenInfo:o}}}t.default=o}])}));