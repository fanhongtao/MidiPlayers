{"version":3,"sources":["webpack://SoundFont/webpack/universalModuleDefinition","webpack://SoundFont/webpack/bootstrap","webpack://SoundFont/./node_modules/@logue/reverb/bin/reverb.js","webpack://SoundFont/./src/meta.js","webpack://SoundFont/./src/riff.js","webpack://SoundFont/./src/sf2.js","webpack://SoundFont/./src/sound_font_synth.js","webpack://SoundFont/./src/sound_font_synth_note.js","webpack://SoundFont/./src/wml.js"],"names":["Meta","version","date","Riff","constructor","input","optParams","ip","index","length","chunkList","offset","padding","bigEndian","parse","parseChunk","size","push","RiffChunk","String","fromCharCode","getChunk","chunk","getNumberOfChunks","type","Parser","parserOption","sampleRate","presetHeader","presetZone","presetZoneModulator","presetZoneGenerator","instrument","instrumentZone","instrumentZoneModulator","instrumentZoneGenerator","sampleHeader","GeneratorEnumeratorTable","parser","Error","parseRiffChunk","data","signature","parseInfoList","parseSdtaList","parsePdtaList","samplingData","parsePhdr","parsePbag","parsePmod","parsePgen","parseInst","parseIbag","parseImod","parseIgen","parseShdr","presetName","apply","subarray","preset","bank","presetBagIndex","library","genre","morphology","presetGeneratorIndex","presetModulatorIndex","parseModulator","parseGenerator","instrumentName","instrumentBagIndex","instrumentGeneratorIndex","instrumentModulatorIndex","samples","sample","sampleName","start","end","startLoop","endLoop","originalPitch","pitchCorrection","sampleLink","sampleType","Int16Array","Uint8Array","buffer","adjust","adjustSampleData","multiply","newSample","i","il","j","code","key","output","value","amount","lo","hi","createInstrument","zone","bagIndex","bagIndexEnd","zoneInfo","instrumentGenerator","instrumentModulator","jl","createInstrumentGenerator_","createInstrumentModulator_","generator","generatorSequence","generatorInfo","modulator","modulatorSequence","modulatorInfo","name","info","createPreset","presetGenerator","presetModulator","createPresetGenerator_","createPresetModulator_","header","modgen","createBagModGen_","modgenInfo","indexStart","indexEnd","zoneModGen","unknown","Synthesizer","bankSet","bufferSize","ctx","getAudioContext","gainMaster","createGain","bufSrc","createBufferSource","channelInstrument","channelBank","channelVolume","channelPanpot","channelPitchBend","channelPitchBendSensitivity","channelExpression","channelAttack","channelDecay","channelSustin","channelRelease","channelHold","channelHarmonicContent","channelCutOffFrequency","isGS","isXG","programSet","channelMute","currentNoteOn","baseVolume","masterVolume","percussionPart","percussionVolume","Array","reverb","Reverb","mix","observer","IntersectionObserver","entries","object","forEach","entry","target","dataset","isIntersecting","window","AudioContext","webkitAudioContext","createGainNode","initAudioContext","document","removeEventListener","emptySource","stop","addEventListener","init","mode","disconnect","createAllInstruments","programChange","volumeChange","panpotChange","pitchBend","pitchBendSensitivity","attackTime","decayTime","sustinTime","releaseTime","harmonicContent","cutOffFrequency","reverbDepth","updateBankSelect","updateProgramSelect","setPercussionPart","connect","destination","element","close","refreshInstruments","presets","instruments","banks","bankNumber","presetNumber","replace","createNoteInfo","volDelay","getModGenAmount","volAttack","volHold","volDecay","volSustain","volRelease","modDelay","modAttack","modHold","modDecay","modSustain","modRelease","scale","freqVibLFO","pan","tune","sampleId","enumeratorType","optDefault","setMasterVolume","volume","gain","drawSynth","doc","wrapper","createElement","instElem","className","items","eventStart","eventEnd","channel","channelElem","item","hasOwnProperty","call","itemElem","checkboxElement","checkbox","setAttribute","id","synth","mute","checked","appendChild","labelElem","textContent","bankSelect","option","event","bankChange","channelElemInstrument","selectedIndex","select","innerText","panpot","min","max","pitch","keyElem","n","includes","k","preventDefault","drag","noteOn","noteOff","observe","updateSynthElement","velocity","querySelector","classList","contains","remove","style","opacity","add","toFixed","bankElement","firstChild","removeChild","bankNo","parseInt","slice","bankIndex","programElement","programNo","selected","console","warn","instrumentKey","Math","round","note","SynthesizerNote","hold","release","splice","isNoteOff","channelElement","bankSelectMsb","bankSelectLsb","expression","updateExpression","lowerByte","higherByte","bend","calculated","updatePitchBend","sensitivity","depth","getPitchBendSensitivity","drumInstrumentLevel","allNoteOff","allSoundOff","shift","resetAllControl","sw","playbackRate","loopStart","loopEnd","modEnvToPitch","hermonicContent","startTime","currentTime","computedPlaybackRate","noteOffState","audioBuffer","bufferSource","panner","createPanner","outputGainNode","expressionGainNode","filter","createBiquadFilter","now","createBuffer","channelData","getChannelData","set","loop","panningModel","setPosition","sin","PI","cos","outputGain","setValueAtTime","setTargetAtTime","linearRampToValueAtTime","baseFreq","amountToFreq","peekFreq","sustainFreq","Q","frequency","parseFloat","val","volEndTimeTmp","volEndTime","modEndTime","cancelScheduledValues","log","schedulePlaybackRate","computed","peekPitch","WebMidiLink","NrpnMsb","NrpnLsb","RpnMsb","RpnLsb","ready","loadCallback","messageHandler","onmessage","bind","xhr","rpnMode","cache","placeholder","getElementById","body","opener","build","setup","url","w","onload","load","parent","loading","loadingText","self","postMessage","stream","caches","spiner","role","ariaHidden","open","then","match","response","arrayBuffer","catch","fetch","ok","total","headers","get","copy","clone","put","e","error","alert","message","progress","progressBar","concatenation","segments","sumLength","byteLength","whole","pos","res","reader","getReader","processResult","result","done","percentage","width","read","setReverb","loadSoundFont","ev","msg","split","command","processMidiMessage","map","hex","setLoadCallback","callback","part"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;AACA,IAAI,IAAyD;AAC7D;AACA,MAAM,EAKuB;AAC7B,CAAC;AACD,oCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,gCAAgC;AAClF;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE,kBAAkB;AAClF;AACA,yDAAyD,cAAc;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,iCAAiC;AAClF,wHAAwH,mBAAmB,EAAE;AAC7I;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,0BAA0B,EAAE;AAC/D,yCAAyC,eAAe;AACxD;AACA;AACA;AACA;AACA;AACA,8DAA8D,+DAA+D;AAC7H;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,iGAAiG,eAAe,EAAE;AAClH;AACA,iDAAiD,0CAA0C,0DAA0D,EAAE;;AAEvJ,2CAA2C,gBAAgB,kBAAkB,OAAO,2BAA2B,wDAAwD,gCAAgC,uDAAuD,2DAA2D,EAAE;;AAE3T,6DAA6D,sEAAsE,8DAA8D,oBAAoB;;;AAGrN;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,eAAe;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa,aAAa;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA,eAAe,OAAO;AACtB;AACA,eAAe,KAAK;;AAEpB;AACA,eAAe,aAAa;;AAE5B;AACA,eAAe,SAAS;;AAExB;AACA,eAAe,SAAS;;AAExB;AACA,eAAe,iBAAiB;;AAEhC;AACA,eAAe,cAAc;;AAE7B;AACA,eAAe,SAAS;;AAExB,4CAA4C;;AAE5C,eAAe,OAAO;;AAEtB;AACA,eAAe,OAAO;;AAEtB;AACA,eAAe,QAAQ;;AAEvB;AACA,eAAe,OAAO;;AAEtB;AACA,eAAe,sBAAsB;;AAErC;AACA,eAAe,OAAO;;AAEtB;AACA,eAAe,OAAO;;AAEtB;AACA,eAAe,OAAO;;AAEtB,mCAAmC;;AAEnC;AACA;AACA;AACA,gCAAgC;;AAEhC;AACA;AACA;AACA;AACA,eAAe,KAAK;;AAEpB;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB,cAAc;AACd;;;AAGA;AACA;AACA;AACA,8BAA8B;;AAE9B,kDAAkD;;AAElD,gDAAgD;;AAEhD,6CAA6C;;AAE7C,oEAAoE;;AAEpE;AACA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB,gBAAgB;AAChB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,uDAAuD;;AAEvD,qDAAqD;;AAErD,kDAAkD;;AAElD,4EAA4E;;AAE5E;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,sBAAsB;AACrC;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB,eAAe,OAAO;AACtB,eAAe,OAAO;AACtB,gBAAgB;AAChB;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAG;AACH;AACA;AACA;;AAEA,iBAAiB,OAAO;AACxB;AACA,iBAAiB,OAAO;;AAExB;AACA,iBAAiB,OAAO;;AAExB;AACA,iBAAiB,YAAY;;AAE7B;AACA,iBAAiB,8BAA8B;;AAE/C;AACA,iBAAiB,8BAA8B;;AAE/C;;AAEA,qBAAqB,YAAY;AACjC,mBAAmB,OAAO;AAC1B;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,mBAAmB,OAAO;;;AAG1B;AACA;AACA;AACA,OAAO;;;AAGP;AACA;AACA;AACA;AACA;AACA;AA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","file":"sf2.synth.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"SoundFont\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SoundFont\"] = factory();\n\telse\n\t\troot[\"SoundFont\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/wml.js\");\n","/*! @logue/reverb v0.2.1 | Logue | license: MIT | build: 2019-12-26T15:48:03.337Z */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Reverb\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Reverb\"] = factory();\n\telse\n\t\troot[\"Reverb\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/reverb.js\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/meta.js\":\n/*!*********************!*\\\n  !*** ./src/meta.js ***!\n  \\*********************/\n/*! exports provided: default */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n// This file is auto-generated by the build system.\nvar Meta = {\n  version: '0.2.1',\n  date: '2019-12-26T15:48:03.337Z'\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (Meta);\n\n/***/ }),\n\n/***/ \"./src/reverb.js\":\n/*!***********************!*\\\n  !*** ./src/reverb.js ***!\n  \\***********************/\n/*! exports provided: default */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return Reverb; });\n/* harmony import */ var _meta__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./meta */ \"./src/meta.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n\n/**\n * JS reverb effect class\n *\n * @author    Logue <logue@hotmail.co.jp>\n * @copyright 2019 Masashi Yoshikawa <https://logue.dev/> All rights reserved.\n * @license   MIT\n * @see       {@link https://github.com/logue/Reverb.js}\n *            {@link https://github.com/web-audio-components/simple-reverb}\n */\n\nvar Reverb =\n/*#__PURE__*/\nfunction () {\n  /**\n   * constructor\n   * @param {AudioContext} ctx\n   * @param {{\n   *   decay: (number|undefined),\n   *   delay: (number|undefined),\n   *   filterFreq: (number|undefined),\n   *   filterQ: (number|undefined),\n   *   filterType: (string|undefined),\n   *   mix: (number|undefined),\n   *   reverse: (boolean|undefined),\n   *   time: (number|undefined)\n   * }} options\n   */\n  function Reverb(ctx) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Reverb);\n\n    /** @type {number} バージョン */\n    this.version = _meta__WEBPACK_IMPORTED_MODULE_0__[\"default\"].version;\n    /** @type {Date} ビルド日時 */\n\n    this.build = _meta__WEBPACK_IMPORTED_MODULE_0__[\"default\"].date;\n    /** @type {AudioContext} */\n\n    this.ctx = ctx;\n    /** @type {GainNode} ウェットレベル */\n\n    this.wetGainNode = this.ctx.createGain();\n    /** @type {GainNode} ドライレベル */\n\n    this.dryGainNode = this.ctx.createGain();\n    /** @type {BiquadFilterNode} インパルス応答用フィルタ */\n\n    this.filterNode = this.ctx.createBiquadFilter();\n    /** @type {ConvolverNode} 畳み込みノード */\n\n    this.convolverNode = this.ctx.createConvolver();\n    /** @type {GainNode} 出力ノード */\n\n    this.outputNode = this.ctx.createGain(); // デフォルト値\n\n    /** @type {number} ディケイ */\n\n    this._decay = options.decay | 0 || 5;\n    /** @type {number} ディレイ */\n\n    this._delay = options.delay | 0 || 0;\n    /** @type {boolean} レスポンス応答を反転 */\n\n    this._reverse = options.reverse || false;\n    /** @type {number} レスポンス応答の時間（秒） */\n\n    this._time = options.time | 0 || 3;\n    /** @type {BiquadFilterNode|null} フィルタの種類 */\n\n    this._filterType = options.filterType || 'lowpass';\n    /** @type {number} フィルタ周波数(Hz) */\n\n    this._freq = options.filterFreq | 0 || 2200;\n    /** @type {number} フィルタ品質 */\n\n    this._q = options.filterQ | 0 || 1;\n    /** @type {number} ドライ／ウェット比 */\n\n    this._mix = options.mix || 0.5; // 値をセット\n\n    this.time(this._time);\n    this.delay(this._delay);\n    this.decay(this._decay);\n    this.reverse(this._reverse); // エフェクタに反映\n\n    this.filterType(this._filterType);\n    this.filterFreq(this._freq);\n    this.filterQ(this._q);\n    this.mix(this._mix);\n    /** @type {bool} 接続済みフラグ */\n\n    this.isConnected = false;\n    this.buildImpulse();\n  }\n  /**\n   * connect\n   * @param {GainNode} sourceNode\n   * @return {GainNode}\n   */\n\n\n  _createClass(Reverb, [{\n    key: \"connect\",\n    value: function connect(sourceNode) {\n      this.isConnected = true; // 畳み込みノードをウェットレベルに接続\n\n      this.convolverNode.connect(this.filterNode); // フィルタノードをウェットレベルに接続\n\n      this.filterNode.connect(this.wetGainNode); // 入力ノードを畳み込みノードに接続\n\n      sourceNode.connect(this.convolverNode); // ドライレベルを出力ノードに接続\n\n      sourceNode.connect(this.dryGainNode).connect(this.outputNode); // ウェットレベルを出力ノードに接続\n\n      sourceNode.connect(this.wetGainNode).connect(this.outputNode);\n      return this.outputNode;\n    }\n    /**\n     * disconnect\n     * @param {GainNode} sourceNode\n     * @return {GainNode}\n     */\n\n  }, {\n    key: \"disconnect\",\n    value: function disconnect(sourceNode) {\n      // 初期状態で接続されていない可能性があるためエラーを消す\n      try {\n        // 畳み込みノードをウェットレベルから切断\n        this.convolverNode.disconnect(this.filterNode); // フィルタノードをウェットレベルから切断\n\n        this.filterNode.disconnect(this.wetGainNode); // 入力ノードを畳み込みノードから切断\n\n        sourceNode.disconnect(this.convolverNode); // ドライレベルを出力ノードから切断\n\n        sourceNode.disconnect(this.dryGainNode).disconnect(this.outputNode); // ウェットレベルを出力ノードから切断\n\n        sourceNode.disconnect(this.wetGainNode).disconnect(this.outputNode);\n      } catch (e) {}\n\n      this.isConnected = false;\n      return sourceNode;\n    }\n    /**\n     * Mixing Dry and Wet Level.\n     * @param {number} mix\n     */\n\n  }, {\n    key: \"mix\",\n    value: function mix(_mix) {\n      if (!this.inRange(_mix, 0, 1)) {\n        console.warn('Dry/Wet level must be between 0 to 1.');\n        return;\n      }\n\n      this._mix = _mix;\n      this.dryGainNode.gain.value = 1 - this._mix;\n      this.wetGainNode.gain.value = this._mix;\n      console.info(\"Set dry/wet level to \".concat(_mix * 100, \"%\"));\n    }\n    /**\n     * Set Impulse Response time length (second)\n     * @param {number} value\n     */\n\n  }, {\n    key: \"time\",\n    value: function time(value) {\n      if (!this.inRange(value, 1, 50)) {\n        console.warn('Time length of inpulse response must be less than 50sec.');\n        return;\n      }\n\n      this._time = value;\n      this.buildImpulse();\n      console.info(\"Set inpulse response time length to \".concat(value, \"sec.\"));\n    }\n    /**\n     * Impulse response decay rate.\n     * @param {number} value\n     */\n\n  }, {\n    key: \"decay\",\n    value: function decay(value) {\n      if (!this.inRange(value, 0, 100)) {\n        console.warn('Inpulse Response decay level must be less than 100.');\n        return;\n      }\n\n      this._decay = value;\n      this.buildImpulse();\n      console.info(\"Set inpulse response decay level to \".concat(value, \".\"));\n    }\n    /**\n     * Impulse response delay time. (NOT deley effect)\n     * @param {number} value\n     */\n\n  }, {\n    key: \"delay\",\n    value: function delay(value) {\n      if (!this.inRange(value, 0, 100)) {\n        console.warn('Inpulse Response delay time must be less than 100.');\n        return;\n      }\n\n      this._delay = value;\n      this.buildImpulse();\n      console.info(\"Set inpulse response delay time to \".concat(value, \"sec.\"));\n    }\n    /**\n     * Reverse the impulse response.\n     * @param {boolean} reverse\n     */\n\n  }, {\n    key: \"reverse\",\n    value: function reverse(_reverse) {\n      this._reverse = _reverse;\n      this.buildImpulse();\n      console.info(\"Inpulse response is \".concat(_reverse ? '' : 'not ', \"reversed.\"));\n    }\n    /**\n     * Filter type.\n     * @param {BiquadFilterNode|null} type\n     */\n\n  }, {\n    key: \"filterType\",\n    value: function filterType(type) {\n      this.filterNode.type = this._filterType = type;\n      console.info(\"Set filter type to \".concat(type));\n    }\n    /**\n     * Filter frequency.\n     * @param {number} freq\n     */\n\n  }, {\n    key: \"filterFreq\",\n    value: function filterFreq(freq) {\n      if (!this.inRange(freq, 20, 5000)) {\n        console.warn('Filter frequrncy must be between 20 and 5000.');\n        return;\n      }\n\n      this._freq = freq;\n      this.filterNode.frequency.value = this._freq;\n      console.info(\"Set filter frequency to \".concat(freq, \"Hz.\"));\n    }\n    /**\n     * Filter quality.\n     * @param {number} q\n     */\n\n  }, {\n    key: \"filterQ\",\n    value: function filterQ(q) {\n      if (!this.inRange(q, 0, 10)) {\n        console.warn('Filter quality value must be between 0 and 1.');\n        return;\n      }\n\n      this._q = q;\n      this.filterNode.Q.value = this._q;\n      console.info(\"Set filter quality to \".concat(q, \".\"));\n    }\n    /**\n     * return true if in range, otherwise false\n     * @private\n     * @param {number} x Target value\n     * @param {number} min Minimum value\n     * @param {number} max Maximum value\n     * @return {bool}\n     */\n\n  }, {\n    key: \"inRange\",\n    value: function inRange(x, min, max) {\n      return (x - min) * (x - max) <= 0;\n    }\n    /**\n     * Utility function for building an impulse response\n     * from the module parameters.\n     * @private\n     */\n\n  }, {\n    key: \"buildImpulse\",\n    value: function buildImpulse() {\n      // インパルス応答生成ロジック\n\n      /** @type {number} サンプリングレート */\n      var rate = this.ctx.sampleRate;\n      /** @type {number} インパルス応答の演奏時間 */\n\n      var length = Math.max(rate * this._time, 1);\n      /** @type {number} インパルス応答が始まるまでの遅延時間 */\n\n      var delayDuration = rate * this._delay;\n      /** @type {AudioBuffer} インパルス応答バッファ（今の所ステレオのみ） */\n\n      var impulse = this.ctx.createBuffer(2, length, rate);\n      /** @type {Array<number>|ArrayBufferView} 左チャンネル */\n\n      var impulseL = new Float32Array(length);\n      /** @type {Array<number>|ArrayBufferView} 右チャンネル*/\n\n      var impulseR = new Float32Array(length);\n\n      for (var i = 0; i < length; i++) {\n        /** @type {number} */\n        var n = 0;\n\n        if (i < delayDuration) {\n          // Delay Effect\n          impulseL[i] = 0;\n          impulseR[i] = 0;\n          n = this._reverse ? length - (i - delayDuration) : i - delayDuration;\n        } else {\n          n = this._reverse ? length - i : i;\n        }\n        /** @type {number} 平方根を利用した減衰曲線 */\n\n\n        var pow = Math.pow(1 - n / length, this._decay);\n        impulseL[i] = this.getNoise(pow);\n        impulseR[i] = this.getNoise(pow);\n      } // インパルス応答のバッファに生成したWaveTableを代入\n\n\n      impulse.getChannelData(0).set(impulseL);\n      impulse.getChannelData(1).set(impulseR);\n      this.convolverNode.buffer = impulse;\n    }\n    /**\n     * Generate white noise\n     * @param {number} rate Attenuation rate\n     * @return {number}\n     * @private\n     */\n\n  }, {\n    key: \"getNoise\",\n    value: function getNoise(rate) {\n      // TODO: 他のカラードノイズを指定できるように\n      return (Math.random() * 2 - 1) * rate;\n    }\n  }]);\n\n  return Reverb;\n}();\n\n\n;\n\n/***/ })\n\n/******/ });\n});\n//# sourceMappingURL=reverb.js.map","// This file is auto-generated by the build system.\nconst Meta = {\n  version: '0.3.4',\n  date: '2019-12-26T16:24:37.934Z',\n};\nexport default Meta;\n","/**\n * Riff Parser class\n * @private\n */\nexport default class Riff {\n  /**\n   * @param {ByteArray} input input buffer.\n   * @param {Object=} optParams option parameters.\n   */\n  constructor(input, optParams = {}) {\n    /** @type {ByteArray} */\n    this.input = input;\n    /** @type {number} */\n    this.ip = optParams.index || 0;\n    /** @type {number} */\n    this.length = optParams.length || input.length - this.ip;\n    /** @type {Array.<RiffChunk>} */\n    this.chunkList;\n    /** @type {number} */\n    this.offset = this.ip;\n    /** @type {boolean} */\n    this.padding =\n      optParams.padding !== void 0 ? optParams.padding : true;\n    /** @type {boolean} */\n    this.bigEndian =\n      optParams.bigEndian !== void 0 ? optParams.bigEndian : false;\n  }\n\n  /**\n   */\n  parse() {\n    /** @type {number} */\n    const length = this.length + this.offset;\n\n    this.chunkList = [];\n\n    while (this.ip < length) {\n      this.parseChunk();\n    }\n  }\n\n  /**\n   */\n  parseChunk() {\n    /** @type {ByteArray} */\n    const input = this.input;\n    /** @type {number} */\n    let ip = this.ip;\n    /** @type {number} */\n    let size;\n\n    this.chunkList.push(new RiffChunk(\n      String.fromCharCode(input[ip++], input[ip++], input[ip++], input[ip++]),\n      (size = this.bigEndian ?\n        ((input[ip++] << 24) | (input[ip++] << 16) |\n          (input[ip++] << 8) | (input[ip++])) >>> 0 :\n        ((input[ip++]) | (input[ip++] << 8) |\n          (input[ip++] << 16) | (input[ip++] << 24)) >>> 0\n      ),\n      ip,\n    ));\n\n    ip += size;\n\n    // padding\n    if (this.padding && ((ip - this.offset) & 1) === 1) {\n      ip++;\n    }\n\n    this.ip = ip;\n  }\n\n  /**\n   * @param {number} index chunk index.\n   * @return {?RiffChunk}\n   */\n  getChunk(index) {\n    /** @type {RiffChunk} */\n    const chunk = this.chunkList[index];\n\n    if (chunk === void 0) {\n      return null;\n    }\n\n    return chunk;\n  }\n\n  /**\n   * @return {number}\n   */\n  getNumberOfChunks() {\n    return this.chunkList.length;\n  }\n}\n\n/**\n * Riff Chunk Structure\n * @interface\n */\nclass RiffChunk {\n  /**\n   * @param {string} type\n   * @param {number} size\n   * @param {number} offset\n   */\n  constructor(type, size, offset) {\n    /** @type {string} */\n    this.type = type;\n    /** @type {number} */\n    this.size = size;\n    /** @type {number} */\n    this.offset = offset;\n  }\n}\n","import Riff from './riff.js';\n\n/**\n * SoundFont Parser Class\n */\nexport class Parser {\n  /**\n   * @param {ByteArray} input\n   * @param {Object=} optParams\n   */\n  constructor(input, optParams = {}) {\n    /** @type {ByteArray} */\n    this.input = input;\n    /** @type {(Object|undefined)} */\n    this.parserOption = optParams.parserOption || {};\n    /** @type {(Number|undefined)} */\n    this.sampleRate = optParams.sampleRate || 22050; // よくわからんが、OSで指定されているサンプルレートを入れないと音が切れ切れになる。\n\n    /** @type {Array.<Object>} */\n    this.presetHeader;\n    /** @type {Array.<Object>} */\n    this.presetZone;\n    /** @type {Array.<Object>} */\n    this.presetZoneModulator;\n    /** @type {Array.<Object>} */\n    this.presetZoneGenerator;\n    /** @type {Array.<Object>} */\n    this.instrument;\n    /** @type {Array.<Object>} */\n    this.instrumentZone;\n    /** @type {Array.<Object>} */\n    this.instrumentZoneModulator;\n    /** @type {Array.<Object>} */\n    this.instrumentZoneGenerator;\n    /** @type {Array.<Object>} */\n    this.sampleHeader;\n\n    /**\n     * @type {Array.<string>}\n     * @const\n     */\n    this.GeneratorEnumeratorTable = [\n      'startAddrsOffset',\n      'endAddrsOffset',\n      'startloopAddrsOffset',\n      'endloopAddrsOffset',\n      'startAddrsCoarseOffset',\n      'modLfoToPitch',\n      'vibLfoToPitch',\n      'modEnvToPitch',\n      'initialFilterFc',\n      'initialFilterQ',\n      'modLfoToFilterFc',\n      'modEnvToFilterFc',\n      'endAddrsCoarseOffset',\n      'modLfoToVolume', , // 14\n      'chorusEffectsSend',\n      'reverbEffectsSend',\n      'pan', , , , // 18,19,20\n      'delayModLFO',\n      'freqModLFO',\n      'delayVibLFO',\n      'freqVibLFO',\n      'delayModEnv',\n      'attackModEnv',\n      'holdModEnv',\n      'decayModEnv',\n      'sustainModEnv',\n      'releaseModEnv',\n      'keynumToModEnvHold',\n      'keynumToModEnvDecay',\n      'delayVolEnv',\n      'attackVolEnv',\n      'holdVolEnv',\n      'decayVolEnv',\n      'sustainVolEnv',\n      'releaseVolEnv',\n      'keynumToVolEnvHold',\n      'keynumToVolEnvDecay',\n      'instrument', , // 42\n      'keyRange',\n      'velRange',\n      'startloopAddrsCoarseOffset',\n      'keynum',\n      'velocity',\n      'initialAttenuation', , // 49\n      'endloopAddrsCoarseOffset',\n      'coarseTune',\n      'fineTune',\n      'sampleID',\n      'sampleModes', , // 55\n      'scaleTuning',\n      'exclusiveClass',\n      'overridingRootKey', // 59\n      'endOper',\n    ];\n  }\n\n  /** @export */\n  parse() {\n    /** @type {Riff} */\n    const parser = new Riff(this.input, this.parserOption);\n\n    // parse RIFF chunk\n    parser.parse();\n    if (parser.chunkList.length !== 1) {\n      throw new Error('wrong chunk length');\n    }\n\n    /** @type {?RiffChunk} */\n    const chunk = parser.getChunk(0);\n    if (chunk === null) {\n      throw new Error('chunk not found');\n    }\n\n    this.parseRiffChunk(chunk);\n    // console.log(this.sampleHeader);\n    this.input = null;\n  }\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseRiffChunk(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'RIFF') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'sfbk') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n    if (parser.getNumberOfChunks() !== 3) {\n      throw new Error('invalid sfbk structure');\n    }\n\n    // INFO-list\n    this.parseInfoList( /** @type {!RiffChunk} */(parser.getChunk(0)));\n\n    // sdta-list\n    this.parseSdtaList( /** @type {!RiffChunk} */(parser.getChunk(1)));\n\n    // pdta-list\n    this.parsePdtaList( /** @type {!RiffChunk} */(parser.getChunk(2)));\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseInfoList(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'LIST') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'INFO') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseSdtaList(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'LIST') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'sdta') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n    if (parser.chunkList.length !== 1) {\n      throw new Error('TODO');\n    }\n    this.samplingData =\n      /** @type {{type: string, size: number, offset: number}} */\n      (parser.getChunk(0));\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePdtaList(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    // check parse target\n    if (chunk.type !== 'LIST') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    // check signature\n    /** @type {string} */\n    const signature = String.fromCharCode(data[ip++], data[ip++], data[ip++], data[ip++]);\n    if (signature !== 'pdta') {\n      throw new Error('invalid signature:' + signature);\n    }\n\n    // read structure\n    /** @type {Riff} */\n    const parser = new Riff(data, { 'index': ip, 'length': chunk.size - 4 });\n    parser.parse();\n\n    // check number of chunks\n    if (parser.getNumberOfChunks() !== 9) {\n      throw new Error('invalid pdta chunk');\n    }\n\n    this.parsePhdr( /** @type {RiffChunk} */(parser.getChunk(0)));\n    this.parsePbag( /** @type {RiffChunk} */(parser.getChunk(1)));\n    this.parsePmod( /** @type {RiffChunk} */(parser.getChunk(2)));\n    this.parsePgen( /** @type {RiffChunk} */(parser.getChunk(3)));\n    this.parseInst( /** @type {RiffChunk} */(parser.getChunk(4)));\n    this.parseIbag( /** @type {RiffChunk} */(parser.getChunk(5)));\n    this.parseImod( /** @type {RiffChunk} */(parser.getChunk(6)));\n    this.parseIgen( /** @type {RiffChunk} */(parser.getChunk(7)));\n    this.parseShdr( /** @type {RiffChunk} */(parser.getChunk(8)));\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePhdr(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const presetHeader = this.presetHeader = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'phdr') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      presetHeader.push({\n        presetName: String.fromCharCode.apply(null, data.subarray(ip, ip += 20)),\n        preset: data[ip++] | (data[ip++] << 8),\n        bank: data[ip++] | (data[ip++] << 8),\n        presetBagIndex: data[ip++] | (data[ip++] << 8),\n        library: (data[ip++] | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)) >>> 0,\n        genre: (data[ip++] | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)) >>> 0,\n        morphology: (data[ip++] | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)) >>> 0,\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePbag(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const presetZone = this.presetZone = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'pbag') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      presetZone.push({\n        presetGeneratorIndex: data[ip++] | (data[ip++] << 8),\n        presetModulatorIndex: data[ip++] | (data[ip++] << 8),\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePmod(chunk) {\n    // check parse target\n    if (chunk.type !== 'pmod') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    this.presetZoneModulator = this.parseModulator(chunk);\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parsePgen(chunk) {\n    // check parse target\n    if (chunk.type !== 'pgen') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n    this.presetZoneGenerator = this.parseGenerator(chunk);\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseInst(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const instrument = this.instrument = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'inst') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      instrument.push({\n        instrumentName: String.fromCharCode.apply(null, data.subarray(ip, ip += 20)),\n        instrumentBagIndex: data[ip++] | (data[ip++] << 8),\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseIbag(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const instrumentZone = this.instrumentZone = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n\n    // check parse target\n    if (chunk.type !== 'ibag') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n\n    while (ip < size) {\n      instrumentZone.push({\n        instrumentGeneratorIndex: data[ip++] | (data[ip++] << 8),\n        instrumentModulatorIndex: data[ip++] | (data[ip++] << 8),\n      });\n    }\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseImod(chunk) {\n    // check parse target\n    if (chunk.type !== 'imod') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    this.instrumentZoneModulator = this.parseModulator(chunk);\n  };\n\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseIgen(chunk) {\n    // check parse target\n    if (chunk.type !== 'igen') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    this.instrumentZoneGenerator = this.parseGenerator(chunk);\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   */\n  parseShdr(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {Array.<Object>} */\n    const samples = this.sample = [];\n    /** @type {Array.<Object>} */\n    const sampleHeader = this.sampleHeader = [];\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n    /** @type {string} */\n    let sampleName;\n    /** @type {number} */\n    let start;\n    /** @type {number} */\n    let end;\n    /** @type {number} */\n    let startLoop;\n    /** @type {number} */\n    let endLoop;\n    /** @type {number} */\n    let sampleRate;\n    /** @type {number} */\n    let originalPitch;\n    /** @type {number} */\n    let pitchCorrection;\n    /** @type {number} */\n    let sampleLink;\n    /** @type {number} */\n    let sampleType;\n\n    // check parse target\n    if (chunk.type !== 'shdr') {\n      throw new Error('invalid chunk type:' + chunk.type);\n    }\n\n    while (ip < size) {\n      sampleName = String.fromCharCode.apply(null, data.subarray(ip, ip += 20));\n      start = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      end = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      startLoop = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      endLoop = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      sampleRate = (\n        (data[ip++] << 0) | (data[ip++] << 8) | (data[ip++] << 16) | (data[ip++] << 24)\n      ) >>> 0;\n      originalPitch = data[ip++];\n      pitchCorrection = (data[ip++] << 24) >> 24;\n      sampleLink = data[ip++] | (data[ip++] << 8);\n      sampleType = data[ip++] | (data[ip++] << 8);\n\n      let sample = new Int16Array(new Uint8Array(data.subarray(\n        this.samplingData.offset + start * 2,\n        this.samplingData.offset + end * 2,\n      )).buffer);\n\n      startLoop -= start;\n      endLoop -= start;\n\n      if (sampleRate > 0) {\n        const adjust = this.adjustSampleData(sample, sampleRate);\n        sample = adjust.sample;\n        sampleRate *= adjust.multiply;\n        startLoop *= adjust.multiply;\n        endLoop *= adjust.multiply;\n      }\n\n      samples.push(sample);\n\n      sampleHeader.push({\n        sampleName: sampleName,\n        start: start,\n        end: end,\n        startLoop: startLoop,\n        endLoop: endLoop,\n        sampleRate: sampleRate,\n        originalPitch: originalPitch,\n        pitchCorrection: pitchCorrection,\n        sampleLink: sampleLink,\n        sampleType: sampleType,\n      });\n    }\n  };\n\n  /**\n   * @param {Array} sample\n   * @param {number} sampleRate\n   * @return {object}\n   */\n  adjustSampleData(sample, sampleRate) {\n    /** @type {Int16Array} */\n    let newSample;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let multiply = 1;\n\n    // buffer\n    while (sampleRate < (this.sampleRate)) { // AudioContextのサンプルレートに変更\n      newSample = new Int16Array(sample.length * 2);\n      for (i = j = 0, il = sample.length; i < il; ++i) {\n        newSample[j++] = sample[i];\n        newSample[j++] = sample[i];\n      }\n      sample = newSample;\n      multiply *= 2;\n      sampleRate *= 2;\n    }\n\n    return {\n      sample: sample,\n      multiply: multiply,\n    };\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   * @return {Array.<Object>}\n   */\n  parseModulator(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n    /** @type {number} */\n    let code;\n    /** @type {string} */\n    let key;\n    /** @type {Array.<Object>} */\n    const output = [];\n\n    while (ip < size) {\n      // Src  Oper\n      // TODO\n      ip += 2;\n\n      // Dest Oper\n      code = data[ip++] | (data[ip++] << 8);\n      key = this.GeneratorEnumeratorTable[code];\n      if (key === void 0) {\n        // Amount\n        output.push({\n          type: key,\n          value: {\n            code: code,\n            amount: data[ip] | (data[ip + 1] << 8) << 16 >> 16,\n            lo: data[ip++],\n            hi: data[ip++],\n          },\n        });\n      } else {\n        // Amount\n        switch (key) {\n          case 'keyRange':\n          /* FALLTHROUGH */\n          case 'velRange':\n          /* FALLTHROUGH */\n          case 'keynum':\n          /* FALLTHROUGH */\n          case 'velocity':\n            output.push({\n              type: key,\n              value: {\n                lo: data[ip++],\n                hi: data[ip++],\n              },\n            });\n            break;\n          default:\n            output.push({\n              type: key,\n              value: {\n                amount: data[ip++] | (data[ip++] << 8) << 16 >> 16,\n              },\n            });\n            break;\n        }\n      }\n\n      // AmtSrcOper\n      // TODO\n      ip += 2;\n\n      // Trans Oper\n      // TODO\n      ip += 2;\n    }\n\n    return output;\n  };\n\n  /**\n   * @param {RiffChunk} chunk\n   * @return {Array.<Object>}\n   */\n  parseGenerator(chunk) {\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {number} */\n    const size = chunk.offset + chunk.size;\n    /** @type {number} */\n    let code;\n    /** @type {string} */\n    let key;\n    /** @type {Array.<Object>} */\n    const output = [];\n\n    while (ip < size) {\n      code = data[ip++] | (data[ip++] << 8);\n      key = this.GeneratorEnumeratorTable[code];\n      if (key === void 0) {\n        output.push({\n          type: key,\n          value: {\n            code: code,\n            amount: data[ip] | (data[ip + 1] << 8) << 16 >> 16,\n            lo: data[ip++],\n            hi: data[ip++],\n          },\n        });\n        continue;\n      }\n\n      switch (key) {\n        case 'keynum':\n        /* FALLTHROUGH */\n        case 'keyRange':\n        /* FALLTHROUGH */\n        case 'velRange':\n        /* FALLTHROUGH */\n        case 'velocity':\n          output.push({\n            type: key,\n            value: {\n              lo: data[ip++],\n              hi: data[ip++],\n            },\n          });\n          break;\n        default:\n          output.push({\n            type: key,\n            value: {\n              amount: data[ip++] | (data[ip++] << 8) << 16 >> 16,\n            },\n          });\n          break;\n      }\n    }\n\n    return output;\n  };\n\n  /**\n   * @return {Array.<object>}\n   */\n  createInstrument() {\n    /** @type {Array.<Object>} */\n    const instrument = this.instrument;\n    /** @type {Array.<Object>} */\n    const zone = this.instrumentZone;\n    /** @type {Array.<Object>} */\n    const output = [];\n    /** @type {number} */\n    let bagIndex;\n    /** @type {number} */\n    let bagIndexEnd;\n    /** @type {Array.<Object>} */\n    let zoneInfo;\n    /** @type {{generator: Object, generatorInfo: Array.<Object>}} */\n    let instrumentGenerator;\n    /** @type {{modulator: Object, modulatorInfo: Array.<Object>}} */\n    let instrumentModulator;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n\n    // instrument -> instrument bag -> generator / modulator\n    for (i = 0, il = instrument.length; i < il; ++i) {\n      bagIndex = instrument[i].instrumentBagIndex;\n      bagIndexEnd = instrument[i + 1] ? instrument[i + 1].instrumentBagIndex : zone.length;\n      zoneInfo = [];\n\n      // instrument bag\n      for (j = bagIndex, jl = bagIndexEnd; j < jl; ++j) {\n        instrumentGenerator = this.createInstrumentGenerator_(zone, j);\n        instrumentModulator = this.createInstrumentModulator_(zone, j);\n\n        zoneInfo.push({\n          generator: instrumentGenerator.generator,\n          generatorSequence: instrumentGenerator.generatorInfo,\n          modulator: instrumentModulator.modulator,\n          modulatorSequence: instrumentModulator.modulatorInfo,\n        });\n      }\n\n      output.push({\n        name: instrument[i].instrumentName,\n        info: zoneInfo,\n      });\n    }\n\n    return output;\n  };\n\n  /**\n   * @return {Array.<object>}\n   */\n  createPreset() {\n    /** @type {Array.<Object>} */\n    const preset = this.presetHeader;\n    /** @type {Array.<Object>} */\n    const zone = this.presetZone;\n    /** @type {Array.<Object>} */\n    const output = [];\n    /** @type {number} */\n    let bagIndex;\n    /** @type {number} */\n    let bagIndexEnd;\n    /** @type {Array.<Object>} */\n    let zoneInfo;\n    /** @type {number} */\n    let instrument;\n    /** @type {{generator: Object, generatorInfo: Array.<Object>}} */\n    let presetGenerator;\n    /** @type {{modulator: Object, modulatorInfo: Array.<Object>}} */\n    let presetModulator;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n\n    // preset -> preset bag -> generator / modulator\n    for (i = 0, il = preset.length; i < il; ++i) {\n      bagIndex = preset[i].presetBagIndex;\n      bagIndexEnd = preset[i + 1] ? preset[i + 1].presetBagIndex : zone.length;\n      zoneInfo = [];\n\n      // preset bag\n      for (j = bagIndex, jl = bagIndexEnd; j < jl; ++j) {\n        presetGenerator = this.createPresetGenerator_(zone, j);\n        presetModulator = this.createPresetModulator_(zone, j);\n\n        zoneInfo.push({\n          generator: presetGenerator.generator,\n          generatorSequence: presetGenerator.generatorInfo,\n          modulator: presetModulator.modulator,\n          modulatorSequence: presetModulator.modulatorInfo,\n        });\n\n        instrument =\n          presetGenerator.generator['instrument'] !== void 0 ?\n            presetGenerator.generator['instrument'].amount :\n            presetModulator.modulator['instrument'] !== void 0 ?\n              presetModulator.modulator['instrument'].amount :\n              null;\n      }\n\n      output.push({\n        name: preset[i].presetName,\n        info: zoneInfo,\n        header: preset[i],\n        instrument: instrument,\n      });\n    }\n\n    return output;\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{generator: Object, generatorInfo: Array.<Object>}}\n   * @private\n   */\n  createInstrumentGenerator_(zone, index) {\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].instrumentGeneratorIndex,\n      zone[index + 1] ? zone[index + 1].instrumentGeneratorIndex : this.instrumentZoneGenerator.length,\n      this.instrumentZoneGenerator,\n    );\n\n    return {\n      generator: modgen.modgen,\n      generatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{modulator: Object, modulatorInfo: Array.<Object>}}\n   * @private\n   */\n  createInstrumentModulator_(zone, index) {\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].presetModulatorIndex,\n      zone[index + 1] ? zone[index + 1].instrumentModulatorIndex : this.instrumentZoneModulator.length,\n      this.instrumentZoneModulator,\n    );\n\n    return {\n      modulator: modgen.modgen,\n      modulatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{generator: Object, generatorInfo: Array.<Object>}}\n   * @private\n   */\n  createPresetGenerator_(zone, index) {\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].presetGeneratorIndex,\n      zone[index + 1] ? zone[index + 1].presetGeneratorIndex : this.presetZoneGenerator.length,\n      this.presetZoneGenerator,\n    );\n\n    return {\n      generator: modgen.modgen,\n      generatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} index\n   * @return {{modulator: Object, modulatorInfo: Array.<Object>}}\n   * @private\n   */\n  createPresetModulator_(zone, index) {\n    /** @type {{modgen: Object, modgenInfo: Array.<Object>}} */\n    const modgen = this.createBagModGen_(\n      zone,\n      zone[index].presetModulatorIndex,\n      zone[index + 1] ? zone[index + 1].presetModulatorIndex : this.presetZoneModulator.length,\n      this.presetZoneModulator,\n    );\n\n    return {\n      modulator: modgen.modgen,\n      modulatorInfo: modgen.modgenInfo,\n    };\n  };\n\n  /**\n   * @param {Array.<Object>} zone\n   * @param {number} indexStart\n   * @param {number} indexEnd\n   * @param {Array} zoneModGen\n   * @return {{modgen: Object, modgenInfo: Array.<Object>}}\n   * @private\n   */\n  createBagModGen_(zone, indexStart, indexEnd, zoneModGen) {\n    /** @type {Array.<Object>} */\n    const modgenInfo = [];\n    /** @type {Object} */\n    const modgen = {\n      'unknown': [],\n      'keyRange': {\n        hi: 127,\n        lo: 0,\n      },\n    }; // TODO\n    /** @type {Object} */\n    let info;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    for (i = indexStart, il = indexEnd; i < il; ++i) {\n      info = zoneModGen[i];\n      modgenInfo.push(info);\n\n      if (info.type === 'unknown') {\n        modgen.unknown.push(info.value);\n      } else {\n        modgen[info.type] = info.value;\n      }\n    }\n\n    return {\n      modgen: modgen,\n      modgenInfo: modgenInfo,\n    };\n  }\n}\n\nexport default Parser;\n","import SynthesizerNote from './sound_font_synth_note';\nimport Parser from './sf2';\nimport Reverb from '@logue/reverb/bin/reverb';\n/**\n * Synthesizer Class\n * @private\n */\nexport class Synthesizer {\n  /**\n   * @param {Uint8Array} input\n   */\n  constructor(input) {\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    /** @type {Uint8Array} */\n    this.input = input;\n    /** @type {SoundFont.Parser} */\n    this.parser = {};\n    /** @type {number} */\n    this.bank = 0;\n    /** @type {Array.<Array.<Object>>} */\n    this.bankSet = {};\n    /** @type {number} */\n    this.bufferSize = 2048;\n    /** @type {AudioContext} */\n    this.ctx = this.getAudioContext();\n    /** @type {GainNode} */\n    this.gainMaster = this.ctx.createGain();\n    /** @type {AudioBufferSourceNode} */\n    this.bufSrc = this.ctx.createBufferSource();\n    /** @type {Array.<number>} */\n    this.channelInstrument = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.channelBank = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 127, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.channelVolume = [127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127];\n    /** @type {Array.<number>} */\n    this.channelPanpot = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelPitchBend = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.channelPitchBendSensitivity = [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2];\n    /** @type {Array.<number>} */\n    this.channelExpression = [127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127];\n    /** @type {Array.<number>} */\n    this.channelAttack = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelDecay = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelSustin = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelRelease = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n\n    /** @type {Array.<boolean>} */\n    this.channelHold = [\n      false, false, false, false, false, false, false, false,\n      false, false, false, false, false, false, false, false,\n    ];\n    /** @type {Array.<number>} */\n    this.channelHarmonicContent = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n    /** @type {Array.<number>} */\n    this.channelCutOffFrequency = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n\n    /** @type {boolean} */\n    this.isGS = false;\n    /** @type {boolean} */\n    this.isXG = false;\n\n    /** @type {Array.<Array.<string>>} */\n    this.programSet = [];\n\n    /** @type {Array.<boolean>} */\n    this.channelMute = [\n      false, false, false, false, false, false, false, false,\n      false, false, false, false, false, false, false, false,\n    ];\n    /** @type {Array.<Array.<SoundFont.SynthesizerNote>>} */\n    this.currentNoteOn = [\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n      [],\n    ];\n    /** @type {number} @const */\n    this.baseVolume = 1 / 0xffff;\n    /** @type {number} */\n    this.masterVolume = 16384;\n\n    /** @type {Array.<boolean>} */\n    this.percussionPart = [\n      false, false, false, false, false, false, false, false,\n      false, true, false, false, false, false, false, false,\n    ];\n\n    /** @type {Array.<number>} */\n    this.percussionVolume = new Array(128);\n    for (i = 0, il = this.percussionVolume.length; i < il; ++i) {\n      this.percussionVolume[i] = 127;\n    }\n\n    this.programSet = {};\n\n    /** @type {Array.<Reverb>}リバーブエフェクト（チャンネル毎に用意する） */\n    this.reverb = [];\n\n    for (i = 0; i < 16; ++i) {\n      this.reverb[i] = new Reverb(this.ctx, { mix: 0.315 });// リバーブエフェクトのデフォルト値は40なので40/127の値がドライ／ウェット値となる\n    }\n\n    this.observer = new IntersectionObserver((entries, object) => {\n      entries.forEach((entry, i) => {\n        // 交差していない\n        entry.target.dataset.isIntersecting = entry.isIntersecting;\n      });\n    }, {});\n  }\n\n  /**\n   * @return {AudioContext}\n   */\n  getAudioContext() {\n    /** @type {AudioContext} */\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n\n    // for legacy browsers\n    ctx.createGain = ctx.createGain || ctx.createGainNode;\n\n    // Defreeze AudioContext for iOS.\n    const initAudioContext = () => {\n      document.removeEventListener('touchstart', initAudioContext);\n      // wake up AudioContext\n      const emptySource = ctx.createBufferSource();\n      emptySource.start();\n      emptySource.stop();\n    };\n\n    document.addEventListener('touchstart', initAudioContext);\n\n    return ctx;\n  }\n\n  /**\n   * System Reset\n   * @param {string} mode\n   */\n  init(mode = 'GM') {\n    this.gainMaster.disconnect();\n\n    /** @type {number} */\n    let i;\n\n    this.parser = new Parser(this.input, {\n      sampleRate: this.ctx.sampleRate,\n    });\n    this.bankSet = this.createAllInstruments();\n\n    this.isXG = false;\n    this.isGS = false;\n\n    if (mode == 'XG') {\n      this.isXG = true;\n    } else if (mode == 'GS') {\n      this.isGS = true;\n    }\n\n    for (i = 0; i < 16; ++i) {\n      this.programChange(i, 0x00);\n      this.volumeChange(i, 0x64);\n      this.panpotChange(i, 0x40);\n      this.pitchBend(i, 0x00, 0x40); // 8192\n      this.pitchBendSensitivity(i, 2);\n      this.channelHold[i] = false;\n      this.channelExpression[i] = 127;\n      this.channelBank[i] = i === 9 ? 127 : 0;\n      this.attackTime(i, 64);\n      this.decayTime(i, 64);\n      this.sustinTime(i, 64);\n      this.releaseTime(i, 64);\n      this.harmonicContent(i, 64);\n      this.cutOffFrequency(i, 64);\n      this.reverbDepth(i, 40);\n      this.updateBankSelect(i);\n      this.updateProgramSelect(i);\n    }\n\n    this.setPercussionPart(9, true);\n\n    for (i = 0; i < 128; ++i) {\n      this.percussionVolume[i] = 127;\n    }\n\n    this.gainMaster.connect(this.ctx.destination);\n\n    /*\n    if (this.element) {\n      this.element.querySelector('.header div:before').innerText = mode + ' Mode';\n    }\n    */\n\n    this.element.dataset.mode = mode;\n  }\n\n  /**\n   */\n  close() {\n    this.ctx.close();\n  }\n\n  /**\n   * @param {Uint8Array} input\n   */\n  refreshInstruments(input) {\n    this.input = input;\n    this.parser = new Parser(input);\n    this.bankSet = this.createAllInstruments();\n  }\n\n  /** @return {Array.<Array.<Object>>} */\n  createAllInstruments() {\n    /** @type {SoundFont.Parser} */\n    const parser = this.parser;\n    parser.parse();\n    /** @type {Array} TODO */\n    const presets = parser.createPreset();\n    /** @type {Array} TODO */\n    const instruments = parser.createInstrument();\n    /** @type {Array} */\n    const banks = [];\n    /** @type {Array.<Array.<Object>>} */\n    let bank;\n    /** @type {number} */\n    let bankNumber;\n    /** @type {Object} TODO */\n    let preset;\n    /** @type {Object} */\n    let instrument;\n    /** @type {number} */\n    let presetNumber;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n    /** @type {string} */\n    let presetName;\n\n    const programSet = [];\n\n    for (i = 0, il = presets.length; i < il; ++i) {\n      preset = presets[i];\n      presetNumber = preset.header.preset;\n      bankNumber = preset.header.bank;\n      presetName = preset.name.replace(/\\0*$/, '');\n\n      if (typeof preset.instrument !== 'number') {\n        continue;\n      }\n\n      instrument = instruments[preset.instrument];\n      if (instrument.name.replace(/\\0*$/, '') === 'EOI') {\n        continue;\n      }\n\n      // select bank\n      if (banks[bankNumber] === void 0) {\n        banks[bankNumber] = [];\n      }\n      bank = banks[bankNumber];\n      bank[presetNumber] = {};\n      bank[presetNumber].name = presetName;\n\n      for (j = 0, jl = instrument.info.length; j < jl; ++j) {\n        this.createNoteInfo(parser, instrument.info[j], bank[presetNumber]);\n      }\n      if (!programSet[bankNumber]) {\n        programSet[bankNumber] = {};\n      }\n      programSet[bankNumber][presetNumber] = presetName;\n    }\n\n    this.programSet = programSet;\n\n    return banks;\n  }\n\n  /**\n   * @param {Parser} parser\n   * @param {*} info\n   * @param {*} preset\n   */\n  createNoteInfo(parser, info, preset) {\n    /** @type {Generator} */\n    const generator = info.generator;\n\n    if (generator['keyRange'] === void 0 || generator['sampleID'] === void 0) {\n      return;\n    }\n    /** @type {number} */\n    const volDelay = this.getModGenAmount(generator, 'delayVolEnv', -12000);\n    /** @type {number} */\n    const volAttack = this.getModGenAmount(generator, 'attackVolEnv', -12000);\n    /** @type {number} */\n    const volHold = this.getModGenAmount(generator, 'holdVolEnv', -12000);\n    /** @type {number} */\n    const volDecay = this.getModGenAmount(generator, 'decayVolEnv', -12000);\n    /** @type {number} */\n    const volSustain = this.getModGenAmount(generator, 'sustainVolEnv');\n    /** @type {number} */\n    const volRelease = this.getModGenAmount(generator, 'releaseVolEnv', -12000);\n    /** @type {number} */\n    const modDelay = this.getModGenAmount(generator, 'delayModEnv', -12000);\n    /** @type {number} */\n    const modAttack = this.getModGenAmount(generator, 'attackModEnv', -12000);\n    /** @type {number} */\n    const modHold = this.getModGenAmount(generator, 'holdModEnv', -12000);\n    /** @type {number} */\n    const modDecay = this.getModGenAmount(generator, 'decayModEnv', -12000);\n    /** @type {number} */\n    const modSustain = this.getModGenAmount(generator, 'sustainModEnv');\n    /** @type {number} */\n    const modRelease = this.getModGenAmount(generator, 'releaseModEnv', -12000);\n    /** @type {number} */\n    const scale = this.getModGenAmount(generator, 'scaleTuning', 100) / 100;\n    /** @type {number} */\n    const freqVibLFO = this.getModGenAmount(generator, 'freqVibLFO');\n    /** @type {number} */\n    const pan = this.getModGenAmount(generator, 'pan');\n    /** @type {number} */\n    const tune = this.getModGenAmount(generator, 'coarseTune') + this.getModGenAmount(generator, 'fineTune') / 100;\n\n    for (let i = generator['keyRange'].lo, il = generator['keyRange'].hi; i <= il; ++i) {\n      if (preset[i]) {\n        continue;\n      }\n      /** @type {number} */\n      const sampleId = this.getModGenAmount(generator, 'sampleID');\n      /** @type {object} */\n      const sampleHeader = parser.sampleHeader[sampleId];\n      preset[i] = {\n        'sample': parser.sample[sampleId],\n        'sampleRate': sampleHeader.sampleRate,\n        'sampleModes': this.getModGenAmount(generator, 'sampleModes'),\n        'basePlaybackRate':\n          1.0594630943592953 // Math.pow(2, 1 / 12)\n          ** ((\n            i -\n            this.getModGenAmount(generator, 'overridingRootKey', sampleHeader.originalPitch) +\n            tune + (sampleHeader.pitchCorrection / 100)\n          ) * scale\n          ),\n        'modEnvToPitch': this.getModGenAmount(generator, 'modEnvToPitch') / 100,\n        'scaleTuning': scale,\n        'start': this.getModGenAmount(generator, 'startAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'startAddrsOffset'),\n        'end': this.getModGenAmount(generator, 'endAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'endAddrsOffset'),\n        'loopStart': (\n          // (sampleHeader.startLoop - sampleHeader.start) +\n          (sampleHeader.startLoop) +\n          this.getModGenAmount(generator, 'startloopAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'startloopAddrsOffset')\n        ),\n        'loopEnd': (\n          // (sampleHeader.endLoop - sampleHeader.start) +\n          (sampleHeader.endLoop) +\n          this.getModGenAmount(generator, 'endloopAddrsCoarseOffset') * 32768 +\n          this.getModGenAmount(generator, 'endloopAddrsOffset')\n        ),\n        'volDelay': 2 ** (volDelay / 1200),\n        'volAttack': 2 ** (volAttack / 1200),\n        'volHold': 2 ** (volHold / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToVolEnvHold') / 1200),\n        'volDecay': 2 ** (volDecay / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToVolEnvDecay') / 1200),\n        'volSustain': volSustain / 1000,\n        'volRelease': 2 ** (volRelease / 1200),\n        'modDelay': 2 ** (modDelay / 1200),\n        'modAttack': 2 ** (modAttack / 1200),\n        'modHold': 2 ** (modHold / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToModEnvHold') / 1200),\n        'modDecay': 2 ** (modDecay / 1200) *\n          2 ** ((60 - i) * this.getModGenAmount(generator, 'keynumToModEnvDecay') / 1200),\n        'modSustain': modSustain / 1000,\n        'modRelease': 2 ** (modRelease / 1200),\n        'initialFilterFc': this.getModGenAmount(generator, 'initialFilterFc', 13500),\n        'modEnvToFilterFc': this.getModGenAmount(generator, 'modEnvToFilterFc'),\n        'initialFilterQ': this.getModGenAmount(generator, 'initialFilterQ'),\n        'reverbEffectSend': this.getModGenAmount(generator, 'reverbEffectSend'),\n        'initialAttenuation': this.getModGenAmount(generator, 'initialAttenuation'),\n        'freqVibLFO': freqVibLFO ? (2 ** (freqVibLFO / 1200)) * 8.176 : void 0,\n        'pan': pan ? pan / 1200 : void 0,\n      };\n    }\n  };\n\n  /**\n   * @param {Object} generator\n   * @param {string} enumeratorType\n   * @param {number=} optDefault\n   * @return {number}\n   */\n  getModGenAmount(generator, enumeratorType, optDefault = 0) {\n    return generator[enumeratorType] ? generator[enumeratorType].amount : optDefault;\n  }\n\n  /**\n   */\n  start() {\n    this.connect();\n    this.bufSrc.start(0);\n    this.setMasterVolume(16383);\n  }\n\n  /**\n   * @param {number} volume\n   */\n  setMasterVolume(volume) {\n    this.masterVolume = volume;\n    this.gainMaster.gain.value = this.baseVolume * (volume / 16384);\n  }\n\n  /**\n   */\n  connect() {\n    this.bufSrc.connect(this.gainMaster);\n  }\n\n  /**\n   */\n  disconnect() {\n    this.bufSrc.disconnect(this.gainMaster);\n    this.bufSrc.buffer = null;\n  }\n\n  /**\n   * @return {HTMLDivElement}\n   */\n  drawSynth() {\n    /** @type {Document} */\n    const doc = window.document;\n    /** @type {HTMLDivElement} */\n    const wrapper = this.element = doc.createElement('div');\n    /** @type {HTMLDivElement} */\n    const instElem = doc.createElement('div');\n    instElem.className = 'instrument';\n    /** @type {Array} */\n    const items = ['mute', 'bank', 'program', 'volume', 'panpot', 'pitchBend', 'pitchBendSensitivity', 'keys'];\n    /** @type {string} */\n    const eventStart = 'ontouchstart' in window ? 'touchstart' : 'mousedown';\n    /** @type {string} */\n    const eventEnd = 'ontouchend' in window ? 'touchend' : 'mouseup';\n\n    for (let channel = 0; channel < 16; channel++) {\n      /** @type {HTMLDivElement} */\n      const channelElem = doc.createElement('div');\n      channelElem.className = 'channel';\n      for (const item in items) {\n        if ({}.hasOwnProperty.call(items, item)) {\n          /** @type {HTMLDivElement} */\n          const itemElem = doc.createElement('div');\n          itemElem.className = items[item];\n\n          switch (items[item]) {\n            case 'mute':\n              /** @type {HTMLDivElement|null} */\n              const checkboxElement = doc.createElement('div');\n              checkboxElement.className = 'custom-control custom-checkbox custom-control-inline';\n              /** @type {HTMLInputElement|null} */\n              const checkbox = doc.createElement('input');\n              checkbox.setAttribute('type', 'checkbox');\n              checkbox.className = 'custom-control-input';\n              checkbox.id = 'mute' + channel + 'ch';\n              checkbox.addEventListener('change', ((synth, channelElem) => {\n                return () => {\n                  synth.mute(channelElem, this.checked);\n                };\n              })(this, channel), false);\n              checkboxElement.appendChild(checkbox);\n              /** @type {HTMLLabelElement} */\n              const labelElem = doc.createElement('label');\n              labelElem.className = 'custom-control-label';\n              labelElem.textContent = channel + 1;\n              labelElem.setAttribute('for', 'mute' + channel + 'ch');\n              checkboxElement.appendChild(labelElem);\n              itemElem.appendChild(checkboxElement);\n              break;\n            case 'bank':\n              // Bank select\n              /** @type {HTMLSelectElement} */\n              const bankSelect = doc.createElement('select');\n              bankSelect.className = 'form-control form-control-sm';\n              itemElem.appendChild(bankSelect);\n              /** @type {HTMLOptionElement} */\n              const option = doc.createElement('option');\n              bankSelect.appendChild(option);\n\n              bankSelect.addEventListener('change', ((synth, channelElem) => {\n                return (event) => {\n                  synth.bankChange(channelElem, event.target.value);\n                  synth.programChange(channelElem, synth.channelElemInstrument[channelElem]);\n                };\n              })(this, channel), false);\n\n              bankSelect.selectedIndex = this.channelBank[item];\n              break;\n            case 'program':\n              // Program change\n              /** @type {HTMLSelectElement|null} */\n              const select = doc.createElement('select');\n              select.className = 'form-control form-control-sm';\n\n              itemElem.appendChild(select);\n\n              select.addEventListener('change', ((synth, channelElem) => {\n                return (event) => {\n                  synth.programChange(channelElem, event.target.value);\n                };\n              })(this, channel), false);\n\n              select.selectedIndex = this.channelInstrument[item];\n              break;\n            case 'volume':\n              itemElem.innerText = 100;\n            case 'pitchBendSensitivity':\n              itemElem.innerText = 2;\n              break;\n            case 'panpot':\n              /** @type {HTMLMeterElement|null} */\n              const panpot = doc.createElement('meter');\n              panpot.min = 0;\n              panpot.max = 127;\n              panpot.value = 64;\n              itemElem.appendChild(panpot);\n              break;\n            case 'pitchBend':\n              /** @type {HTMLMeterElement|null} */\n              const pitch = doc.createElement('meter');\n              pitch.min = -8192;\n              pitch.max = 8192;\n              pitch.value = 0;\n              itemElem.appendChild(pitch);\n              break;\n            case 'keys':\n              for (let key = 0; key < 127; key++) {\n                /** @type {HTMLDivElement|null} */\n                const keyElem = doc.createElement('div');\n                /** @type {number} */\n                const n = key % 12;\n                // 白鍵と黒鍵の色分け\n                keyElem.className = 'key ' + ([1, 3, 6, 8, 10].includes(n) ? 'semitone' : 'tone');\n                itemElem.appendChild(keyElem);\n\n                // イベント割当\n                keyElem.addEventListener(eventStart, ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    synth.drag = true;\n                    synth.noteOn(channelElem, k, 127);\n                  };\n                })(this, channel, key));\n                keyElem.addEventListener('mouseover', ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    if (synth.drag) {\n                      synth.noteOn(channelElem, k, 127);\n                    }\n                  };\n                })(this, channel, key));\n                keyElem.addEventListener('mouseout', ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    synth.noteOff(channelElem, k, 0);\n                  };\n                })(this, channel, key));\n                keyElem.addEventListener(eventEnd, ((synth, channelElem, k) => {\n                  return (event) => {\n                    event.preventDefault();\n                    synth.drag = false;\n                    synth.noteOff(channelElem, k, 0);\n                  };\n                })(this, channel, key));\n              }\n              break;\n          }\n          channelElem.appendChild(itemElem);\n        }\n      }\n      instElem.appendChild(channelElem);\n      this.observer.observe(channelElem);\n    }\n    wrapper.appendChild(instElem);\n    return wrapper;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} key\n   * @param {number} velocity\n   */\n  updateSynthElement(channel, key, velocity) {\n    if (!this.element) {\n      return;\n    }\n    /** @type {HTMLDivElement} */\n    const channelElem = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ')');\n\n    if (channelElem.dataset.isIntersecting) {\n      /** @type {HTMLDivElement} */\n      const keyElem = channelElem.querySelector('.key:nth-child(' + (key + 1) + ')');\n      if (velocity === 0) {\n        if (keyElem.classList.contains('note-on')) {\n          keyElem.classList.remove('note-on');\n        }\n        keyElem.style.opacity = 1;\n      } else {\n        keyElem.classList.add('note-on');\n        keyElem.style.opacity = (velocity / 127).toFixed(2);\n      }\n    }\n  }\n\n  /**\n   * バンクセレクタの選択ボックスの処理\n   * @param {number} channel\n   */\n  updateBankSelect(channel) {\n    if (!this.element) {\n      return;\n    }\n    /** @type {HTMLElement} */\n    const bankElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .bank > select');\n\n    while (bankElement.firstChild) bankElement.removeChild(bankElement.firstChild);\n\n    for (const bankNo in this.programSet) {\n      if ({}.hasOwnProperty.call(this.programSet, bankNo)) {\n        const option = document.createElement('option');\n        option.value = bankNo;\n        option.textContent = ('000' + (parseInt(bankNo))).slice(-3);\n        bankElement.appendChild(option);\n      }\n    }\n  }\n\n  /**\n   * プログラムチェンジの選択ボックスの処理\n   * @param {number} channel\n   */\n  updateProgramSelect(channel) {\n    if (!this.element) {\n      return;\n    }\n    /** @type {number} */\n    const bankIndex = this.channelBank[channel];\n    /** @type {HTMLElement} */\n    const bankElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .bank > select');\n    /** @type {HTMLElement} */\n    const programElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .program > select');\n\n    bankElement.value = this.channelBank[channel];\n    while (programElement.firstChild) programElement.removeChild(programElement.firstChild);\n\n    for (const programNo in this.programSet[bankIndex]) {\n      if ({}.hasOwnProperty.call(this.programSet[bankIndex], programNo)) {\n        // TODO: 存在しないプログラムの場合、現状では空白になってしまう\n        const option = document.createElement('option');\n        option.value = programNo;\n        option.textContent = ('000' + (parseInt(programNo) + 1)).slice(-3) + ':' + this.programSet[bankIndex][programNo];\n        if (programNo === this.channelInstrument[channel]) {\n          option.selected = 'selected';\n        }\n        programElement.appendChild(option);\n      }\n    }\n  }\n\n  /**\n   * @param {number} channel NoteOn するチャンネル.\n   * @param {number} key NoteOn するキー.\n   * @param {number} velocity 強さ.\n   */\n  noteOn(channel, key, velocity) {\n    /** @type {number} */\n    const bankIndex = this.channelBank[channel];\n    /** @type {Object} */\n    const bank = (typeof this.bankSet[bankIndex] === 'object') ? this.bankSet[bankIndex] : this.bankSet[0];\n    /** @type {Object} */\n    let instrument;\n\n    if (typeof bank[this.channelInstrument[channel]] === 'object') {\n      // 音色が存在する場合\n      instrument = bank[this.channelInstrument[channel]];\n    } else if (this.percussionPart[channel] == true) {\n      // パーカッションバンクが選択されている場合で音色が存在しない場合Standard Kitを選択\n      instrument = this.bankSet[(this.isXG ? 127 : 128)][0];\n    } else {\n      // 通常バンクが選択されている状態で音色が存在しない場合バンク0を選択\n      instrument = this.bankSet[0][this.channelInstrument[channel]];\n    }\n\n    if (instrument[key] === void 0) {\n      // TODO\n      console.warn(\n        'instrument not found: bank=%s instrument=%s channel=%s key=%s',\n        bankIndex,\n        this.channelInstrument[channel],\n        channel,\n        key,\n      );\n      return;\n    }\n    /** @type {Object} */\n    const instrumentKey = instrument[key];\n    /** @type {number} */\n    let panpot = this.channelPanpot[channel] - 64;\n    panpot /= panpot < 0 ? 64 : 63;\n\n    // create note information\n    instrumentKey['channel'] = channel;\n    instrumentKey['key'] = key;\n    instrumentKey['velocity'] = velocity;\n    instrumentKey['panpot'] = panpot;\n    instrumentKey['volume'] = this.channelVolume[channel] / 127;\n    instrumentKey['pitchBend'] = this.channelPitchBend[channel] - 8192;\n    instrumentKey['expression'] = this.channelExpression[channel];\n    instrumentKey['pitchBendSensitivity'] = Math.round(this.channelPitchBendSensitivity[channel]);\n    instrumentKey['mute'] = this.channelMute[channel];\n    instrumentKey['releaseTime'] = this.channelRelease[channel];\n    instrumentKey['cutOffFrequency'] = this.cutOffFrequency[channel];\n    instrumentKey['harmonicContent'] = this.harmonicContent[channel];\n    instrumentKey['reverb'] = this.reverb[channel];\n\n    // percussion\n    if (bankIndex > 125) {\n      if (key === 42 || key === 44) {\n        // 42: Closed Hi-Hat\n        // 44: Pedal Hi-Hat\n        // 46: Open Hi-Hat\n        this.noteOff(channel, 46, 0);\n      }\n      if (key === 80) {\n        // 80: Mute Triangle\n        // 81: Open Triangle\n        this.noteOff(channel, 81, 0);\n      }\n      instrument['volume'] *= this.percussionVolume[key] / 127;\n    }\n\n    // note on\n    /** @type {SynthesizerNote} */\n    const note = new SynthesizerNote(this.ctx, this.gainMaster, instrumentKey);\n    note.noteOn();\n    this.currentNoteOn[channel].push(note);\n\n    this.updateSynthElement(channel, key, velocity);\n  }\n\n  /**\n   * @param {number} channel NoteOff するチャンネル.\n   * @param {number} key NoteOff するキー.\n   * @param {number} velocity 強さ.\n   */\n  noteOff(channel, key, velocity) {\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {SynthesizerNote} */\n    let note;\n    /** @type {boolean} */\n    const hold = this.channelHold[channel];\n\n    for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n      note = currentNoteOn[i];\n      if (note.key === key) {\n        note.noteOff();\n        // hold している時は NoteOff にはするがリリースはしない\n        if (!hold) {\n          note.release();\n          currentNoteOn.splice(i, 1);\n          --i;\n          --il;\n        }\n      }\n    }\n    this.updateSynthElement(channel, key, 0);\n  }\n\n  /**\n   * @param {number} channel ホールドするチャンネル\n   * @param {number} value 値\n   */\n  hold(channel, value) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {boolean} */\n    const hold = this.channelHold[channel] = !(value < 64);\n    /** @type {SynthesizerNote} */\n    let note;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    if (!hold) {\n      for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n        note = currentNoteOn[i];\n        if (note.isNoteOff()) {\n          note.release();\n          currentNoteOn.splice(i, 1);\n          --i;\n          --il;\n        }\n      }\n    }\n\n    if (this.element) {\n      /** @type {HTMLDivElement} */\n      const channelElement = this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ')');\n      if (this.channelHold[channel]) {\n        channelElement.classList.add('hold');\n      } else {\n        channelElement.classList.remove('hold');\n      }\n    }\n  }\n\n  /**\n   * @param {number} channel チャンネルのバンクセレクトMSB\n   * @param {number} value 値\n   */\n  bankSelectMsb(channel, value) {\n    if (this.isXG) {\n      // 念の為バンクを0にリセット\n      this.channelBank[channel] = 0;\n      // XG音源は、MSB→LSBの優先順でバンクセレクトをする。\n      if (value === 64) {\n        // Bank Select MSB #64 (Voice Type: SFX)\n        this.channelBank[channel] = 125;\n        this.percussionPart[channel] = true;\n      } else if (value === 126 || value === 127) {\n        // Bank Select MSB #126 (Voice Type: Drum)\n        // Bank Select MSB #127 (Voice Type: Drum)\n        this.channelBank[channel] = value;\n        this.percussionPart[channel] = true;\n      }\n    } else if (this.isGS) {\n      // GS音源\n      // ※チャンネル10のバンク・セレクト命令は無視する。\n      this.channelBank[channel] = channel === 9 ? 128 : value;\n      this.percussionPart[channel] = value === 128;\n    } else {\n      // GM音源モードのときはバンク・セレクトを無視\n      return;\n    }\n    this.updateBankSelect(channel);\n  }\n\n  /**\n   * @param {number} channel チャンネルのバンクセレクトLSB\n   * @param {number} value 値\n   */\n  bankSelectLsb(channel, value) {\n    // XG音源以外は処理しない\n    if (!this.isXG || this.percussionPart[channel] === true) {\n      return;\n    }\n\n    // 125より値が大きい場合、パーカッションとして処理\n    this.percussionPart[channel] = value >= 125;\n\n    this.channelBank[channel] = value;\n    this.updateBankSelect(channel);\n  }\n\n  /**\n   * @param {number} channel 音色を変更するチャンネル.\n   * @param {number} instrument 音色番号.\n   */\n  programChange(channel, instrument) {\n    this.channelInstrument[channel] = instrument;\n\n    this.bankChange(channel, this.channelBank[channel]);\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') .program > select').value = instrument;\n    }\n  }\n\n  /**\n   * @param {number} channel 音色を変更するチャンネル.\n   * @param {number} bank バンク・セレクト.\n   */\n  bankChange(channel, bank) {\n    if (typeof this.bankSet[bank] === 'object') {\n      // バンクが存在するとき\n      this.channelBank[channel] = bank;\n    } else {\n      // バンクが存在しないとき\n      if (this.percussionPart[channel]) {\n        // パーカッション\n        this.channelBank[channel] = !this.isXG ? 128 : 127;\n      } else {\n        // 存在しない場合0を選択\n        this.channelBank[channel] = 0;\n      }\n    }\n\n    // TODO: 厳密にはMIDI音源はプログラムチェンジがあったときにバンク・セレクトが反映される。\n    this.updateProgramSelect(channel);\n\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .bank > select').value = bank;\n    }\n  }\n\n  /**\n   * @param {number} channel 音量を変更するチャンネル.\n   * @param {number} volume 音量(0-127).\n   */\n  volumeChange(channel, volume) {\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .volume').innerText = volume;\n    }\n\n    this.channelVolume[channel] = volume;\n  }\n\n  /**\n   * @param {number} channel 音量を変更するチャンネル.\n   * @param {number} expression 音量(0-127).\n   */\n  expression(channel, expression) {\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n\n    for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n      currentNoteOn[i].updateExpression(expression);\n    }\n\n    this.channelExpression[channel] = expression;\n  }\n\n  /**\n   * @param {number} channel panpot を変更するチャンネル.\n   * @param {number} panpot panpot(0-127).\n   */\n  panpotChange(channel, panpot) {\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .panpot > meter').value = panpot;\n    }\n\n    this.channelPanpot[channel] = panpot;\n  }\n\n  /**\n   * @param {number} channel panpot を変更するチャンネル.\n   * @param {number} lowerByte\n   * @param {number} higherByte\n   */\n  pitchBend(channel, lowerByte, higherByte) {\n    /** @type {number} */\n    const bend = (lowerByte & 0x7f) | ((higherByte & 0x7f) << 7);\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {Array.<SoundFont.SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {number} */\n    const calculated = bend - 8192;\n\n    if (this.element) {\n      this.element.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .pitchBend > meter').value = calculated;\n    }\n\n    for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n      currentNoteOn[i].updatePitchBend(calculated);\n    }\n\n    this.channelPitchBend[channel] = bend;\n  }\n\n  /**\n   * @param {number} channel pitch bend sensitivity を変更するチャンネル.\n   * @param {number} sensitivity\n   */\n  pitchBendSensitivity(channel, sensitivity) {\n    if (this.element) {\n      document.querySelector('.instrument > .channel:nth-child(' + (channel + 1) + ') > .pitchBendSensitivity').innerText = sensitivity;\n    }\n    this.channelPitchBendSensitivity[channel] = sensitivity;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} attackTime\n   */\n  attackTime(channel, attackTime) {\n    this.channelAttack[channel] = attackTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} decayTime\n   */\n  decayTime(channel, decayTime) {\n    this.channelDecay[channel] = decayTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} sustinTime\n   */\n  sustinTime(channel, sustinTime) {\n    this.channelSustin[channel] = sustinTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} releaseTime\n   */\n  releaseTime(channel, releaseTime) {\n    this.channelRelease[channel] = releaseTime;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} value\n   */\n  harmonicContent(channel, value) {\n    this.channelHarmonicContent[channel] = value;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} value\n   */\n  cutOffFrequency(channel, value) {\n    this.channelCutOffFrequency[channel] = value;\n  }\n\n  /**\n   * @param {number} channel\n   * @param {number} depth\n   */\n  reverbDepth(channel, depth) {\n    // リバーブ深度は、ドライ／ウェット比とする。\n    this.reverb[channel].mix(depth / 127);\n  }\n\n  /**\n   * @param {number} channel pitch bend sensitivity を取得するチャンネル.\n   * @return {number}\n   */\n  getPitchBendSensitivity(channel) {\n    return this.channelPitchBendSensitivity[channel];\n  }\n\n  /**\n   * @param {number} key\n   * @param {number} volume\n   */\n  drumInstrumentLevel(key, volume) {\n    this.percussionVolume[key] = volume;\n  }\n\n  /**\n   * @param {number} channel NoteOff するチャンネル.\n   */\n  allNoteOff(channel) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n\n    // ホールドを解除\n    this.hold(channel, 0);\n\n    // 再生中の音をすべて止める\n    while (currentNoteOn.length > 0) {\n      this.noteOff(channel, currentNoteOn[0].key, 0);\n    }\n  }\n\n  /**\n   * @param {number} channel 音を消すチャンネル.\n   */\n  allSoundOff(channel) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {SynthesizerNote} */\n    let note;\n\n    while (currentNoteOn.length > 0) {\n      note = currentNoteOn.shift();\n      this.noteOff(channel, note.key, 0);\n      note.release();\n      note.disconnect();\n    }\n\n    // ホールドを解除\n    this.hold(channel, 0);\n  }\n\n  /**\n   * @param {number} channel リセットするチャンネル\n   */\n  resetAllControl(channel) {\n    this.allNoteOff(channel);\n    this.expression(channel, 127);\n    this.pitchBend(channel, 0x00, 0x40);\n  }\n\n  /**\n   * @param {number} channel ミュートの設定を変更するチャンネル.\n   * @param {boolean} mute ミュートにするなら true.\n   */\n  mute(channel, mute) {\n    /** @type {Array.<SynthesizerNote>} */\n    const currentNoteOn = this.currentNoteOn[channel];\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n\n    this.channelMute[channel] = mute;\n\n    if (mute) {\n      for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n        currentNoteOn[i].disconnect();\n      }\n    } else {\n      for (i = 0, il = currentNoteOn.length; i < il; ++i) {\n        currentNoteOn[i].connect();\n      }\n    }\n  }\n\n  /**\n   * @param {number} channel TODO:ドラムパートとしてセットするチャンネル\n   * @param {boolean} sw ドラムか通常かのスイッチ\n   */\n  setPercussionPart(channel, sw) {\n    if (!this.isXG) {\n      this.channelBank[channel] = 128;\n    } else {\n      this.channelBank[channel] = 127;\n    }\n    this.percussionPart[channel] = sw;\n  }\n}\n\nexport default Synthesizer;\n","/**\n * SynthesizerNote Class\n * @private\n */\nexport class SynthesizerNote {\n  /**\n   * @param {AudioContext} ctx\n   * @param {AudioNode} destination\n   * @param {{\n   *   channel: number,\n   *   key: number,\n   *   sample: Uint8Array,\n   *   basePlaybackRate: number,\n   *   loopStart: number,\n   *   loopEnd: number,\n   *   volume: number,\n   *   panpot: number\n   * }} instrument\n   */\n  constructor(ctx, destination, instrument) {\n    /** @type {AudioContext} */\n    this.ctx = ctx;\n    /** @type {AudioNode} */\n    this.destination = destination;\n    /** @type {{\n     *   channel: number,\n     *   key: number,\n     *   sample: Uint8Array,\n     *   basePlaybackRate: number,\n     *   loopStart: number,\n     *   loopEnd: number,\n     *   volume: number,\n     *   panpot: number\n     * }}\n     */\n    this.instrument = instrument;\n    /** @type {number} */\n    this.channel = instrument['channel'];\n    /** @type {number} */\n    this.key = instrument['key'];\n    /** @type {number} */\n    this.velocity = instrument['velocity'];\n    /** @type {Int16Array} */\n    this.buffer = instrument['sample'];\n    /** @type {number} */\n    this.playbackRate = instrument['basePlaybackRate'];\n    /** @type {number} */\n    this.loopStart = instrument['loopStart'];\n    /** @type {number} */\n    this.loopEnd = instrument['loopEnd'];\n    /** @type {number} */\n    this.sampleRate = instrument['sampleRate'];\n    /** @type {number} */\n    this.volume = instrument['volume'];\n    /** @type {number} */\n    this.panpot = instrument['panpot'];\n    /** @type {number} */\n    this.pitchBend = instrument['pitchBend'];\n    /** @type {number} */\n    this.pitchBendSensitivity = instrument['pitchBendSensitivity'];\n    /** @type {number} */\n    this.modEnvToPitch = instrument['modEnvToPitch'];\n    /** @type {number} */\n    this.expression = instrument['expression'];\n    /** @type {number} */\n    this.cutOffFrequency = instrument['cutOffFrequency'];\n    /** @type {number} */\n    this.hermonicContent = instrument['hermonicContent'];\n\n    /** @type {Reverb} */\n    this.reverb = instrument['reverb'];\n\n    // state\n    /** @type {number} */\n    this.startTime = ctx.currentTime;\n    /** @type {number} */\n    this.computedPlaybackRate = this.playbackRate | 0;\n    /** @type {boolean} */\n    this.noteOffState = false;\n\n    // ---------------------------------------------------------------------------\n    // audio node\n    // ---------------------------------------------------------------------------\n\n    /** @type {AudioBuffer} */\n    this.audioBuffer;\n    /** @type {AudioBufferSourceNode} */\n    this.bufferSource = ctx.createBufferSource();\n    /** @type {StereoPannerNode} */\n    this.panner = ctx.createPanner();\n    /** @type {GainNode} */\n    this.outputGainNode = ctx.createGain();\n    /** @type {GainNode} */\n    this.expressionGainNode = ctx.createGain();\n    /** @type {BiquadFilterNode} */\n    this.filter = ctx.createBiquadFilter();\n    /** @type {BiquadFilterNode} */\n    this.modulator = ctx.createBiquadFilter();\n  }\n\n  /**\n   */\n  noteOn() {\n    /** @type {AudioContext} */\n    const ctx = this.ctx;\n    /** @type {{\n     *   channel: number,\n     *   key: number,\n     *   sample: Uint8Array,\n     *   basePlaybackRate: number,\n     *   loopStart: number,\n     *   loopEnd: number,\n     *   volume: number,\n     *   panpot: number\n     * }} */\n    const instrument = this.instrument;\n    /** @type {number} */\n    const now = this.ctx.currentTime || 0;\n    /** @type {number} */\n    const volDelay = now + instrument['volDelay'];\n    /** @type {number} */\n    const modDelay = now + instrument['modDelay'];\n    /** @type {number} */\n    const volAttack = volDelay + instrument['volAttack'];\n    /** @type {number} */\n    const modAttack = volDelay + instrument['modAttack'];\n    /** @type {number} */\n    const volHold = volAttack + instrument['volHold'];\n    /** @type {number} */\n    const modHold = modAttack + instrument['modHold'];\n    /** @type {number} */\n    const volDecay = volHold + instrument['volDecay'];\n    /** @type {number} */\n    const modDecay = modHold + instrument['modDecay'];\n    /** @type {number} */\n    const loopStart = instrument['loopStart'] / this.sampleRate;\n    /** @type {number} */\n    const loopEnd = instrument['loopEnd'] / this.sampleRate;\n    /** @type {number} */\n    const startTime = instrument['start'] / this.sampleRate;\n    // TODO: ドラムパートのPanが変化した場合、その計算をしなければならない\n    // http://cpansearch.perl.org/src/PJB/MIDI-SoundFont-1.08/doc/sfspec21.html#8.4.6\n    /** @type {number} */\n    const pan = instrument['pan'] !== void 0 ? instrument['pan'] : this.panpot;\n    /** @type {number} */\n    // const cutOffFrequency = instrument['cutOffFrequency']; // (Brightness)\n    /** @type {number} */\n    // const harmonicContent = instrument['harmonicContent']; // (Resonance)\n\n    const sample = this.buffer.subarray(0, this.buffer.length + instrument['end']);\n    /** @type {AudioBuffer} */\n    const buffer = this.audioBuffer = ctx.createBuffer(1, sample.length, this.sampleRate);\n    /** @type {Float32Array} */\n    const channelData = buffer.getChannelData(0);\n    channelData.set(sample);\n\n    // buffer source\n    /** @type {AudioBufferSourceNode} */\n    const bufferSource = this.bufferSource;\n    bufferSource.buffer = buffer;\n    bufferSource.loop = instrument['sampleModes'] | 0 || 0;\n    bufferSource.loopStart = loopStart;\n    bufferSource.loopEnd = loopEnd;\n    this.updatePitchBend(this.pitchBend);\n\n    // Output\n    /** @type {GainNode} */\n    const output = this.outputGainNode;\n\n    // expression\n    this.expressionGainNode.gain.value = this.expression / 127;\n\n    // panpot\n    /** @type {StereoPannerNode} */\n    const panner = this.panner;\n    panner.panningModel = 'equalpower';\n    // panner.distanceModel = 'inverse';\n    panner.setPosition(\n      Math.sin(pan * Math.PI / 2),\n      0,\n      Math.cos(pan * Math.PI / 2),\n    );\n\n    // ---------------------------------------------------------------------------\n    // Delay, Attack, Hold, Decay, Sustain\n    // ---------------------------------------------------------------------------\n\n    /** @type {number} */\n    let volume = this.volume * (this.velocity / 127) * (1 - instrument['initialAttenuation'] / 1000);\n    if (volume < 0) {\n      volume = 0;\n    }\n\n    // volume envelope\n    /** @type {AudioNode} */\n    const outputGain = output.gain;\n    outputGain.setValueAtTime(0, now);\n    outputGain.setValueAtTime(0, volDelay);\n    outputGain.setTargetAtTime(volume, volDelay, instrument['volAttack']);\n    outputGain.setValueAtTime(volume, volHold);\n    outputGain.linearRampToValueAtTime(volume * (1 - instrument['volSustain']), volDecay);\n\n    // modulation envelope\n    /** @type {number} */\n    const baseFreq = this.amountToFreq(instrument['initialFilterFc']);\n    /** @type {number} */\n    const peekFreq = this.amountToFreq(instrument['initialFilterFc'] + instrument['modEnvToFilterFc']);\n    /** @type {number} */\n    const sustainFreq = baseFreq + (peekFreq - baseFreq) * (1 - instrument['modSustain']);\n\n    /** @type {BiquadFilterNode} */\n    const modulator = this.modulator;\n    modulator.Q.setValueAtTime(10 ** (instrument['initialFilterQ'] / 200), now);\n    modulator.frequency.value = baseFreq;\n    modulator.type = 'lowpass';\n    modulator.frequency.setTargetAtTime(baseFreq / 127, this.ctx.currentTime, 0.5);\n    modulator.frequency.setValueAtTime(baseFreq, now);\n    modulator.frequency.setValueAtTime(baseFreq, modDelay);\n    modulator.frequency.setTargetAtTime(peekFreq, modDelay, parseFloat(instrument['modAttack'] + 1)); // For FireFox fix\n    modulator.frequency.setValueAtTime(peekFreq, modHold);\n    modulator.frequency.linearRampToValueAtTime(sustainFreq, modDecay);\n\n    // filter\n    /*\n    const filter = this.filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = this.ctx.sampleRate / 2;\n    filter.gain.value = 0;\n    filter.Q.value = 0;\n    // console.log(this.sampleRate, 'Hz');\n    filter.frequency.value = (cutOffFrequency / this.sampleRate) * 100000; // Brightness = 0 ~ 127  64 = 350 / LPF 100~20000\n    // console.log('Brightness:', cutOffFrequency, ' = ', filter.frequency.value, 'Hz');\n    filter.Q.value = harmonicContent < 0 ? 0 : harmonicContent - 64; // Resonance 0 ~ 127 / Q = 0~50\n    // console.log('Resonance:', harmonicContent, ' = ', filter.Q.value);\n    */\n\n    // connect\n    bufferSource.connect(modulator);\n    modulator.connect(panner);\n    panner.connect(this.expressionGainNode);\n\n    /*\n    this.expressionGainNode.connect(filter);\n    filter.connect(output);\n    */\n    this.expressionGainNode.connect(output);\n\n    if (!instrument['mute']) {\n      this.connect();\n    }\n\n    // fire\n    bufferSource.start(0, startTime);\n  }\n\n  /**\n   * @param {number} val\n   * @return {number}\n   */\n  amountToFreq(val) {\n    return 2 ** ((val - 6900) / 1200) * 440;\n  }\n\n  /**\n   */\n  noteOff() {\n    this.noteOffState = true;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isNoteOff() {\n    return this.noteOffState;\n  }\n\n  /**\n   * @return {void}\n   */\n  release() {\n    /** @type {{\n     *   channel: number,\n     *   key: number,\n     *   sample: Uint8Array,\n     *   basePlaybackRate: number,\n     *   loopStart: number,\n     *   loopEnd: number,\n     *   volume: number,\n     *   panpot: number\n     * }} */\n    const instrument = this.instrument;\n    /** @type {AudioBufferSourceNode} */\n    const bufferSource = this.bufferSource;\n    /** @type {GainNode} */\n    const output = this.outputGainNode;\n    /** @type {number} */\n    const now = this.ctx.currentTime;\n    const release = instrument['releaseTime'] - 64;\n\n    // ---------------------------------------------------------------------------\n    // volume release time\n    // ---------------------------------------------------------------------------\n    /** @type {number} */\n    const volEndTimeTmp = instrument['volRelease'] * output.gain.value;\n    /** @type {number} */\n    const volEndTime = now + (volEndTimeTmp * (1 + release / (release < 0 ? 64 : 63)));\n    // var volEndTime = now + instrument['volRelease'] * (1 - instrument['volSustain']);\n\n    // ---------------------------------------------------------------------------\n    // modulation release time\n    // ---------------------------------------------------------------------------\n    /** @type {BiquadFilterNode} */\n    const modulator = this.modulator;\n    /** @type {number} */\n    const baseFreq = this.amountToFreq(instrument['initialFilterFc']);\n    /** @type {number} */\n    const peekFreq = this.amountToFreq(instrument['initialFilterFc'] + instrument['modEnvToFilterFc']);\n    /** @type {number} */\n    const modEndTime = now + instrument['modRelease'] *\n      (\n        baseFreq === peekFreq ?\n          1 :\n          (modulator.frequency.value - baseFreq) / (peekFreq - baseFreq)\n      );\n    // var modEndTime = now + instrument['modRelease'] * (1 - instrument['modSustain']);\n\n    if (!this.audioBuffer) {\n      return;\n    }\n\n    // ---------------------------------------------------------------------------\n    // Release\n    // ---------------------------------------------------------------------------\n\n    switch (instrument['sampleModes']) {\n      case 0:\n        break;\n      case 1:\n        output.gain.cancelScheduledValues(0);\n        output.gain.setValueAtTime(output.gain.value, now);\n        output.gain.linearRampToValueAtTime(0, volEndTime);\n\n        modulator.frequency.cancelScheduledValues(0);\n        modulator.frequency.setValueAtTime(modulator.frequency.value, now);\n        modulator.frequency.linearRampToValueAtTime(baseFreq, modEndTime);\n\n        bufferSource.playbackRate.cancelScheduledValues(0);\n        bufferSource.playbackRate.setValueAtTime(bufferSource.playbackRate.value, now);\n        bufferSource.playbackRate.linearRampToValueAtTime(this.computedPlaybackRate, modEndTime);\n\n        bufferSource.stop(volEndTime);\n        break;\n      case 2:\n        console.log('detect unused sampleModes');\n        break;\n      case 3:\n        bufferSource.loop = false;\n        bufferSource.disconnect();\n        bufferSource.buffer = null;\n        break;\n    }\n  }\n\n  /**\n   */\n  connect() {\n    this.reverb.connect(this.outputGainNode).connect(this.destination);\n  }\n\n  /**\n   */\n  disconnect() {\n    this.outputGainNode.disconnect(0);\n  }\n  /**\n   */\n  schedulePlaybackRate() {\n    const playbackRate = this.bufferSource.playbackRate;\n    /** @type {number} */\n    const computed = this.computedPlaybackRate;\n    /** @type {number} */\n    const start = this.startTime;\n    /** @type {Object} */\n    const instrument = this.instrument;\n    /** @type {number} */\n    const modAttack = start + instrument['modAttack'];\n    /** @type {number} */\n    const modDecay = modAttack + instrument['modDecay'];\n    /** @type {number} */\n    const peekPitch = computed *\n      1.0594630943592953 // Math.pow(2, 1 / 12)\n      **\n      (this.modEnvToPitch * this.instrument['scaleTuning']);\n\n    playbackRate.cancelScheduledValues(0);\n    playbackRate.setValueAtTime(computed, start);\n    playbackRate.linearRampToValueAtTime(peekPitch, modAttack);\n    playbackRate.linearRampToValueAtTime(computed + (peekPitch - computed) * (1 - instrument['modSustain']), modDecay);\n  }\n\n  /**\n   * @param {number} expression\n   */\n  updateExpression(expression) {\n    this.expressionGainNode.gain.value = (this.expression = expression) / 127;\n  }\n\n  /**\n   * @param {number} pitchBend\n   */\n  updatePitchBend(pitchBend) {\n    this.computedPlaybackRate = this.playbackRate * (\n      1.0594630943592953 // Math.pow(2, 1 / 12)\n      **\n      ((pitchBend / (pitchBend < 0 ? 8192 : 8191)) *\n        this.pitchBendSensitivity *\n        this.instrument['scaleTuning']));\n    this.schedulePlaybackRate();\n  }\n}\n\nexport default SynthesizerNote;\n","import Meta from './meta.js';\nimport Synthesizer from './sound_font_synth';\n\n/**\n * WebMidiLink Class\n */\nexport class WebMidiLink {\n  /**\n   * @param {object} option\n   */\n  constructor(option = {}) {\n    /** @type {Array.<number>} */\n    this.NrpnMsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.NrpnLsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.RpnMsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {Array.<number>} */\n    this.RpnLsb = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    /** @type {boolean} */\n    this.ready = false;\n    /** @type {Synthesizer} */\n    this.synth;\n    /** @type {function(ArrayBuffer)} */\n    this.loadCallback = () => { };\n    /** @type {Function} */\n    this.messageHandler = this.onmessage.bind(this);\n    /** @type {XMLHttpRequest} */\n    this.xhr;\n    /** @type {boolean} */\n    this.rpnMode = true;\n    /** @type {object} */\n    this.option = option;\n    /** @type {boolean} */\n    this.option.drawSynth = option.drawSynth !== void 0 ? option.drawSynth : true;\n    /** @type {boolean} */\n    this.option.cache = option.cache !== void 0 ? option.cache : true;\n    /** @type {HTMLElement} */\n    this.placeholder = option.placeholder !== void 0 ? document.getElementById(option.placeholder) : window.document.body;\n    /** @type {Window} */\n    this.opener;\n    /** @type {number} */\n    this.version = Meta.version;\n    /** @type {string} */\n    this.build = Meta.date;\n\n    // eslint-disable-next-line space-before-function-paren\n    window.addEventListener('DOMContentLoaded', function () {\n      this.ready = true;\n    }.bind(this), false);\n  };\n\n  /**\n   * @param {string} url\n   * @export\n   */\n  setup(url) {\n    /** @type {Window} */\n    const w = window;\n\n    if (!this.ready) {\n      w.addEventListener('DOMContentLoaded', function onload() {\n        w.removeEventListener('DOMContentLoaded', onload, false);\n        this.load(url);\n      }.bind(this), false);\n    } else {\n      this.load(url);\n    }\n\n    if (w.opener) {\n      this.opener = w.opener;\n    } else if (w.parent !== w) {\n      this.opener = w.parent;\n    }\n  }\n\n  /**\n   * @param {string} url\n   * @export\n   */\n  load(url) {\n    /** @type {Window} */\n    const opener = window.opener ? window.opener : window.parent;\n    /** @type {HtmlDIVElement} */\n    const loading = this.placeholder.appendChild(document.createElement('div'));\n    /** @type {HTMLStrongElement} */\n    const loadingText = loading.appendChild(document.createElement('strong'));\n    /** @type {WebMidiLink} */\n    const self = this;\n\n    opener.postMessage('link,progress', '*');\n    loadingText.innerText = 'Now Loading...';\n\n    const ready = (stream) => {\n      console.info('ready');\n      loadingText.innerText = 'Parsing SoundFont...';\n      self.onload(stream);\n      if (typeof self.loadCallback === 'function') {\n        self.loadCallback(stream);\n      }\n      self.placeholder.removeChild(loading);\n      opener.postMessage('link,ready', '*');\n    };\n\n    if (this.option.cache && window.caches) {\n      // キャッシュが利用可能な場合\n      loadingText.className = 'ml-1';\n\n      loading.className = 'd-flex';\n\n      /** @type {HTMLDivElement} */\n      const spiner = loading.appendChild(document.createElement('div'));\n      spiner.className = 'spinner-border text-primary';\n      spiner.role = 'status';\n      spiner.ariaHidden = true;\n\n      window.caches.open('wml').then((cache) => {\n        cache\n          .match(url)\n          .then((response) => response.arrayBuffer())\n          .then((stream) => ready(stream))\n          .catch(() => {\n            console.info('Fetch from server.');\n            fetch(url)\n              .then((response) => {\n                if (!response.ok) {\n                  throw new Error('Network response was not ok.');\n                }\n                const total = response.headers.get('content-length');\n                loadingText.innerText += ' (' + total + 'byte)';\n                const copy = response.clone();\n                cache.put(url, response);\n                return copy.arrayBuffer();\n              })\n              .then((stream) => ready(stream))\n              .catch((e) => {\n                console.error(e);\n                alert('There has been a problem with your fetch operation: ' + e.message);\n              });\n          });\n      });\n    } else {\n      // キャッシュが使えない場合\n      console.info('This server/client does not cache function.');\n\n      // プログレスバーを表示（こっちの処理系はCacheStorageが使えないときのみ使われる。）\n\n      /** @type {HTMLDivElement} */\n      const progress =\n        loading.appendChild(document.createElement('div'));\n      progress.className = 'progress';\n      /** @type {HTMLDivElement} */\n      const progressBar =\n        progress.appendChild(document.createElement('div'));\n      progressBar.className = 'progress-bar';\n      progressBar.role = 'progressbar';\n      progressBar.innerText = '0%';\n\n      // 結合処理\n      const concatenation = (segments) => {\n        let sumLength = 0;\n        for (let i = 0; i < segments.length; ++i) {\n          sumLength += segments[i].byteLength;\n        }\n        const whole = new Uint8Array(sumLength);\n        let pos = 0;\n        for (let i = 0; i < segments.length; ++i) {\n          whole.set(new Uint8Array(segments[i]), pos);\n          pos += segments[i].byteLength;\n        }\n        return whole.buffer;\n      };\n\n      fetch(url)\n        .then((res) => {\n          // 全体サイズ\n          const total = res.headers.get('content-length');\n          progress.max = total;\n\n          // body の reader を取得する\n          const reader = res.body.getReader();\n          let chunk = 0;\n          const buffer = [];\n          const processResult = (result) => {\n            // done が true なら最後の chunk\n            if (result.done) {\n              const stream = concatenation(buffer);\n              ready(stream);\n              return;\n            }\n\n            // chunk の長さの蓄積を total で割れば進捗が分かる\n            chunk += result.value.length;\n            buffer.push(result.value);\n            // 進捗を更新\n            const percentage = Math.round((chunk / total) * 100);\n            progressBar.style.width = percentage + '%';\n            progressBar.innerText = percentage + ' %';\n            opener.postMessage('link,progress,' + chunk + ',' + total, '*');\n\n            // 再帰する\n            return reader.read().then(processResult);\n          };\n          reader.read().then(processResult);\n        })\n        .catch((e) => alert('There has been a problem with your fetch operation: ' + e.message));\n    }\n  }\n\n  /**\n   * @param {boolean} sw\n   * @export\n   */\n  setReverb(sw) {\n    this.synth.setReverb(sw);\n  }\n\n  /**\n   * @param {ArrayBuffer} response\n   */\n  onload(response) {\n    /** @type {Uint8Array} */\n    const input = new Uint8Array(response);\n\n    this.loadSoundFont(input);\n  }\n\n  /**\n   * @param {Uint8Array} input\n   */\n  loadSoundFont(input) {\n    /** @type {Synthesizer} */\n    let synth;\n    /** @type {Window} */\n    const w = window;\n\n    if (!this.synth) {\n      synth = this.synth = new Synthesizer(input);\n      if (this.option.drawSynth) {\n        this.placeholder.appendChild(synth.drawSynth());\n      }\n      synth.init();\n      synth.start();\n      w.addEventListener('message', this.messageHandler, false);\n    } else {\n      synth = this.synth;\n      synth.refreshInstruments(input);\n    }\n\n    // link ready\n    w.postMessage('link,ready', '*');\n  };\n\n  /**\n   * @param {Event} ev\n   */\n  onmessage(ev) {\n    /** @type {Array} */\n    const msg = typeof ev.data.split === 'function' ? ev.data.split(',') : [];\n    /** @type {string} */\n    const type = msg !== [] ? msg.shift() : '';\n    /** @type {Window} */\n    const opener = window.opener ? window.opener : window.parent;\n    /** @type {string} */\n    let command;\n\n    switch (type) {\n      case 'midi':\n        this.processMidiMessage(msg.map((hex) => {\n          return parseInt(hex, 16);\n        }));\n        break;\n      case 'link':\n        if (opener === void 0) {\n          return;\n        }\n        command = msg.shift();\n        switch (command) {\n          case 'reqpatch':\n            // TODO: dummy data\n            opener.postMessage('link,patch', '*');\n            break;\n          case 'setpatch':\n          case 'ready':\n            opener.postMessage('link,ready', '*');\n            // TODO: NOP\n            break;\n          case 'progress':\n            opener.postMessage('link,progress', '*');\n            break;\n          default:\n            console.error('unknown link message:', command);\n            break;\n        }\n        break;\n      default:\n      // console.error('unknown message type');\n    }\n  };\n\n  /**\n   * @param {function(ArrayBuffer)} callback\n   * @export\n   */\n  setLoadCallback(callback) {\n    this.loadCallback = callback;\n  };\n\n  /**\n   * @param {Array.<number>} message\n   */\n  processMidiMessage(message) {\n    /** @type {number} */\n    const channel = message[0] & 0x0f;\n    /** @type {Synthesizer} */\n    const synth = this.synth;\n\n    switch (message[0] & 0xf0) {\n      case 0x80: // NoteOff: 8n kk vv\n        synth.noteOff(channel, message[1], message[2]);\n        break;\n      case 0x90: // NoteOn: 9n kk vv\n        if (message[2] > 0) {\n          synth.noteOn(channel, message[1], message[2]);\n        } else {\n          synth.noteOff(channel, message[1], 0);\n        }\n        break;\n      case 0xB0: // Control Change: Bn cc dd\n        /** @type {number} */\n        const value = message[2];\n        switch (message[1]) {\n          case 0x00: // Bank Select MSB: Bn 00 dd\n            synth.bankSelectMsb(channel, value);\n            break;\n          case 0x01: // Modulation\n            break;\n          case 0x06: // Data Entry(MSB): Bn 06 dd\n            if (this.rpnMode) {\n              // RPN\n              switch (this.RpnMsb[channel]) {\n                case 0:\n                  switch (this.RpnLsb[channel]) {\n                    case 0: // Pitch Bend Sensitivity\n                      synth.pitchBendSensitivity(channel, value);\n                      break;\n                    case 1:\n                      // console.log(\"fine\");\n                      break;\n                    case 2:\n                      // console.log(\"coarse\");\n                      break;\n                    default:\n                      // console.log(\"default\");\n                      break;\n                  }\n                  break;\n                default:\n                  // console.log(\"default:\", this.RpnMsb[channel], this.RpnLsb[channel]);\n                  break;\n              }\n            } else {\n              // NRPN\n              switch (this.NrpnMsb[channel]) {\n                case 26: // Drum Instrument Level\n                  synth.drumInstrumentLevel(this.NrpnLsb[channel], value);\n                  break;\n                default:\n                  // console.log(\"default:\", this.RpnMsb[channel], this.RpnLsb[channel]);\n                  break;\n              }\n            }\n            break;\n          case 0x26: // Data Entry(LSB): Bn 26 dd\n            if (this.rpnMode) {\n              // RPN\n              switch (this.RpnMsb[channel]) {\n                case 0:\n                  switch (this.RpnLsb[channel]) {\n                    case 0: // Pitch Bend Sensitivity\n                      synth.pitchBendSensitivity(\n                        channel,\n                        synth.getPitchBendSensitivity(channel) + value / 100,\n                      );\n                      break;\n                    case 1:\n                      // console.log(\"fine\");\n                      break;\n                    case 2:\n                      // console.log(\"coarse\");\n                      break;\n                  }\n                  break;\n              }\n            }\n            // NRPN で LSB が必要なものは今のところない\n            break;\n          case 0x07: // Volume Change: Bn 07 dd\n            synth.volumeChange(channel, value);\n            break;\n          case 0x0A: // Panpot Change: Bn 0A dd\n            synth.panpotChange(channel, value);\n            break;\n          case 0x78: // All Sound Off: Bn 78 00\n            synth.allSoundOff(channel);\n            break;\n          case 0x79: // Reset All Control: Bn 79 00\n            synth.resetAllControl(channel);\n            break;\n          case 0x20: // BankSelect LSB: Bn 00 dd\n            synth.bankSelectLsb(channel, value);\n            break;\n          case 0x47: // Harmonic Content\n            synth.harmonicContent(channel, value);\n            break;\n          case 0x60: //\n            // console.log(60);\n            break;\n          case 0x61: //\n            // console.log(61);\n            break;\n          case 0x62: // NRPN LSB\n            this.rpnMode = false;\n            this.NrpnLsb[channel] = value;\n            break;\n          case 0x63: // NRPN MSB\n            this.rpnMode = false;\n            this.NrpnMsb[channel] = value;\n            break;\n          case 0x64: // RPN LSB\n            this.rpnMode = true;\n            this.RpnLsb[channel] = value;\n            break;\n          case 0x65: // RPN MSB\n            this.rpnMode = true;\n            this.RpnMsb[channel] = value;\n            break;\n          case 0x40: // Hold\n            synth.hold(channel, value);\n            break;\n          case 0x0b: // Expression\n            synth.expression(channel, value);\n            break;\n          case 0x48: // DecayTyme\n            synth.decayTime(channel, value);\n            break;\n          case 0x49: // ReleaseTime\n            synth.releaseTime(channel, value);\n            break;\n          case 0x4A: // Attack time\n            synth.attackTime(channel, value);\n            break;\n          case 0x4B: // Brightness\n            synth.cutOffFrequency(channel, value);\n            break;\n          case 0x5B: // Effect1 Depth（Reverb Send Level）\n            synth.reverbDepth(channel, value);\n            break;\n          default:\n            // not supported\n            break;\n        }\n        break;\n      case 0xC0: // Program Change: Cn pp\n        synth.programChange(channel, message[1]);\n        break;\n      case 0xE0: // Pitch Bend\n        synth.pitchBend(channel, message[1], message[2]);\n        break;\n      case 0xf0: // System Exclusive Message\n        // ID number\n        switch (message[1]) {\n          case 0x7e: // non-realtime\n            // TODO\n            // GM Reset: F0 7E 7F 09 01 F7\n            if (message[2] === 0x7f && message[3] === 0x09 && message[4] === 0x01) {\n              synth.init('GM');\n            }\n            break;\n          case 0x7f: // realtime\n            // sub ID 1\n            switch (message[3]) {\n              case 0x04: // device control\n                // sub ID 2\n                switch (message[4]) {\n                  case 0x01: // master volume: F0 7F 7F 04 01 [value] [value] F7\n                    synth.setMasterVolume(message[5] + (message[6] << 7));\n                    break;\n                }\n                break;\n            }\n            break;\n        }\n\n        // Vendor\n        switch (message[2]) {\n          case 0x43: // Yamaha XG\n            if (message[5] === 0x08) {\n              // XG Dram Part: F0 43 [dev] 4C 08 [partNum] 07 [map] F7\n              // but there is no file to use much this parameter...\n              if (message[7] !== 0x00) { // [map]\n                synth.setPercussionPart(message[6], true);\n              } else {\n                synth.setPercussionPart(message[6], false);\n              }\n              // console.log(message);\n            }\n            switch (message[7]) {\n              case 0x04:\n                // XG Master Volume: F0 43 [dev] 4C 00 00 04 [value] F7\n                synth.setMasterVolume((message[8] << 7) * 2);\n                // console.log(message[8] << 7);\n                break;\n              case 0x7E:\n                // XG Reset: F0 43 [dev] 4C 00 00 7E 00 F7\n                synth.init('XG');\n                console.log('XG Reset');\n                break;\n            }\n            break;\n          case 0x41: // Roland GS / TG300B Mode\n            // TODO\n            switch (message[8]) {\n              case 0x04:\n                // GS Master Volume: F0 41 [dev] 42 12 40 00 04 [value] 58 F7\n                synth.setMasterVolume(message[9] << 7);\n                break;\n              case 0x7F:\n                // GS Reset: F0 41 [dev] 42 12 40 00 7F 00 41 F7\n                synth.init('GS');\n                console.log('GS Reset');\n                break;\n              case 0x15:\n                // GS Dram part: F0 41 [dev] 42 12 40 1[part no] [Map] [sum] F7\n                // Notice: [sum] is ignroe in this program.\n                // http://www.ssw.co.jp/dtm/drums/drsetup.htm\n                // http://www.roland.co.jp/support/by_product/sd-20/knowledge_base/1826700/\n\n                const part = message[7] - 0x0F;\n                const map = message[8];\n                if (part === 0) {\n                  // 10 Ch.\n                  if (map !== 0x00) {\n                    synth.setPercussionPart(9, true);\n                  } else {\n                    synth.setPercussionPart(9, false);\n                  }\n                } else if (part >= 10) {\n                  // 1~9 Ch.\n                  if (map !== 0x00) {\n                    synth.setPercussionPart(part - 1, true);\n                  } else {\n                    synth.setPercussionPart(part - 1, false);\n                  }\n                } else {\n                  // 11~16 Ch.\n                  if (map !== 0x00) {\n                    synth.setPercussionPart(part, true);\n                  } else {\n                    synth.setPercussionPart(part, false);\n                  }\n                }\n                break;\n            }\n            break;\n        }\n        break;\n      default: // not supported\n        synth.setPercussionPart(9, true);\n        break;\n    }\n  };\n}\n\nexport default WebMidiLink;\n"],"sourceRoot":""}