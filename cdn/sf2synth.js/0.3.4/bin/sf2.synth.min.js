/*! For license information please see sf2.synth.min.js.LICENSE */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SoundFont",[],t):"object"==typeof exports?exports.SoundFont=t():e.SoundFont=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));class s{constructor(e,t={}){this.input=e,this.ip=t.index||0,this.length=t.length||e.length-this.ip,this.chunkList,this.offset=this.ip,this.padding=void 0===t.padding||t.padding,this.bigEndian=void 0!==t.bigEndian&&t.bigEndian}parse(){const e=this.length+this.offset;for(this.chunkList=[];this.ip<e;)this.parseChunk()}parseChunk(){const e=this.input;let t,n=this.ip;this.chunkList.push(new i(String.fromCharCode(e[n++],e[n++],e[n++],e[n++]),t=this.bigEndian?(e[n++]<<24|e[n++]<<16|e[n++]<<8|e[n++])>>>0:(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,n)),n+=t,this.padding&&1==(n-this.offset&1)&&n++,this.ip=n}getChunk(e){const t=this.chunkList[e];return void 0===t?null:t}getNumberOfChunks(){return this.chunkList.length}}class i{constructor(e,t,n){this.type=e,this.size=t,this.offset=n}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Parser",(function(){return i}));var s=n(0);class i{constructor(e,t={}){this.input=e,this.parserOption=t.parserOption||{},this.sampleRate=t.sampleRate||22050,this.presetHeader,this.presetZone,this.presetZoneModulator,this.presetZoneGenerator,this.instrument,this.instrumentZone,this.instrumentZoneModulator,this.instrumentZoneGenerator,this.sampleHeader,this.GeneratorEnumeratorTable=["startAddrsOffset","endAddrsOffset","startloopAddrsOffset","endloopAddrsOffset","startAddrsCoarseOffset","modLfoToPitch","vibLfoToPitch","modEnvToPitch","initialFilterFc","initialFilterQ","modLfoToFilterFc","modEnvToFilterFc","endAddrsCoarseOffset","modLfoToVolume",,"chorusEffectsSend","reverbEffectsSend","pan",,,,"delayModLFO","freqModLFO","delayVibLFO","freqVibLFO","delayModEnv","attackModEnv","holdModEnv","decayModEnv","sustainModEnv","releaseModEnv","keynumToModEnvHold","keynumToModEnvDecay","delayVolEnv","attackVolEnv","holdVolEnv","decayVolEnv","sustainVolEnv","releaseVolEnv","keynumToVolEnvHold","keynumToVolEnvDecay","instrument",,"keyRange","velRange","startloopAddrsCoarseOffset","keynum","velocity","initialAttenuation",,"endloopAddrsCoarseOffset","coarseTune","fineTune","sampleID","sampleModes",,"scaleTuning","exclusiveClass","overridingRootKey","endOper"]}parse(){const e=new s.a(this.input,this.parserOption);if(e.parse(),1!==e.chunkList.length)throw new Error("wrong chunk length");const t=e.getChunk(0);if(null===t)throw new Error("chunk not found");this.parseRiffChunk(t),this.input=null}parseRiffChunk(e){const t=this.input;let n=e.offset;if("RIFF"!==e.type)throw new Error("invalid chunk type:"+e.type);const i=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("sfbk"!==i)throw new Error("invalid signature:"+i);const r=new s.a(t,{index:n,length:e.size-4});if(r.parse(),3!==r.getNumberOfChunks())throw new Error("invalid sfbk structure");this.parseInfoList(r.getChunk(0)),this.parseSdtaList(r.getChunk(1)),this.parsePdtaList(r.getChunk(2))}parseInfoList(e){const t=this.input;let n=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);const i=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("INFO"!==i)throw new Error("invalid signature:"+i);new s.a(t,{index:n,length:e.size-4}).parse()}parseSdtaList(e){const t=this.input;let n=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);const i=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("sdta"!==i)throw new Error("invalid signature:"+i);const r=new s.a(t,{index:n,length:e.size-4});if(r.parse(),1!==r.chunkList.length)throw new Error("TODO");this.samplingData=r.getChunk(0)}parsePdtaList(e){const t=this.input;let n=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);const i=String.fromCharCode(t[n++],t[n++],t[n++],t[n++]);if("pdta"!==i)throw new Error("invalid signature:"+i);const r=new s.a(t,{index:n,length:e.size-4});if(r.parse(),9!==r.getNumberOfChunks())throw new Error("invalid pdta chunk");this.parsePhdr(r.getChunk(0)),this.parsePbag(r.getChunk(1)),this.parsePmod(r.getChunk(2)),this.parsePgen(r.getChunk(3)),this.parseInst(r.getChunk(4)),this.parseIbag(r.getChunk(5)),this.parseImod(r.getChunk(6)),this.parseIgen(r.getChunk(7)),this.parseShdr(r.getChunk(8))}parsePhdr(e){const t=this.input;let n=e.offset;const s=this.presetHeader=[],i=e.offset+e.size;if("phdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<i;)s.push({presetName:String.fromCharCode.apply(null,t.subarray(n,n+=20)),preset:t[n++]|t[n++]<<8,bank:t[n++]|t[n++]<<8,presetBagIndex:t[n++]|t[n++]<<8,library:(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,genre:(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,morphology:(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0})}parsePbag(e){const t=this.input;let n=e.offset;const s=this.presetZone=[],i=e.offset+e.size;if("pbag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<i;)s.push({presetGeneratorIndex:t[n++]|t[n++]<<8,presetModulatorIndex:t[n++]|t[n++]<<8})}parsePmod(e){if("pmod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneModulator=this.parseModulator(e)}parsePgen(e){if("pgen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneGenerator=this.parseGenerator(e)}parseInst(e){const t=this.input;let n=e.offset;const s=this.instrument=[],i=e.offset+e.size;if("inst"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<i;)s.push({instrumentName:String.fromCharCode.apply(null,t.subarray(n,n+=20)),instrumentBagIndex:t[n++]|t[n++]<<8})}parseIbag(e){const t=this.input;let n=e.offset;const s=this.instrumentZone=[],i=e.offset+e.size;if("ibag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<i;)s.push({instrumentGeneratorIndex:t[n++]|t[n++]<<8,instrumentModulatorIndex:t[n++]|t[n++]<<8})}parseImod(e){if("imod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneModulator=this.parseModulator(e)}parseIgen(e){if("igen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneGenerator=this.parseGenerator(e)}parseShdr(e){const t=this.input;let n=e.offset;const s=this.sample=[],i=this.sampleHeader=[],r=e.offset+e.size;let o,a,h,c,l,u,d,p,m,f;if("shdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;n<r;){o=String.fromCharCode.apply(null,t.subarray(n,n+=20)),a=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,h=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,c=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,l=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,u=(t[n++]<<0|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,d=t[n++],p=t[n++]<<24>>24,m=t[n++]|t[n++]<<8,f=t[n++]|t[n++]<<8;let e=new Int16Array(new Uint8Array(t.subarray(this.samplingData.offset+2*a,this.samplingData.offset+2*h)).buffer);if(c-=a,l-=a,u>0){const t=this.adjustSampleData(e,u);e=t.sample,u*=t.multiply,c*=t.multiply,l*=t.multiply}s.push(e),i.push({sampleName:o,start:a,end:h,startLoop:c,endLoop:l,sampleRate:u,originalPitch:d,pitchCorrection:p,sampleLink:m,sampleType:f})}}adjustSampleData(e,t){let n,s,i,r,o=1;for(;t<this.sampleRate;){for(n=new Int16Array(2*e.length),s=r=0,i=e.length;s<i;++s)n[r++]=e[s],n[r++]=e[s];e=n,o*=2,t*=2}return{sample:e,multiply:o}}parseModulator(e){const t=this.input;let n=e.offset;const s=e.offset+e.size;let i,r;const o=[];for(;n<s;){if(n+=2,i=t[n++]|t[n++]<<8,r=this.GeneratorEnumeratorTable[i],void 0===r)o.push({type:r,value:{code:i,amount:t[n]|t[n+1]<<8<<16>>16,lo:t[n++],hi:t[n++]}});else switch(r){case"keyRange":case"velRange":case"keynum":case"velocity":o.push({type:r,value:{lo:t[n++],hi:t[n++]}});break;default:o.push({type:r,value:{amount:t[n++]|t[n++]<<8<<16>>16}})}n+=2,n+=2}return o}parseGenerator(e){const t=this.input;let n=e.offset;const s=e.offset+e.size;let i,r;const o=[];for(;n<s;)if(i=t[n++]|t[n++]<<8,r=this.GeneratorEnumeratorTable[i],void 0!==r)switch(r){case"keynum":case"keyRange":case"velRange":case"velocity":o.push({type:r,value:{lo:t[n++],hi:t[n++]}});break;default:o.push({type:r,value:{amount:t[n++]|t[n++]<<8<<16>>16}})}else o.push({type:r,value:{code:i,amount:t[n]|t[n+1]<<8<<16>>16,lo:t[n++],hi:t[n++]}});return o}createInstrument(){const e=this.instrument,t=this.instrumentZone,n=[];let s,i,r,o,a,h,c,l,u;for(h=0,c=e.length;h<c;++h){for(s=e[h].instrumentBagIndex,i=e[h+1]?e[h+1].instrumentBagIndex:t.length,r=[],l=s,u=i;l<u;++l)o=this.createInstrumentGenerator_(t,l),a=this.createInstrumentModulator_(t,l),r.push({generator:o.generator,generatorSequence:o.generatorInfo,modulator:a.modulator,modulatorSequence:a.modulatorInfo});n.push({name:e[h].instrumentName,info:r})}return n}createPreset(){const e=this.presetHeader,t=this.presetZone,n=[];let s,i,r,o,a,h,c,l,u,d;for(c=0,l=e.length;c<l;++c){for(s=e[c].presetBagIndex,i=e[c+1]?e[c+1].presetBagIndex:t.length,r=[],u=s,d=i;u<d;++u)a=this.createPresetGenerator_(t,u),h=this.createPresetModulator_(t,u),r.push({generator:a.generator,generatorSequence:a.generatorInfo,modulator:h.modulator,modulatorSequence:h.modulatorInfo}),o=void 0!==a.generator.instrument?a.generator.instrument.amount:void 0!==h.modulator.instrument?h.modulator.instrument.amount:null;n.push({name:e[c].presetName,info:r,header:e[c],instrument:o})}return n}createInstrumentGenerator_(e,t){const n=this.createBagModGen_(e,e[t].instrumentGeneratorIndex,e[t+1]?e[t+1].instrumentGeneratorIndex:this.instrumentZoneGenerator.length,this.instrumentZoneGenerator);return{generator:n.modgen,generatorInfo:n.modgenInfo}}createInstrumentModulator_(e,t){const n=this.createBagModGen_(e,e[t].presetModulatorIndex,e[t+1]?e[t+1].instrumentModulatorIndex:this.instrumentZoneModulator.length,this.instrumentZoneModulator);return{modulator:n.modgen,modulatorInfo:n.modgenInfo}}createPresetGenerator_(e,t){const n=this.createBagModGen_(e,e[t].presetGeneratorIndex,e[t+1]?e[t+1].presetGeneratorIndex:this.presetZoneGenerator.length,this.presetZoneGenerator);return{generator:n.modgen,generatorInfo:n.modgenInfo}}createPresetModulator_(e,t){const n=this.createBagModGen_(e,e[t].presetModulatorIndex,e[t+1]?e[t+1].presetModulatorIndex:this.presetZoneModulator.length,this.presetZoneModulator);return{modulator:n.modgen,modulatorInfo:n.modgenInfo}}createBagModGen_(e,t,n,s){const i=[],r={unknown:[],keyRange:{hi:127,lo:0}};let o,a,h;for(a=t,h=n;a<h;++a)o=s[a],i.push(o),"unknown"===o.type?r.unknown.push(o.value):r[o.type]=o.value;return{modgen:r,modgenInfo:i}}}t.default=i},function(e,t,n){"use strict";t.a={version:"0.3.4",date:"2019-12-26T16:24:42.544Z"}},function(e,t,n){"use strict";var s=n(4),i=n(1),r=n(5),o=n.n(r);t.a=class{constructor(e){let t,n;for(this.input=e,this.parser={},this.bank=0,this.bankSet={},this.bufferSize=2048,this.ctx=this.getAudioContext(),this.gainMaster=this.ctx.createGain(),this.bufSrc=this.ctx.createBufferSource(),this.channelInstrument=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.channelBank=[0,0,0,0,0,0,0,0,0,0,0,127,0,0,0,0],this.channelVolume=[127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127],this.channelPanpot=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],this.channelPitchBend=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.channelPitchBendSensitivity=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],this.channelExpression=[127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127],this.channelAttack=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],this.channelDecay=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],this.channelSustin=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],this.channelRelease=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],this.channelHold=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.channelHarmonicContent=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],this.channelCutOffFrequency=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],this.isGS=!1,this.isXG=!1,this.programSet=[],this.channelMute=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.currentNoteOn=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this.baseVolume=1/65535,this.masterVolume=16384,this.percussionPart=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1],this.percussionVolume=new Array(128),t=0,n=this.percussionVolume.length;t<n;++t)this.percussionVolume[t]=127;for(this.programSet={},this.reverb=[],t=0;t<16;++t)this.reverb[t]=new o.a(this.ctx,{mix:.315});this.observer=new IntersectionObserver((e,t)=>{e.forEach((e,t)=>{e.target.dataset.isIntersecting=e.isIntersecting})},{})}getAudioContext(){const e=new(window.AudioContext||window.webkitAudioContext);e.createGain=e.createGain||e.createGainNode;const t=()=>{document.removeEventListener("touchstart",t);const n=e.createBufferSource();n.start(),n.stop()};return document.addEventListener("touchstart",t),e}init(e="GM"){let t;for(this.gainMaster.disconnect(),this.parser=new i.default(this.input,{sampleRate:this.ctx.sampleRate}),this.bankSet=this.createAllInstruments(),this.isXG=!1,this.isGS=!1,"XG"==e?this.isXG=!0:"GS"==e&&(this.isGS=!0),t=0;t<16;++t)this.programChange(t,0),this.volumeChange(t,100),this.panpotChange(t,64),this.pitchBend(t,0,64),this.pitchBendSensitivity(t,2),this.channelHold[t]=!1,this.channelExpression[t]=127,this.channelBank[t]=9===t?127:0,this.attackTime(t,64),this.decayTime(t,64),this.sustinTime(t,64),this.releaseTime(t,64),this.harmonicContent(t,64),this.cutOffFrequency(t,64),this.reverbDepth(t,40),this.updateBankSelect(t),this.updateProgramSelect(t);for(this.setPercussionPart(9,!0),t=0;t<128;++t)this.percussionVolume[t]=127;this.gainMaster.connect(this.ctx.destination),this.element.dataset.mode=e}close(){this.ctx.close()}refreshInstruments(e){this.input=e,this.parser=new i.default(e),this.bankSet=this.createAllInstruments()}createAllInstruments(){const e=this.parser;e.parse();const t=e.createPreset(),n=e.createInstrument(),s=[];let i,r,o,a,h,c,l,u,d,p;const m=[];for(c=0,l=t.length;c<l;++c)if(o=t[c],h=o.header.preset,r=o.header.bank,p=o.name.replace(/\0*$/,""),"number"==typeof o.instrument&&(a=n[o.instrument],"EOI"!==a.name.replace(/\0*$/,""))){for(void 0===s[r]&&(s[r]=[]),i=s[r],i[h]={},i[h].name=p,u=0,d=a.info.length;u<d;++u)this.createNoteInfo(e,a.info[u],i[h]);m[r]||(m[r]={}),m[r][h]=p}return this.programSet=m,s}createNoteInfo(e,t,n){const s=t.generator;if(void 0===s.keyRange||void 0===s.sampleID)return;const i=this.getModGenAmount(s,"delayVolEnv",-12e3),r=this.getModGenAmount(s,"attackVolEnv",-12e3),o=this.getModGenAmount(s,"holdVolEnv",-12e3),a=this.getModGenAmount(s,"decayVolEnv",-12e3),h=this.getModGenAmount(s,"sustainVolEnv"),c=this.getModGenAmount(s,"releaseVolEnv",-12e3),l=this.getModGenAmount(s,"delayModEnv",-12e3),u=this.getModGenAmount(s,"attackModEnv",-12e3),d=this.getModGenAmount(s,"holdModEnv",-12e3),p=this.getModGenAmount(s,"decayModEnv",-12e3),m=this.getModGenAmount(s,"sustainModEnv"),f=this.getModGenAmount(s,"releaseModEnv",-12e3),y=this.getModGenAmount(s,"scaleTuning",100)/100,g=this.getModGenAmount(s,"freqVibLFO"),v=this.getModGenAmount(s,"pan"),b=this.getModGenAmount(s,"coarseTune")+this.getModGenAmount(s,"fineTune")/100;for(let t=s.keyRange.lo,k=s.keyRange.hi;t<=k;++t){if(n[t])continue;const k=this.getModGenAmount(s,"sampleID"),w=e.sampleHeader[k];n[t]={sample:e.sample[k],sampleRate:w.sampleRate,sampleModes:this.getModGenAmount(s,"sampleModes"),basePlaybackRate:1.0594630943592953**((t-this.getModGenAmount(s,"overridingRootKey",w.originalPitch)+b+w.pitchCorrection/100)*y),modEnvToPitch:this.getModGenAmount(s,"modEnvToPitch")/100,scaleTuning:y,start:32768*this.getModGenAmount(s,"startAddrsCoarseOffset")+this.getModGenAmount(s,"startAddrsOffset"),end:32768*this.getModGenAmount(s,"endAddrsCoarseOffset")+this.getModGenAmount(s,"endAddrsOffset"),loopStart:w.startLoop+32768*this.getModGenAmount(s,"startloopAddrsCoarseOffset")+this.getModGenAmount(s,"startloopAddrsOffset"),loopEnd:w.endLoop+32768*this.getModGenAmount(s,"endloopAddrsCoarseOffset")+this.getModGenAmount(s,"endloopAddrsOffset"),volDelay:2**(i/1200),volAttack:2**(r/1200),volHold:2**(o/1200)*2**((60-t)*this.getModGenAmount(s,"keynumToVolEnvHold")/1200),volDecay:2**(a/1200)*2**((60-t)*this.getModGenAmount(s,"keynumToVolEnvDecay")/1200),volSustain:h/1e3,volRelease:2**(c/1200),modDelay:2**(l/1200),modAttack:2**(u/1200),modHold:2**(d/1200)*2**((60-t)*this.getModGenAmount(s,"keynumToModEnvHold")/1200),modDecay:2**(p/1200)*2**((60-t)*this.getModGenAmount(s,"keynumToModEnvDecay")/1200),modSustain:m/1e3,modRelease:2**(f/1200),initialFilterFc:this.getModGenAmount(s,"initialFilterFc",13500),modEnvToFilterFc:this.getModGenAmount(s,"modEnvToFilterFc"),initialFilterQ:this.getModGenAmount(s,"initialFilterQ"),reverbEffectSend:this.getModGenAmount(s,"reverbEffectSend"),initialAttenuation:this.getModGenAmount(s,"initialAttenuation"),freqVibLFO:g?2**(g/1200)*8.176:void 0,pan:v?v/1200:void 0}}}getModGenAmount(e,t,n=0){return e[t]?e[t].amount:n}start(){this.connect(),this.bufSrc.start(0),this.setMasterVolume(16383)}setMasterVolume(e){this.masterVolume=e,this.gainMaster.gain.value=this.baseVolume*(e/16384)}connect(){this.bufSrc.connect(this.gainMaster)}disconnect(){this.bufSrc.disconnect(this.gainMaster),this.bufSrc.buffer=null}drawSynth(){const e=window.document,t=this.element=e.createElement("div"),n=e.createElement("div");n.className="instrument";const s=["mute","bank","program","volume","panpot","pitchBend","pitchBendSensitivity","keys"],i="ontouchstart"in window?"touchstart":"mousedown",r="ontouchend"in window?"touchend":"mouseup";for(let t=0;t<16;t++){const o=e.createElement("div");o.className="channel";for(const n in s)if({}.hasOwnProperty.call(s,n)){const a=e.createElement("div");switch(a.className=s[n],s[n]){case"mute":const s=e.createElement("div");s.className="custom-control custom-checkbox custom-control-inline";const o=e.createElement("input");o.setAttribute("type","checkbox"),o.className="custom-control-input",o.id="mute"+t+"ch",o.addEventListener("change",((e,t)=>()=>{e.mute(t,this.checked)})(this,t),!1),s.appendChild(o);const h=e.createElement("label");h.className="custom-control-label",h.textContent=t+1,h.setAttribute("for","mute"+t+"ch"),s.appendChild(h),a.appendChild(s);break;case"bank":const c=e.createElement("select");c.className="form-control form-control-sm",a.appendChild(c);const l=e.createElement("option");c.appendChild(l),c.addEventListener("change",((e,t)=>n=>{e.bankChange(t,n.target.value),e.programChange(t,e.channelElemInstrument[t])})(this,t),!1),c.selectedIndex=this.channelBank[n];break;case"program":const u=e.createElement("select");u.className="form-control form-control-sm",a.appendChild(u),u.addEventListener("change",((e,t)=>n=>{e.programChange(t,n.target.value)})(this,t),!1),u.selectedIndex=this.channelInstrument[n];break;case"volume":a.innerText=100;case"pitchBendSensitivity":a.innerText=2;break;case"panpot":const d=e.createElement("meter");d.min=0,d.max=127,d.value=64,a.appendChild(d);break;case"pitchBend":const p=e.createElement("meter");p.min=-8192,p.max=8192,p.value=0,a.appendChild(p);break;case"keys":for(let n=0;n<127;n++){const s=e.createElement("div"),o=n%12;s.className="key "+([1,3,6,8,10].includes(o)?"semitone":"tone"),a.appendChild(s),s.addEventListener(i,((e,t,n)=>s=>{s.preventDefault(),e.drag=!0,e.noteOn(t,n,127)})(this,t,n)),s.addEventListener("mouseover",((e,t,n)=>s=>{s.preventDefault(),e.drag&&e.noteOn(t,n,127)})(this,t,n)),s.addEventListener("mouseout",((e,t,n)=>s=>{s.preventDefault(),e.noteOff(t,n,0)})(this,t,n)),s.addEventListener(r,((e,t,n)=>s=>{s.preventDefault(),e.drag=!1,e.noteOff(t,n,0)})(this,t,n))}}o.appendChild(a)}n.appendChild(o),this.observer.observe(o)}return t.appendChild(n),t}updateSynthElement(e,t,n){if(!this.element)return;const s=this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+")");if(s.dataset.isIntersecting){const e=s.querySelector(".key:nth-child("+(t+1)+")");0===n?(e.classList.contains("note-on")&&e.classList.remove("note-on"),e.style.opacity=1):(e.classList.add("note-on"),e.style.opacity=(n/127).toFixed(2))}}updateBankSelect(e){if(!this.element)return;const t=this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") .bank > select");for(;t.firstChild;)t.removeChild(t.firstChild);for(const e in this.programSet)if({}.hasOwnProperty.call(this.programSet,e)){const n=document.createElement("option");n.value=e,n.textContent=("000"+parseInt(e)).slice(-3),t.appendChild(n)}}updateProgramSelect(e){if(!this.element)return;const t=this.channelBank[e],n=this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") .bank > select"),s=this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") .program > select");for(n.value=this.channelBank[e];s.firstChild;)s.removeChild(s.firstChild);for(const n in this.programSet[t])if({}.hasOwnProperty.call(this.programSet[t],n)){const i=document.createElement("option");i.value=n,i.textContent=("000"+(parseInt(n)+1)).slice(-3)+":"+this.programSet[t][n],n===this.channelInstrument[e]&&(i.selected="selected"),s.appendChild(i)}}noteOn(e,t,n){const i=this.channelBank[e],r="object"==typeof this.bankSet[i]?this.bankSet[i]:this.bankSet[0];let o;if(o="object"==typeof r[this.channelInstrument[e]]?r[this.channelInstrument[e]]:1==this.percussionPart[e]?this.bankSet[this.isXG?127:128][0]:this.bankSet[0][this.channelInstrument[e]],void 0===o[t])return;const a=o[t];let h=this.channelPanpot[e]-64;h/=h<0?64:63,a.channel=e,a.key=t,a.velocity=n,a.panpot=h,a.volume=this.channelVolume[e]/127,a.pitchBend=this.channelPitchBend[e]-8192,a.expression=this.channelExpression[e],a.pitchBendSensitivity=Math.round(this.channelPitchBendSensitivity[e]),a.mute=this.channelMute[e],a.releaseTime=this.channelRelease[e],a.cutOffFrequency=this.cutOffFrequency[e],a.harmonicContent=this.harmonicContent[e],a.reverb=this.reverb[e],i>125&&(42!==t&&44!==t||this.noteOff(e,46,0),80===t&&this.noteOff(e,81,0),o.volume*=this.percussionVolume[t]/127);const c=new s.a(this.ctx,this.gainMaster,a);c.noteOn(),this.currentNoteOn[e].push(c),this.updateSynthElement(e,t,n)}noteOff(e,t,n){let s,i;const r=this.currentNoteOn[e];let o;const a=this.channelHold[e];for(s=0,i=r.length;s<i;++s)o=r[s],o.key===t&&(o.noteOff(),a||(o.release(),r.splice(s,1),--s,--i));this.updateSynthElement(e,t,0)}hold(e,t){const n=this.currentNoteOn[e];let s,i,r;if(!(this.channelHold[e]=!(t<64)))for(i=0,r=n.length;i<r;++i)s=n[i],s.isNoteOff()&&(s.release(),n.splice(i,1),--i,--r);if(this.element){const t=this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+")");this.channelHold[e]?t.classList.add("hold"):t.classList.remove("hold")}}bankSelectMsb(e,t){if(this.isXG)this.channelBank[e]=0,64===t?(this.channelBank[e]=125,this.percussionPart[e]=!0):126!==t&&127!==t||(this.channelBank[e]=t,this.percussionPart[e]=!0);else{if(!this.isGS)return;this.channelBank[e]=9===e?128:t,this.percussionPart[e]=128===t}this.updateBankSelect(e)}bankSelectLsb(e,t){this.isXG&&!0!==this.percussionPart[e]&&(this.percussionPart[e]=t>=125,this.channelBank[e]=t,this.updateBankSelect(e))}programChange(e,t){this.channelInstrument[e]=t,this.bankChange(e,this.channelBank[e]),this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") .program > select").value=t)}bankChange(e,t){"object"==typeof this.bankSet[t]?this.channelBank[e]=t:this.percussionPart[e]?this.channelBank[e]=this.isXG?127:128:this.channelBank[e]=0,this.updateProgramSelect(e),this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") > .bank > select").value=t)}volumeChange(e,t){this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") > .volume").innerText=t),this.channelVolume[e]=t}expression(e,t){let n,s;const i=this.currentNoteOn[e];for(n=0,s=i.length;n<s;++n)i[n].updateExpression(t);this.channelExpression[e]=t}panpotChange(e,t){this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") > .panpot > meter").value=t),this.channelPanpot[e]=t}pitchBend(e,t,n){const s=127&t|(127&n)<<7;let i,r;const o=this.currentNoteOn[e],a=s-8192;for(this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(e+1)+") > .pitchBend > meter").value=a),i=0,r=o.length;i<r;++i)o[i].updatePitchBend(a);this.channelPitchBend[e]=s}pitchBendSensitivity(e,t){this.element&&(document.querySelector(".instrument > .channel:nth-child("+(e+1)+") > .pitchBendSensitivity").innerText=t),this.channelPitchBendSensitivity[e]=t}attackTime(e,t){this.channelAttack[e]=t}decayTime(e,t){this.channelDecay[e]=t}sustinTime(e,t){this.channelSustin[e]=t}releaseTime(e,t){this.channelRelease[e]=t}harmonicContent(e,t){this.channelHarmonicContent[e]=t}cutOffFrequency(e,t){this.channelCutOffFrequency[e]=t}reverbDepth(e,t){this.reverb[e].mix(t/127)}getPitchBendSensitivity(e){return this.channelPitchBendSensitivity[e]}drumInstrumentLevel(e,t){this.percussionVolume[e]=t}allNoteOff(e){const t=this.currentNoteOn[e];for(this.hold(e,0);t.length>0;)this.noteOff(e,t[0].key,0)}allSoundOff(e){const t=this.currentNoteOn[e];let n;for(;t.length>0;)n=t.shift(),this.noteOff(e,n.key,0),n.release(),n.disconnect();this.hold(e,0)}resetAllControl(e){this.allNoteOff(e),this.expression(e,127),this.pitchBend(e,0,64)}mute(e,t){const n=this.currentNoteOn[e];let s,i;if(this.channelMute[e]=t,t)for(s=0,i=n.length;s<i;++s)n[s].disconnect();else for(s=0,i=n.length;s<i;++s)n[s].connect()}setPercussionPart(e,t){this.isXG?this.channelBank[e]=127:this.channelBank[e]=128,this.percussionPart[e]=t}}},function(e,t,n){"use strict";t.a=class{constructor(e,t,n){this.ctx=e,this.destination=t,this.instrument=n,this.channel=n.channel,this.key=n.key,this.velocity=n.velocity,this.buffer=n.sample,this.playbackRate=n.basePlaybackRate,this.loopStart=n.loopStart,this.loopEnd=n.loopEnd,this.sampleRate=n.sampleRate,this.volume=n.volume,this.panpot=n.panpot,this.pitchBend=n.pitchBend,this.pitchBendSensitivity=n.pitchBendSensitivity,this.modEnvToPitch=n.modEnvToPitch,this.expression=n.expression,this.cutOffFrequency=n.cutOffFrequency,this.hermonicContent=n.hermonicContent,this.reverb=n.reverb,this.startTime=e.currentTime,this.computedPlaybackRate=0|this.playbackRate,this.noteOffState=!1,this.audioBuffer,this.bufferSource=e.createBufferSource(),this.panner=e.createPanner(),this.outputGainNode=e.createGain(),this.expressionGainNode=e.createGain(),this.filter=e.createBiquadFilter(),this.modulator=e.createBiquadFilter()}noteOn(){const e=this.ctx,t=this.instrument,n=this.ctx.currentTime||0,s=n+t.volDelay,i=n+t.modDelay,r=s+t.volAttack,o=s+t.modAttack,a=r+t.volHold,h=o+t.modHold,c=a+t.volDecay,l=h+t.modDecay,u=t.loopStart/this.sampleRate,d=t.loopEnd/this.sampleRate,p=t.start/this.sampleRate,m=void 0!==t.pan?t.pan:this.panpot,f=this.buffer.subarray(0,this.buffer.length+t.end),y=this.audioBuffer=e.createBuffer(1,f.length,this.sampleRate);y.getChannelData(0).set(f);const g=this.bufferSource;g.buffer=y,g.loop=0|t.sampleModes||0,g.loopStart=u,g.loopEnd=d,this.updatePitchBend(this.pitchBend);const v=this.outputGainNode;this.expressionGainNode.gain.value=this.expression/127;const b=this.panner;b.panningModel="equalpower",b.setPosition(Math.sin(m*Math.PI/2),0,Math.cos(m*Math.PI/2));let k=this.volume*(this.velocity/127)*(1-t.initialAttenuation/1e3);k<0&&(k=0);const w=v.gain;w.setValueAtTime(0,n),w.setValueAtTime(0,s),w.setTargetAtTime(k,s,t.volAttack),w.setValueAtTime(k,a),w.linearRampToValueAtTime(k*(1-t.volSustain),c);const M=this.amountToFreq(t.initialFilterFc),S=this.amountToFreq(t.initialFilterFc+t.modEnvToFilterFc),E=M+(S-M)*(1-t.modSustain),C=this.modulator;C.Q.setValueAtTime(10**(t.initialFilterQ/200),n),C.frequency.value=M,C.type="lowpass",C.frequency.setTargetAtTime(M/127,this.ctx.currentTime,.5),C.frequency.setValueAtTime(M,n),C.frequency.setValueAtTime(M,i),C.frequency.setTargetAtTime(S,i,parseFloat(t.modAttack+1)),C.frequency.setValueAtTime(S,h),C.frequency.linearRampToValueAtTime(E,l),g.connect(C),C.connect(b),b.connect(this.expressionGainNode),this.expressionGainNode.connect(v),t.mute||this.connect(),g.start(0,p)}amountToFreq(e){return 2**((e-6900)/1200)*440}noteOff(){this.noteOffState=!0}isNoteOff(){return this.noteOffState}release(){const e=this.instrument,t=this.bufferSource,n=this.outputGainNode,s=this.ctx.currentTime,i=e.releaseTime-64,r=s+e.volRelease*n.gain.value*(1+i/(i<0?64:63)),o=this.modulator,a=this.amountToFreq(e.initialFilterFc),h=this.amountToFreq(e.initialFilterFc+e.modEnvToFilterFc),c=s+e.modRelease*(a===h?1:(o.frequency.value-a)/(h-a));if(this.audioBuffer)switch(e.sampleModes){case 0:break;case 1:n.gain.cancelScheduledValues(0),n.gain.setValueAtTime(n.gain.value,s),n.gain.linearRampToValueAtTime(0,r),o.frequency.cancelScheduledValues(0),o.frequency.setValueAtTime(o.frequency.value,s),o.frequency.linearRampToValueAtTime(a,c),t.playbackRate.cancelScheduledValues(0),t.playbackRate.setValueAtTime(t.playbackRate.value,s),t.playbackRate.linearRampToValueAtTime(this.computedPlaybackRate,c),t.stop(r);break;case 2:break;case 3:t.loop=!1,t.disconnect(),t.buffer=null}}connect(){this.reverb.connect(this.outputGainNode).connect(this.destination)}disconnect(){this.outputGainNode.disconnect(0)}schedulePlaybackRate(){const e=this.bufferSource.playbackRate,t=this.computedPlaybackRate,n=this.startTime,s=this.instrument,i=n+s.modAttack,r=i+s.modDecay,o=t*1.0594630943592953**(this.modEnvToPitch*this.instrument.scaleTuning);e.cancelScheduledValues(0),e.setValueAtTime(t,n),e.linearRampToValueAtTime(o,i),e.linearRampToValueAtTime(t+(o-t)*(1-s.modSustain),r)}updateExpression(e){this.expressionGainNode.gain.value=(this.expression=e)/127}updatePitchBend(e){this.computedPlaybackRate=this.playbackRate*1.0594630943592953**(e/(e<0?8192:8191)*this.pitchBendSensitivity*this.instrument.scaleTuning),this.schedulePlaybackRate()}}},function(e,t,n){var s;"undefined"!=typeof self&&self,s=function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/reverb.js")}({"./src/meta.js":function(e,t,n){"use strict";n.r(t),t.default={version:"0.2.1",date:"2019-12-26T15:48:03.337Z"}},"./src/reverb.js":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));var s=n("./src/meta.js");function i(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var r=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=s.default.version,this.build=s.default.date,this.ctx=t,this.wetGainNode=this.ctx.createGain(),this.dryGainNode=this.ctx.createGain(),this.filterNode=this.ctx.createBiquadFilter(),this.convolverNode=this.ctx.createConvolver(),this.outputNode=this.ctx.createGain(),this._decay=0|n.decay||5,this._delay=0|n.delay||0,this._reverse=n.reverse||!1,this._time=0|n.time||3,this._filterType=n.filterType||"lowpass",this._freq=0|n.filterFreq||2200,this._q=0|n.filterQ||1,this._mix=n.mix||.5,this.time(this._time),this.delay(this._delay),this.decay(this._decay),this.reverse(this._reverse),this.filterType(this._filterType),this.filterFreq(this._freq),this.filterQ(this._q),this.mix(this._mix),this.isConnected=!1,this.buildImpulse()}var t,n,r;return t=e,(n=[{key:"connect",value:function(e){return this.isConnected=!0,this.convolverNode.connect(this.filterNode),this.filterNode.connect(this.wetGainNode),e.connect(this.convolverNode),e.connect(this.dryGainNode).connect(this.outputNode),e.connect(this.wetGainNode).connect(this.outputNode),this.outputNode}},{key:"disconnect",value:function(e){try{this.convolverNode.disconnect(this.filterNode),this.filterNode.disconnect(this.wetGainNode),e.disconnect(this.convolverNode),e.disconnect(this.dryGainNode).disconnect(this.outputNode),e.disconnect(this.wetGainNode).disconnect(this.outputNode)}catch(e){}return this.isConnected=!1,e}},{key:"mix",value:function(e){this.inRange(e,0,1)&&(this._mix=e,this.dryGainNode.gain.value=1-this._mix,this.wetGainNode.gain.value=this._mix)}},{key:"time",value:function(e){this.inRange(e,1,50)&&(this._time=e,this.buildImpulse())}},{key:"decay",value:function(e){this.inRange(e,0,100)&&(this._decay=e,this.buildImpulse())}},{key:"delay",value:function(e){this.inRange(e,0,100)&&(this._delay=e,this.buildImpulse())}},{key:"reverse",value:function(e){this._reverse=e,this.buildImpulse()}},{key:"filterType",value:function(e){this.filterNode.type=this._filterType=e}},{key:"filterFreq",value:function(e){this.inRange(e,20,5e3)&&(this._freq=e,this.filterNode.frequency.value=this._freq)}},{key:"filterQ",value:function(e){this.inRange(e,0,10)&&(this._q=e,this.filterNode.Q.value=this._q)}},{key:"inRange",value:function(e,t,n){return(e-t)*(e-n)<=0}},{key:"buildImpulse",value:function(){for(var e=this.ctx.sampleRate,t=Math.max(e*this._time,1),n=e*this._delay,s=this.ctx.createBuffer(2,t,e),i=new Float32Array(t),r=new Float32Array(t),o=0;o<t;o++){var a=0;o<n?(i[o]=0,r[o]=0,a=this._reverse?t-(o-n):o-n):a=this._reverse?t-o:o;var h=Math.pow(1-a/t,this._decay);i[o]=this.getNoise(h),r[o]=this.getNoise(h)}s.getChannelData(0).set(i),s.getChannelData(1).set(r),this.convolverNode.buffer=s}},{key:"getNoise",value:function(e){return(2*Math.random()-1)*e}}])&&i(t.prototype,n),r&&i(t,r),e}()}})},e.exports=s()},function(e,t,n){"use strict";n.r(t),n.d(t,"WebMidiLink",(function(){return r}));var s=n(2),i=n(3);class r{constructor(e={}){this.NrpnMsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.NrpnLsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.RpnMsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.RpnLsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.ready=!1,this.synth,this.loadCallback=()=>{},this.messageHandler=this.onmessage.bind(this),this.xhr,this.rpnMode=!0,this.option=e,this.option.drawSynth=void 0===e.drawSynth||e.drawSynth,this.option.cache=void 0===e.cache||e.cache,this.placeholder=void 0!==e.placeholder?document.getElementById(e.placeholder):window.document.body,this.opener,this.version=s.a.version,this.build=s.a.date,window.addEventListener("DOMContentLoaded",function(){this.ready=!0}.bind(this),!1)}setup(e){const t=window;this.ready?this.load(e):t.addEventListener("DOMContentLoaded",function n(){t.removeEventListener("DOMContentLoaded",n,!1),this.load(e)}.bind(this),!1),t.opener?this.opener=t.opener:t.parent!==t&&(this.opener=t.parent)}load(e){const t=window.opener?window.opener:window.parent,n=this.placeholder.appendChild(document.createElement("div")),s=n.appendChild(document.createElement("strong")),i=this;t.postMessage("link,progress","*"),s.innerText="Now Loading...";const r=e=>{s.innerText="Parsing SoundFont...",i.onload(e),"function"==typeof i.loadCallback&&i.loadCallback(e),i.placeholder.removeChild(n),t.postMessage("link,ready","*")};if(this.option.cache&&window.caches){s.className="ml-1",n.className="d-flex";const t=n.appendChild(document.createElement("div"));t.className="spinner-border text-primary",t.role="status",t.ariaHidden=!0,window.caches.open("wml").then(t=>{t.match(e).then(e=>e.arrayBuffer()).then(e=>r(e)).catch(()=>{fetch(e).then(n=>{if(!n.ok)throw new Error("Network response was not ok.");const i=n.headers.get("content-length");s.innerText+=" ("+i+"byte)";const r=n.clone();return t.put(e,n),r.arrayBuffer()}).then(e=>r(e)).catch(e=>{alert("There has been a problem with your fetch operation: "+e.message)})})})}else{const s=n.appendChild(document.createElement("div"));s.className="progress";const i=s.appendChild(document.createElement("div"));i.className="progress-bar",i.role="progressbar",i.innerText="0%";const o=e=>{let t=0;for(let n=0;n<e.length;++n)t+=e[n].byteLength;const n=new Uint8Array(t);let s=0;for(let t=0;t<e.length;++t)n.set(new Uint8Array(e[t]),s),s+=e[t].byteLength;return n.buffer};fetch(e).then(e=>{const n=e.headers.get("content-length");s.max=n;const a=e.body.getReader();let h=0;const c=[],l=e=>{if(e.done){const e=o(c);return void r(e)}h+=e.value.length,c.push(e.value);const s=Math.round(h/n*100);return i.style.width=s+"%",i.innerText=s+" %",t.postMessage("link,progress,"+h+","+n,"*"),a.read().then(l)};a.read().then(l)}).catch(e=>alert("There has been a problem with your fetch operation: "+e.message))}}setReverb(e){this.synth.setReverb(e)}onload(e){const t=new Uint8Array(e);this.loadSoundFont(t)}loadSoundFont(e){let t;const n=window;this.synth?(t=this.synth,t.refreshInstruments(e)):(t=this.synth=new i.a(e),this.option.drawSynth&&this.placeholder.appendChild(t.drawSynth()),t.init(),t.start(),n.addEventListener("message",this.messageHandler,!1)),n.postMessage("link,ready","*")}onmessage(e){const t="function"==typeof e.data.split?e.data.split(","):[],n=t!==[]?t.shift():"",s=window.opener?window.opener:window.parent;let i;switch(n){case"midi":this.processMidiMessage(t.map(e=>parseInt(e,16)));break;case"link":if(void 0===s)return;switch(i=t.shift(),i){case"reqpatch":s.postMessage("link,patch","*");break;case"setpatch":case"ready":s.postMessage("link,ready","*");break;case"progress":s.postMessage("link,progress","*")}}}setLoadCallback(e){this.loadCallback=e}processMidiMessage(e){const t=15&e[0],n=this.synth;switch(240&e[0]){case 128:n.noteOff(t,e[1],e[2]);break;case 144:e[2]>0?n.noteOn(t,e[1],e[2]):n.noteOff(t,e[1],0);break;case 176:const s=e[2];switch(e[1]){case 0:n.bankSelectMsb(t,s);break;case 1:break;case 6:if(this.rpnMode)switch(this.RpnMsb[t]){case 0:switch(this.RpnLsb[t]){case 0:n.pitchBendSensitivity(t,s)}}else switch(this.NrpnMsb[t]){case 26:n.drumInstrumentLevel(this.NrpnLsb[t],s)}break;case 38:if(this.rpnMode)switch(this.RpnMsb[t]){case 0:switch(this.RpnLsb[t]){case 0:n.pitchBendSensitivity(t,n.getPitchBendSensitivity(t)+s/100)}}break;case 7:n.volumeChange(t,s);break;case 10:n.panpotChange(t,s);break;case 120:n.allSoundOff(t);break;case 121:n.resetAllControl(t);break;case 32:n.bankSelectLsb(t,s);break;case 71:n.harmonicContent(t,s);break;case 96:case 97:break;case 98:this.rpnMode=!1,this.NrpnLsb[t]=s;break;case 99:this.rpnMode=!1,this.NrpnMsb[t]=s;break;case 100:this.rpnMode=!0,this.RpnLsb[t]=s;break;case 101:this.rpnMode=!0,this.RpnMsb[t]=s;break;case 64:n.hold(t,s);break;case 11:n.expression(t,s);break;case 72:n.decayTime(t,s);break;case 73:n.releaseTime(t,s);break;case 74:n.attackTime(t,s);break;case 75:n.cutOffFrequency(t,s);break;case 91:n.reverbDepth(t,s)}break;case 192:n.programChange(t,e[1]);break;case 224:n.pitchBend(t,e[1],e[2]);break;case 240:switch(e[1]){case 126:127===e[2]&&9===e[3]&&1===e[4]&&n.init("GM");break;case 127:switch(e[3]){case 4:switch(e[4]){case 1:n.setMasterVolume(e[5]+(e[6]<<7))}}}switch(e[2]){case 67:switch(8===e[5]&&(0!==e[7]?n.setPercussionPart(e[6],!0):n.setPercussionPart(e[6],!1)),e[7]){case 4:n.setMasterVolume(2*(e[8]<<7));break;case 126:n.init("XG")}break;case 65:switch(e[8]){case 4:n.setMasterVolume(e[9]<<7);break;case 127:n.init("GS");break;case 21:const t=e[7]-15,s=e[8];0===t?0!==s?n.setPercussionPart(9,!0):n.setPercussionPart(9,!1):t>=10?0!==s?n.setPercussionPart(t-1,!0):n.setPercussionPart(t-1,!1):0!==s?n.setPercussionPart(t,!0):n.setPercussionPart(t,!1)}}break;default:n.setPercussionPart(9,!0)}}}t.default=r}])}));